// PROJECT: transpobolivia
// ================================================
// Archivos incluidos: 111
// Archivos excluidos: 13
// ================================================



============================================================
DIR: backend
============================================================


────────────────────────────────────────────────────────────
FILE: backend\Dockerfile
────────────────────────────────────────────────────────────

# === ETAPA 1: BUILDER ===
# Usamos una imagen completa de Node 24 para instalar dependencias y compilar.
# 'alpine' es una versión ligera de Linux, ideal para contenedores.
FROM node:24-alpine AS builder

WORKDIR /app

# Copia los archivos de manifiesto y lock para aprovechar el caché de Docker.
COPY package*.json ./

# Instala TODAS las dependencias, incluyendo las de desarrollo (typescript, etc.).
RUN npm install

# Copia el resto del código fuente del backend.
COPY . .

# Compila el código TypeScript a JavaScript en la carpeta /dist.
RUN npm run build

# === ETAPA 2: PRODUCTION ===
# Empezamos desde una imagen fresca y aún más ligera.
FROM node:24-alpine

WORKDIR /app

# Copia los manifiestos desde la etapa de builder.
COPY --from=builder /app/package*.json ./

# ¡OPTIMIZACIÓN CLAVE! Instala ÚNICAMENTE las dependencias de producción.
# Esto reduce drásticamente el tamaño de la imagen final.
RUN npm install --only=production

# Copia la aplicación ya compilada desde la etapa de builder.
COPY --from=builder /app/dist ./dist

# Expone el puerto que la aplicación NestJS usa internamente.
EXPOSE 3000

# El comando para iniciar la aplicación en modo producción.
CMD ["node", "dist/main"]

────────────────────────────────────────────────────────────
FILE: backend\README.md
────────────────────────────────────────────────────────────

<p align="center">
  <a href="http://nestjs.com/" target="blank"><img src="https://nestjs.com/img/logo-small.svg" width="120" alt="Nest Logo" /></a>
</p>

[circleci-image]: https://img.shields.io/circleci/build/github/nestjs/nest/master?token=abc123def456
[circleci-url]: https://circleci.com/gh/nestjs/nest

  <p align="center">A progressive <a href="http://nodejs.org" target="_blank">Node.js</a> framework for building efficient and scalable server-side applications.</p>
    <p align="center">
<a href="https://www.npmjs.com/~nestjscore" target="_blank"><img src="https://img.shields.io/npm/v/@nestjs/core.svg" alt="NPM Version" /></a>
<a href="https://www.npmjs.com/~nestjscore" target="_blank"><img src="https://img.shields.io/npm/l/@nestjs/core.svg" alt="Package License" /></a>
<a href="https://www.npmjs.com/~nestjscore" target="_blank"><img src="https://img.shields.io/npm/dm/@nestjs/common.svg" alt="NPM Downloads" /></a>
<a href="https://circleci.com/gh/nestjs/nest" target="_blank"><img src="https://img.shields.io/circleci/build/github/nestjs/nest/master" alt="CircleCI" /></a>
<a href="https://discord.gg/G7Qnnhy" target="_blank"><img src="https://img.shields.io/badge/discord-online-brightgreen.svg" alt="Discord"/></a>
<a href="https://opencollective.com/nest#backer" target="_blank"><img src="https://opencollective.com/nest/backers/badge.svg" alt="Backers on Open Collective" /></a>
<a href="https://opencollective.com/nest#sponsor" target="_blank"><img src="https://opencollective.com/nest/sponsors/badge.svg" alt="Sponsors on Open Collective" /></a>
  <a href="https://paypal.me/kamilmysliwiec" target="_blank"><img src="https://img.shields.io/badge/Donate-PayPal-ff3f59.svg" alt="Donate us"/></a>
    <a href="https://opencollective.com/nest#sponsor"  target="_blank"><img src="https://img.shields.io/badge/Support%20us-Open%20Collective-41B883.svg" alt="Support us"></a>
  <a href="https://twitter.com/nestframework" target="_blank"><img src="https://img.shields.io/twitter/follow/nestframework.svg?style=social&label=Follow" alt="Follow us on Twitter"></a>
</p>
  <!--[![Backers on Open Collective](https://opencollective.com/nest/backers/badge.svg)](https://opencollective.com/nest#backer)
  [![Sponsors on Open Collective](https://opencollective.com/nest/sponsors/badge.svg)](https://opencollective.com/nest#sponsor)-->

## Description

[Nest](https://github.com/nestjs/nest) framework TypeScript starter repository.

## Project setup

```bash
$ npm install
```

## Compile and run the project

```bash
# development
$ npm run start

# watch mode
$ npm run start:dev

# production mode
$ npm run start:prod
```

## Run tests

```bash
# unit tests
$ npm run test

# e2e tests
$ npm run test:e2e

# test coverage
$ npm run test:cov
```

## Deployment

When you're ready to deploy your NestJS application to production, there are some key steps you can take to ensure it runs as efficiently as possible. Check out the [deployment documentation](https://docs.nestjs.com/deployment) for more information.

If you are looking for a cloud-based platform to deploy your NestJS application, check out [Mau](https://mau.nestjs.com), our official platform for deploying NestJS applications on AWS. Mau makes deployment straightforward and fast, requiring just a few simple steps:

```bash
$ npm install -g @nestjs/mau
$ mau deploy
```

With Mau, you can deploy your application in just a few clicks, allowing you to focus on building features rather than managing infrastructure.

## Resources

Check out a few resources that may come in handy when working with NestJS:

- Visit the [NestJS Documentation](https://docs.nestjs.com) to learn more about the framework.
- For questions and support, please visit our [Discord channel](https://discord.gg/G7Qnnhy).
- To dive deeper and get more hands-on experience, check out our official video [courses](https://courses.nestjs.com/).
- Deploy your application to AWS with the help of [NestJS Mau](https://mau.nestjs.com) in just a few clicks.
- Visualize your application graph and interact with the NestJS application in real-time using [NestJS Devtools](https://devtools.nestjs.com).
- Need help with your project (part-time to full-time)? Check out our official [enterprise support](https://enterprise.nestjs.com).
- To stay in the loop and get updates, follow us on [X](https://x.com/nestframework) and [LinkedIn](https://linkedin.com/company/nestjs).
- Looking for a job, or have a job to offer? Check out our official [Jobs board](https://jobs.nestjs.com).

## Support

Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).

## Stay in touch

- Author - [Kamil Myśliwiec](https://twitter.com/kammysliwiec)
- Website - [https://nestjs.com](https://nestjs.com/)
- Twitter - [@nestframework](https://twitter.com/nestframework)

## License

Nest is [MIT licensed](https://github.com/nestjs/nest/blob/master/LICENSE).

────────────────────────────────────────────────────────────
FILE: backend\package.json
────────────────────────────────────────────────────────────

{
  "name": "backend",
  "version": "0.0.1",
  "description": "",
  "author": "",
  "private": true,
  "license": "UNLICENSED",
  "scripts": {
    "build": "nest build",
    "format": "prettier --write \"src/**/*.ts\" \"test/**/*.ts\"",
    "start": "nest start",
    "start:dev": "nest start --watch",
    "start:debug": "nest start --debug --watch",
    "start:prod": "node dist/main",
    "lint": "eslint \"{src,apps,libs,test}/**/*.ts\" --fix",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:cov": "jest --coverage",
    "test:debug": "node --inspect-brk -r tsconfig-paths/register -r ts-node/register node_modules/.bin/jest --runInBand",
    "test:e2e": "jest --config ./test/jest-e2e.json"
  },
  "dependencies": {
    "@nestjs/common": "^11.0.1",
    "@nestjs/core": "^11.0.1",
    "@nestjs/jwt": "^11.0.0",
    "@nestjs/passport": "^11.0.5",
    "@nestjs/platform-express": "^11.0.1",
    "@nestjs/typeorm": "^11.0.0",
    "@types/bcrypt": "^6.0.0",
    "@types/passport-local": "^1.0.38",
    "bcrypt": "^6.0.0",
    "passport": "^0.7.0",
    "passport-jwt": "^4.0.1",
    "passport-local": "^1.0.0",
    "pg": "^8.16.3",
    "reflect-metadata": "^0.2.2",
    "rxjs": "^7.8.1",
    "typeorm": "^0.3.25"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3.2.0",
    "@eslint/js": "^9.18.0",
    "@nestjs/cli": "^11.0.0",
    "@nestjs/schematics": "^11.0.0",
    "@nestjs/testing": "^11.0.1",
    "@types/express": "^5.0.0",
    "@types/jest": "^30.0.0",
    "@types/node": "^22.10.7",
    "@types/passport-jwt": "^4.0.1",
    "@types/supertest": "^6.0.2",
    "eslint": "^9.18.0",
    "eslint-config-prettier": "^10.0.1",
    "eslint-plugin-prettier": "^5.2.2",
    "globals": "^16.0.0",
    "jest": "^30.0.0",
    "prettier": "^3.4.2",
    "source-map-support": "^0.5.21",
    "supertest": "^7.0.0",
    "ts-jest": "^29.2.5",
    "ts-loader": "^9.5.2",
    "ts-node": "^10.9.2",
    "tsconfig-paths": "^4.2.0",
    "typescript": "^5.7.3",
    "typescript-eslint": "^8.20.0"
  },
  "jest": {
    "moduleFileExtensions": [
      "js",
      "json",
      "ts"
    ],
    "rootDir": "src",
    "testRegex": ".*\\.spec\\.ts$",
    "transform": {
      "^.+\\.(t|j)s$": "ts-jest"
    },
    "collectCoverageFrom": [
      "**/*.(t|j)s"
    ],
    "coverageDirectory": "../coverage",
    "testEnvironment": "node"
  }
}

────────────────────────────────────────────────────────────
FILE: backend\tsconfig.json
────────────────────────────────────────────────────────────

{
  "compilerOptions": {
    "module": "nodenext",
    "moduleResolution": "nodenext",
    "resolvePackageJsonExports": true,
    "esModuleInterop": true,
    "isolatedModules": true,
    "declaration": true,
    "removeComments": true,
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "allowSyntheticDefaultImports": true,
    "target": "ES2023",
    "sourceMap": true,
    "outDir": "./dist",
    "baseUrl": "./",
    "incremental": true,
    "skipLibCheck": true,
    "strictNullChecks": true,
    "forceConsistentCasingInFileNames": true,
    "noImplicitAny": false,
    "strictBindCallApply": false,
    "noFallthroughCasesInSwitch": false
  }
}


============================================================
DIR: backend\src
============================================================


────────────────────────────────────────────────────────────
FILE: backend\src\app.controller.spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { AppController } from './app.controller';
import { AppService } from './app.service';

describe('AppController', () => {
  let appController: AppController;

  beforeEach(async () => {
    const app: TestingModule = await Test.createTestingModule({
      controllers: [AppController],
      providers: [AppService],
    }).compile();

    appController = app.get<AppController>(AppController);
  });

  describe('root', () => {
    it('should return "Hello World!"', () => {
      expect(appController.getHello()).toBe('Hello World!');
    });
  });
});

────────────────────────────────────────────────────────────
FILE: backend\src\app.controller.ts
────────────────────────────────────────────────────────────

import { Controller, Get } from '@nestjs/common';
import { AppService } from './app.service';

@Controller()
export class AppController {
  constructor(private readonly appService: AppService) {}

  @Get()
  getHello(): string {
    return this.appService.getHello();
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\app.module.ts
────────────────────────────────────────────────────────────

// backend/src/app.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { UsersModule } from './users/users.module';
import { EmpresaModule } from './empresa/empresa.module';
import { VehiculosModule } from './vehiculos/vehiculos.module';
import { AuthModule } from './auth/auth.module';
import { ConductoresModule } from './conductores/conductores.module';
import { RutasModule } from './rutas/rutas.module';
import { ReservasModule } from './reservas/reservas.module';
import { SearchModule } from './search/search.module';
import { MantenimientoModule } from './mantenimiento/mantenimiento.module';
import { HorariosModule } from './horarios/horarios.module';

@Module({
  imports: [
    TypeOrmModule.forRoot({
      type: 'postgres',
      host: 'db',
      port: 5432,
      username: process.env.POSTGRES_USER, // Usaremos variables de entorno
      password: process.env.POSTGRES_PASSWORD,
      database: process.env.POSTGRES_DB,
      entities: [__dirname + '/**/*.entity{.ts,.js}'],
      synchronize: true,
    }),
    UsersModule,
    EmpresaModule,
    VehiculosModule,
    AuthModule,
    ConductoresModule,
    RutasModule,
    ReservasModule,
    SearchModule,
    MantenimientoModule,
    HorariosModule
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}

────────────────────────────────────────────────────────────
FILE: backend\src\app.service.ts
────────────────────────────────────────────────────────────

import { Injectable } from '@nestjs/common';

@Injectable()
export class AppService {
  getHello(): string {
    return 'Hello World!';
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\main.ts
────────────────────────────────────────────────────────────

import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);

  // CORS correcto para dev: origen explícito y credenciales (si usas cookies).
  // En tu front usamos Authorization: Bearer, así que credenciales no son necesarias,
  // pero lo dejamos listo igualmente.
  app.enableCors({
    origin: 'http://localhost:5173',
    credentials: true,
    methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS'],
    allowedHeaders: ['Content-Type', 'Authorization'],
    exposedHeaders: ['Authorization'],
  });

  await app.listen(3000);
}
bootstrap();


============================================================
DIR: backend\src\auth
============================================================


────────────────────────────────────────────────────────────
FILE: backend\src\auth\auth.module.ts
────────────────────────────────────────────────────────────

// backend/src/auth/auth.module.ts

// 1. Importar forwardRef desde @nestjs/common
import { Module, forwardRef } from '@nestjs/common';
import { JwtModule } from '@nestjs/jwt';
import { PassportModule } from '@nestjs/passport';
// 2. El import de UsersModule ya existe, no hay que añadirlo
import { UsersModule } from '../users/users.module'; 
import { AuthService } from './auth.service';
import { JwtStrategy } from './jwt.strategy';
import { LocalStrategy } from './local.strategy';

@Module({
  imports: [
    // 3. Envolver UsersModule en forwardRef
    forwardRef(() => UsersModule), // <-- ¡AQUÍ ESTÁ LA OTRA PARTE DE LA SOLUCIÓN!
    PassportModule,
    JwtModule.register({
      secret: 'TU_CLAVE_SECRETA_SUPER_SEGURA', 
      signOptions: { expiresIn: '1d' },
    }),
  ],
  providers: [AuthService, JwtStrategy, LocalStrategy],
  exports: [AuthService],
})
export class AuthModule {}

────────────────────────────────────────────────────────────
FILE: backend\src\auth\auth.service.spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { AuthService } from './auth.service';

describe('AuthService', () => {
  let service: AuthService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [AuthService],
    }).compile();

    service = module.get<AuthService>(AuthService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});

────────────────────────────────────────────────────────────
FILE: backend\src\auth\auth.service.ts
────────────────────────────────────────────────────────────

// >>> backend/src/auth/auth.service.ts

import { Injectable } from '@nestjs/common';
import { JwtService } from '@nestjs/jwt';
import { UsersService } from '../users/users.service';
import * as bcrypt from 'bcrypt';

@Injectable()
export class AuthService {
  constructor(
    private usersService: UsersService,
    private jwtService: JwtService,
  ) {}

  async validateUser(email: string, pass: string): Promise<any> {
    const user = await this.usersService.findOneByEmail(email);
    if (user && (await bcrypt.compare(pass, user.contrasena))) {
      const { contrasena, ...result } = user;
      return result;
    }
    return null;
  }

  async login(user: any) {
    const payload = { 
        email: user.email, 
        sub: user.id, 
        nombre: user.nombre, // Es importante para el saludo en el Header
        empresaId: user.empresaId 
    };
    return {
      access_token: this.jwtService.sign(payload),
    };
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\auth\jwt-auth.guard.ts
────────────────────────────────────────────────────────────

// backend/src/auth/jwt-auth.guard.ts
import { Injectable } from '@nestjs/common';
import { AuthGuard } from '@nestjs/passport';

@Injectable()
export class JwtAuthGuard extends AuthGuard('jwt') {}

────────────────────────────────────────────────────────────
FILE: backend\src\auth\jwt.strategy.ts
────────────────────────────────────────────────────────────

// backend/src/auth/jwt.strategy.ts
import { Injectable } from '@nestjs/common';
import { PassportStrategy } from '@nestjs/passport';
import { ExtractJwt, Strategy } from 'passport-jwt';

@Injectable()
export class JwtStrategy extends PassportStrategy(Strategy) {
  constructor() {
    super({
      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),
      ignoreExpiration: false,
      secretOrKey: 'TU_CLAVE_SECRETA_SUPER_SEGURA', // ¡Cambia esto en un proyecto real!
    });
  }

  async validate(payload: any) {
    // El payload es el contenido decodificado del JWT.
    // Lo que devolvamos aquí se adjuntará al objeto `request.user`.
    return { userId: payload.sub, email: payload.email, empresaId: payload.empresaId };
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\auth\local-auth.guard.ts
────────────────────────────────────────────────────────────

// >>> backend/src/auth/local-auth.guard.ts

import { Injectable } from '@nestjs/common';
import { AuthGuard } from '@nestjs/passport';

@Injectable()
export class LocalAuthGuard extends AuthGuard('local') {}

────────────────────────────────────────────────────────────
FILE: backend\src\auth\local.strategy.ts
────────────────────────────────────────────────────────────

// >>> backend/src/auth/local.strategy.ts

import { Strategy } from 'passport-local';
import { PassportStrategy } from '@nestjs/passport';
import { Injectable, UnauthorizedException } from '@nestjs/common';
import { AuthService } from './auth.service';

@Injectable()
export class LocalStrategy extends PassportStrategy(Strategy) {
  constructor(private authService: AuthService) {
    // Ajustamos ambos nombres de campos: email y contrasena
    super({ usernameField: 'email', passwordField: 'contrasena' });
  }

  async validate(email: string, pass: string): Promise<any> {
    const user = await this.authService.validateUser(email, pass);
    if (!user) {
      throw new UnauthorizedException('Credenciales incorrectas');
    }
    return user;
  }
}


============================================================
DIR: backend\src\conductores
============================================================


────────────────────────────────────────────────────────────
FILE: backend\src\conductores\conductor.entity.ts
────────────────────────────────────────────────────────────

// backend/src/conductores/conductor.entity.ts
import { Entity, PrimaryGeneratedColumn, Column, ManyToOne, JoinColumn } from 'typeorm';
import { Empresa } from '../empresa/empresa.entity';

@Entity('conductores')
export class Conductor {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column()
  nombre: string;

  @Column({ unique: true })
  cedula: string;

  @Column()
  tipoLicencia: 'A' | 'B' | 'C' | 'P';

  @Column()
  vencimientoLicencia: string;

  @Column({ default: 'activo' })
  estado: 'activo' | 'inactivo';

  @Column()
  empresaId: string;

  @ManyToOne(() => Empresa)
  @JoinColumn({ name: 'empresaId' })
  empresa: Empresa;
}

────────────────────────────────────────────────────────────
FILE: backend\src\conductores\conductores.controller.spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { ConductoresController } from './conductores.controller';

describe('ConductoresController', () => {
  let controller: ConductoresController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [ConductoresController],
    }).compile();

    controller = module.get<ConductoresController>(ConductoresController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});

────────────────────────────────────────────────────────────
FILE: backend\src\conductores\conductores.controller.ts
────────────────────────────────────────────────────────────

// >>> backend/src/conductores/conductores.controller.ts

import { Controller, Get, Post, Put, Delete, Body, Param, UseGuards, Request } from '@nestjs/common';
import { ConductoresService } from './conductores.service';
import { Conductor } from './conductor.entity';
import { JwtAuthGuard } from '../auth/jwt-auth.guard';

@UseGuards(JwtAuthGuard)
@Controller('conductores')
export class ConductoresController {
  constructor(private readonly conductoresService: ConductoresService) {}

  @Get()
  async findByEmpresa(@Request() req): Promise<Conductor[]> {
    return this.conductoresService.findByEmpresaId(req.user.empresaId);
  }

  @Post()
  async create(@Request() req, @Body() conductorData: Omit<Conductor, 'id' | 'empresa' | 'empresaId'>): Promise<Conductor> {
    return this.conductoresService.create({ ...conductorData, empresaId: req.user.empresaId });
  }
    
  @Put(':id')
  async update(@Param('id') id: string, @Body() updateData: Partial<Conductor>): Promise<Conductor> {
    return this.conductoresService.update(id, updateData);
  }

  @Delete(':id')
  async remove(@Param('id') id: string): Promise<void> {
    return this.conductoresService.remove(id);
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\conductores\conductores.module.ts
────────────────────────────────────────────────────────────

// backend/src/conductores/conductores.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { ConductoresController } from './conductores.controller';
import { ConductoresService } from './conductores.service';
import { Conductor } from './conductor.entity';

@Module({
  imports: [TypeOrmModule.forFeature([Conductor])],
  controllers: [ConductoresController],
  providers: [ConductoresService],
})
export class ConductoresModule {}

────────────────────────────────────────────────────────────
FILE: backend\src\conductores\conductores.service.spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { ConductoresService } from './conductores.service';

describe('ConductoresService', () => {
  let service: ConductoresService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [ConductoresService],
    }).compile();

    service = module.get<ConductoresService>(ConductoresService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});

────────────────────────────────────────────────────────────
FILE: backend\src\conductores\conductores.service.ts
────────────────────────────────────────────────────────────

// >>> backend/src/conductores/conductores.service.ts

import { Injectable, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Conductor } from './conductor.entity';

@Injectable()
export class ConductoresService {
  constructor(
    @InjectRepository(Conductor)
    private conductoresRepository: Repository<Conductor>,
  ) {}

  findByEmpresaId(empresaId: string): Promise<Conductor[]> {
    return this.conductoresRepository.find({ where: { empresaId } });
  }

  create(conductorData: Omit<Conductor, 'id' | 'empresa'>): Promise<Conductor> {
    const nuevoConductor = this.conductoresRepository.create(conductorData);
    return this.conductoresRepository.save(nuevoConductor);
  }

  async update(id: string, updateData: Partial<Conductor>): Promise<Conductor> {
    await this.conductoresRepository.update(id, updateData);
    const conductor = await this.conductoresRepository.findOne({ where: { id } });
    if (!conductor) throw new NotFoundException('Conductor no encontrado');
    return conductor;
  }

  async remove(id: string): Promise<void> {
    const result = await this.conductoresRepository.delete(id);
    if (result.affected === 0) {
      throw new NotFoundException('Conductor no encontrado');
    }
  }
}


============================================================
DIR: backend\src\empresa
============================================================


────────────────────────────────────────────────────────────
FILE: backend\src\empresa\empresa.controller.spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { EmpresaController } from './empresa.controller';

describe('EmpresaController', () => {
  let controller: EmpresaController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [EmpresaController],
    }).compile();

    controller = module.get<EmpresaController>(EmpresaController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});

────────────────────────────────────────────────────────────
FILE: backend\src\empresa\empresa.controller.ts
────────────────────────────────────────────────────────────

// backend/src/empresa/empresa.controller.ts
import { Controller, Get, Put, Body, UseGuards, Request } from '@nestjs/common';
import { EmpresaService } from './empresa.service';
import { JwtAuthGuard } from '../auth/jwt-auth.guard';
import { Empresa } from './empresa.entity';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Vehiculo } from '../vehiculos/vehiculo.entity';
import { Conductor } from '../conductores/conductor.entity';
import { Ruta } from '../rutas/ruta.entity';

@UseGuards(JwtAuthGuard)
@Controller('empresa')
export class EmpresaController {
  constructor(
    private readonly empresaService: EmpresaService,
    @InjectRepository(Vehiculo) private vehiculosRepo: Repository<Vehiculo>,
    @InjectRepository(Conductor) private conductoresRepo: Repository<Conductor>,
    @InjectRepository(Ruta) private rutasRepo: Repository<Ruta>,
  ) {}

  @Get('me')
  async getMyEmpresa(@Request() req) {
    const empresaId = req.user.empresaId;
    return this.empresaService.findOne(empresaId);
  }

  @Put()
  async updateMyEmpresa(@Request() req, @Body() updateData: Partial<Empresa>) {
    const empresaId = req.user.empresaId;
    return this.empresaService.update(empresaId, updateData);
  }

  @Get('summary')
  async summary(@Request() req) {
    const empresaId = req.user.empresaId;
    const [vehActivos, conductores, rutas] = await Promise.all([
      this.vehiculosRepo.count({ where: { empresaId, estado: 'activo' } }),
      this.conductoresRepo.count({ where: { empresaId } }),
      this.rutasRepo.count({ where: { empresaId } }),
    ]);
    // Para alertas, el frontend ya consulta /mantenimiento/alertas
    return {
      vehiculosActivos: vehActivos,
      conductores,
      rutas,
    };
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\empresa\empresa.entity.ts
────────────────────────────────────────────────────────────

// backend/src/empresa/empresa.entity.ts
import { Entity, PrimaryGeneratedColumn, Column, OneToOne, JoinColumn } from 'typeorm';
import { User } from '../users/user.entity';

@Entity('empresas')
export class Empresa {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column()
  nombre: string;

  @Column({ unique: true })
  nit: string;
  
  @Column()
  email: string;

  @Column({ nullable: true })
  telefono: string;

  @Column({ nullable: true })
  direccion: string;
  
  @Column({ nullable: true })
  logoUrl: string;

  // Relación: Una empresa está vinculada a un único usuario operador
  @Column()
  userId: string;

  @OneToOne(() => User)
  @JoinColumn({ name: 'userId' })
  user: User;
}

────────────────────────────────────────────────────────────
FILE: backend\src\empresa\empresa.module.ts
────────────────────────────────────────────────────────────

// backend/src/empresa/empresa.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { EmpresaController } from './empresa.controller';
import { EmpresaService } from './empresa.service';
import { Empresa } from './empresa.entity';
import { Vehiculo } from '../vehiculos/vehiculo.entity';
import { Conductor } from '../conductores/conductor.entity';
import { Ruta } from '../rutas/ruta.entity';

@Module({
  imports: [TypeOrmModule.forFeature([Empresa, Vehiculo, Conductor, Ruta])],
  controllers: [EmpresaController],
  providers: [EmpresaService],
  exports: [EmpresaService],
})
export class EmpresaModule {}

────────────────────────────────────────────────────────────
FILE: backend\src\empresa\empresa.service.spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { EmpresaService } from './empresa.service';

describe('EmpresaService', () => {
  let service: EmpresaService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [EmpresaService],
    }).compile();

    service = module.get<EmpresaService>(EmpresaService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});

────────────────────────────────────────────────────────────
FILE: backend\src\empresa\empresa.service.ts
────────────────────────────────────────────────────────────

// backend/src/empresa/empresa.service.ts
import { Injectable, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Empresa } from './empresa.entity';

@Injectable()
export class EmpresaService {
  constructor(
    @InjectRepository(Empresa)
    private empresaRepository: Repository<Empresa>,
  ) {}

  create(empresaData: Omit<Empresa, 'id' | 'user'>): Promise<Empresa> {
    const nuevaEmpresa = this.empresaRepository.create(empresaData);
    return this.empresaRepository.save(nuevaEmpresa);
  }

  async findOne(id: string): Promise<Empresa> {
    const empresa = await this.empresaRepository.findOne({ where: { id } });
    if (!empresa) {
      throw new NotFoundException(`Empresa con ID ${id} no encontrada.`);
    }
    return empresa;
  }

  async update(id: string, updateData: Partial<Empresa>): Promise<Empresa> {
    await this.empresaRepository.update(id, updateData);
    const updatedEmpresa = await this.findOne(id);
    return updatedEmpresa;
  }
}


============================================================
DIR: backend\src\horarios
============================================================


────────────────────────────────────────────────────────────
FILE: backend\src\horarios\horario.entity.ts
────────────────────────────────────────────────────────────

// backend/src/rutas/horario.entity.ts
import { Column, Entity, ManyToOne, PrimaryGeneratedColumn, JoinColumn } from 'typeorm';
import { Ruta } from '../rutas/ruta.entity';
import { Vehiculo } from '../vehiculos/vehiculo.entity';

const decimalTransformer = {
  to: (value: number) => value,
  from: (value: string | null) => (value == null ? null : parseFloat(value)),
};

@Entity('horarios')
export class Horario {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column()
  empresaId: string;

  @Column()
  rutaId: string;

  @ManyToOne(() => Ruta, (r) => r.horarios, { onDelete: 'CASCADE' })
  @JoinColumn({ name: 'rutaId' })
  ruta: Ruta;

  @Column()
  vehiculoId: string;

  @ManyToOne(() => Vehiculo)
  @JoinColumn({ name: 'vehiculoId' })
  vehiculo: Vehiculo;

  @Column({ type: 'jsonb', default: () => "'[]'" })
  dias: string[]; // ['Lunes','Martes',...]

  @Column()
  horaSalida: string; // HH:mm

  @Column('decimal', { precision: 10, scale: 2, transformer: decimalTransformer })
  tarifaGeneral: number;
}

────────────────────────────────────────────────────────────
FILE: backend\src\horarios\horarios.controller.ts
────────────────────────────────────────────────────────────

// backend/src/horarios/horarios.controller.ts
import {
  Body,
  Controller,
  Delete,
  Get,
  Param,
  Patch,
  Post,
  UseGuards,
  Req,
} from '@nestjs/common';
import { HorariosService } from './horarios.service';
import { JwtAuthGuard } from '../auth/jwt-auth.guard';

@Controller('horarios')
@UseGuards(JwtAuthGuard)
export class HorariosController {
  constructor(private readonly service: HorariosService) {}

  @Get()
  findAll(@Req() req: any) {
    return this.service.findAllByEmpresa(req.user.empresaId);
  }

  @Get(':id')
  findOne(@Param('id') id: string) {
    return this.service.findOne(id);
  }

  @Post()
  create(@Body() body: any, @Req() req: any) {
    if (!body.vehiculoId) {
      throw new Error('Debe seleccionar un vehículo');
    }
    return this.service.create({
      ...body,
      empresaId: req.user.empresaId,
    });
  }

  @Patch(':id')
  update(@Param('id') id: string, @Body() body: any) {
    return this.service.update(id, body);
  }

  @Delete(':id')
  remove(@Param('id') id: string) {
    return this.service.remove(id);
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\horarios\horarios.module.ts
────────────────────────────────────────────────────────────

import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { Horario } from './horario.entity';
import { HorariosController } from './horarios.controller';
import { HorariosService } from './horarios.service';

@Module({
  imports: [TypeOrmModule.forFeature([Horario])],
  controllers: [HorariosController],
  providers: [HorariosService],
  exports: [HorariosService],
})
export class HorariosModule {}

────────────────────────────────────────────────────────────
FILE: backend\src\horarios\horarios.service.ts
────────────────────────────────────────────────────────────

// backend/src/rutas/horarios.service.ts
import { Injectable, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Horario } from './horario.entity';

@Injectable()
export class HorariosService {
  constructor(
    @InjectRepository(Horario)
    private readonly repo: Repository<Horario>,
  ) {}

  findAll() {
    return this.repo.find({ order: { horaSalida: 'ASC' } });
  }

  findAllByEmpresa(empresaId: string) {
  return this.repo.find({
    where: { empresaId },
    relations: ['ruta', 'vehiculo'],
  });
}


  findByRuta(rutaId: string) {
    return this.repo.find({ where: { rutaId }, order: { horaSalida: 'ASC' } });
  }

  async findOne(id: string) {
    const h = await this.repo.findOne({ where: { id } });
    if (!h) throw new NotFoundException('Horario no encontrado');
    return h;
  }

  create(input: Partial<Horario>) {
    const h = this.repo.create(input);
    return this.repo.save(h);
  }

  async update(id: string, input: Partial<Horario>) {
    const h = await this.findOne(id);
    Object.assign(h, input);
    return this.repo.save(h);
  }

  async remove(id: string) {
    const h = await this.findOne(id);
    await this.repo.remove(h);
    return { success: true };
  }
}


============================================================
DIR: backend\src\mantenimiento
============================================================


────────────────────────────────────────────────────────────
FILE: backend\src\mantenimiento\mantenimiento.controller.ts
────────────────────────────────────────────────────────────

// backend/src/mantenimiento/mantenimiento.controller.ts
import { Controller, Get, UseGuards, Request } from '@nestjs/common';
import { JwtAuthGuard } from '../auth/jwt-auth.guard';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Vehiculo } from '../vehiculos/vehiculo.entity';

@UseGuards(JwtAuthGuard)
@Controller('mantenimiento')
export class MantenimientoController {
  constructor(
    @InjectRepository(Vehiculo) private vehiculosRepo: Repository<Vehiculo>,
  ) {}

  @Get('alertas')
  async alertas(@Request() req) {
    const vehiculos = await this.vehiculosRepo.find({ where: { empresaId: req.user.empresaId } });
    const hoy = new Date();
    const dias = (d1: Date, d2: Date) => Math.ceil((d1.getTime() - d2.getTime()) / (1000*60*60*24));

    const alertas = vehiculos.flatMap(v => {
      const venc = new Date(v.fechaUltimaRevision);
      // Próxima revisión a 180 días; alerta si faltan <= 7 días o si ya venció
      const proxima = new Date(venc);
      proxima.setDate(venc.getDate() + 180);
      const faltan = dias(proxima, hoy);
      if (faltan <= 7) {
        return [{
          id: `${v.id}-${proxima.toISOString().slice(0,10)}`,
          vehiculoId: v.id,
          vehiculoPatente: v.patente,
          mensaje: faltan < 0 ? 'Revisión técnica vencida' : 'Próxima revisión técnica',
          fechaVencimiento: proxima.toISOString().slice(0,10),
        }];
      }
      return [];
    });

    return alertas;
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\mantenimiento\mantenimiento.module.ts
────────────────────────────────────────────────────────────

// backend/src/mantenimiento/mantenimiento.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { MantenimientoController } from './mantenimiento.controller';
import { Vehiculo } from '../vehiculos/vehiculo.entity';

@Module({
  imports: [TypeOrmModule.forFeature([Vehiculo])],
  controllers: [MantenimientoController],
})
export class MantenimientoModule {}


============================================================
DIR: backend\src\reservas
============================================================


────────────────────────────────────────────────────────────
FILE: backend\src\reservas\reserva.entity.ts
────────────────────────────────────────────────────────────

// backend/src/reservas/reserva.entity.ts
import { Column, CreateDateColumn, Entity, Index, PrimaryGeneratedColumn, UpdateDateColumn } from 'typeorm';

@Entity('reservas')
@Index(['horarioId', 'fechaViaje', 'asientoNumero'])
export class Reserva {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column()
  usuarioId: string;

  @Column()
  horarioId: string;

  @Column({ type: 'date' })
  fechaViaje: string; // YYYY-MM-DD

  @Column('int')
  asientoNumero: number;

  @Column({ default: 'reservado' })
  estado: 'reservado' | 'pagado' | 'cancelado';

  @Column({ type: 'timestamp', nullable: true })
  expiresAt: Date | null;

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;
}

────────────────────────────────────────────────────────────
FILE: backend\src\reservas\reservas.controller.ts
────────────────────────────────────────────────────────────

// backend/src/reservas/reservas.controller.ts
import { Body, Controller, Get, Param, Post, Query } from '@nestjs/common';
import { ReservasService } from './reservas.service';

@Controller('reservas')
export class ReservasController {
  constructor(private readonly service: ReservasService) {}

  @Post()
  reservar(@Body() body: { usuarioId: string; horarioId: string; fechaViaje: string; asientoNumero: number }) {
    return this.service.reservar(body);
  }

  @Post(':id/confirmar-pago')
  confirmar(@Param('id') id: string) {
    return this.service.confirmarPago(id);
  }

  @Post(':id/cancelar')
  cancelar(@Param('id') id: string) {
    return this.service.cancelar(id);
  }

  @Get('ocupados')
  asientosOcupados(@Query('horarioId') horarioId: string, @Query('fechaViaje') fechaViaje: string) {
    return this.service.asientosOcupados(horarioId, fechaViaje);
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\reservas\reservas.module.ts
────────────────────────────────────────────────────────────

// backend/src/reservas/reservas.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { ReservasController } from './reservas.controller';
import { ReservasService } from './reservas.service';
import { Reserva } from './reserva.entity';
import { Horario } from '../horarios/horario.entity';
import { Vehiculo } from '../vehiculos/vehiculo.entity';

@Module({
  imports: [TypeOrmModule.forFeature([Reserva, Horario, Vehiculo])],
  controllers: [ReservasController],
  providers: [ReservasService],
  exports: [ReservasService]
})
export class ReservasModule {}

────────────────────────────────────────────────────────────
FILE: backend\src\reservas\reservas.service.ts
────────────────────────────────────────────────────────────

// backend/src/reservas/reservas.service.ts
import { Injectable, BadRequestException, ConflictException, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { DataSource, LessThan, MoreThan, Repository } from 'typeorm';
import { Reserva } from './reserva.entity';
import { Horario } from '../horarios/horario.entity';
import { Vehiculo } from '../vehiculos/vehiculo.entity';

const HOLD_MINUTES = 10;

@Injectable()
export class ReservasService {
  constructor(
    @InjectRepository(Reserva) private readonly reservasRepo: Repository<Reserva>,
    @InjectRepository(Horario) private readonly horariosRepo: Repository<Horario>,
    @InjectRepository(Vehiculo) private readonly vehiculosRepo: Repository<Vehiculo>,
    private readonly dataSource: DataSource,
  ) {}

  // Compatibilidad con SearchController
  encodeViajeId(horarioId: string, fecha: string): string {
    return Buffer.from(`${horarioId}|${fecha}`).toString('base64url');
  }

  decodeViajeId(viajeId: string): { horarioId: string; fecha: string } {
    try {
      const decoded = Buffer.from(viajeId, 'base64url').toString('utf8');
      const [horarioId, fecha] = decoded.split('|');
      if (!horarioId || !fecha) throw new Error();
      return { horarioId, fecha };
    } catch {
      throw new BadRequestException('viajeId inválido');
    }
  }

  async cleanupExpired() {
    await this.reservasRepo.update(
      { estado: 'reservado', expiresAt: LessThan(new Date()) },
      { estado: 'cancelado', expiresAt: null },
    );
  }

  async getSeats(viajeId: string) {
    const { horarioId, fecha } = this.decodeViajeId(viajeId);
    const horario = await this.horariosRepo.findOne({ where: { id: horarioId } });
    if (!horario) throw new BadRequestException('Horario no encontrado');
    const vehiculo = await this.vehiculosRepo.findOne({ where: { id: horario.vehiculoId } });
    if (!vehiculo) throw new BadRequestException('Vehículo no encontrado');

    const now = new Date();
    const reservas = await this.reservasRepo.find({
      where: [
        { horarioId, fechaViaje: fecha, estado: 'pagado' },
        { horarioId, fechaViaje: fecha, estado: 'reservado' },
      ],
    });

    const ocupados = new Set(
      reservas
        .filter((r) => r.estado === 'pagado' || (r.estado === 'reservado' && r.expiresAt && r.expiresAt.getTime() > now.getTime()))
        .map((r) => r.asientoNumero),
    );

    const seats = Array.from({ length: vehiculo.capacidad }).map((_, idx) => ({
      numero: idx + 1,
      estado: ocupados.has(idx + 1) ? 'ocupado' : 'disponible',
    }));

    return { capacidad: vehiculo.capacidad, seats };
  }

  async reserveSeats(viajeId: string, seatNumbers: number[], userId?: string) {
    const { horarioId, fecha } = this.decodeViajeId(viajeId);
    const now = new Date();
    const expiresAt = new Date(now.getTime() + HOLD_MINUTES * 60 * 1000);

    return this.dataSource.transaction(async (manager) => {
      const repo = manager.getRepository(Reserva);

      // Chequear conflictos
      for (const n of seatNumbers) {
        const conflict = await repo.findOne({
          where: [
            { horarioId, fechaViaje: fecha, asientoNumero: n, estado: 'pagado' },
            { horarioId, fechaViaje: fecha, asientoNumero: n, estado: 'reservado', expiresAt: MoreThan(now) },
          ],
          lock: { mode: 'pessimistic_read' },
        });
        if (conflict) {
          throw new ConflictException('Uno o más asientos ya fueron reservados.');
        }
      }

      // Insertar reservas
      const entities = seatNumbers.map((n) =>
        repo.create({
          usuarioId: userId || '',
          horarioId,
          fechaViaje: fecha,
          asientoNumero: n,
          estado: 'reservado',
          expiresAt,
        }),
      );
      await repo.insert(entities);
      return { ok: true, reserved: seatNumbers };
    });
  }

  async confirmarPago(reservaId: string) {
    const r = await this.reservasRepo.findOne({ where: { id: reservaId } });
    if (!r) throw new NotFoundException('Reserva no encontrada');
    if (r.estado === 'pagado') return r;
    if (r.estado === 'reservado' && r.expiresAt && r.expiresAt.getTime() < Date.now()) {
      throw new ConflictException('La reserva expiró');
    }
    r.estado = 'pagado';
    r.expiresAt = null;
    return this.reservasRepo.save(r);
  }
  // Aliases para compatibilidad con controladores antiguos:
async reservar(payload: { horarioId: string; fechaViaje: string; asientoNumero: number; usuarioId?: string }) {
  // Redirigimos al nuevo reserveSeats usando viajeId temporal
  const viajeId = this.encodeViajeId(payload.horarioId, payload.fechaViaje);
  return this.reserveSeats(viajeId, [payload.asientoNumero], payload.usuarioId);
}

async cancelar(reservaId: string) {
  const r = await this.reservasRepo.findOne({ where: { id: reservaId } });
  if (!r) throw new NotFoundException('Reserva no encontrada');
  r.estado = 'cancelado';
  r.expiresAt = null;
  return this.reservasRepo.save(r);
}

async asientosOcupados(horarioId: string, fecha: string): Promise<number[]> {
  const reservas = await this.reservasRepo.find({
    where: [
      { horarioId, fechaViaje: fecha, estado: 'pagado' },
      { horarioId, fechaViaje: fecha, estado: 'reservado' },
    ],
  });
  const now = new Date();
  return reservas
    .filter((r) => r.estado === 'pagado' || (r.expiresAt && r.expiresAt.getTime() > now.getTime()))
    .map((r) => r.asientoNumero);
}

}


============================================================
DIR: backend\src\rutas
============================================================


────────────────────────────────────────────────────────────
FILE: backend\src\rutas\ruta.entity.ts
────────────────────────────────────────────────────────────

// backend/src/rutas/ruta.entity.ts
import { Entity, PrimaryGeneratedColumn, Column, ManyToOne, JoinColumn, OneToMany } from 'typeorm';
import { Empresa } from '../empresa/empresa.entity';
import { Horario } from '../horarios/horario.entity';

export class Parada {
  id: string;
  nombre: string;
  lat: number;
  lng: number;
}

@Entity('rutas')
export class Ruta {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column()
  nombre: string;

  @Column()
  origen: string;

  @Column()
  destino: string;

  @Column({ type: 'jsonb', array: false, default: () => "'[]'" })
  paradas: Parada[];

  @Column()
  empresaId: string;

  @ManyToOne(() => Empresa)
  @JoinColumn({ name: 'empresaId' })
  empresa: Empresa;

  @OneToMany(() => Horario, (h) => h.ruta)
  horarios: Horario[];
}

────────────────────────────────────────────────────────────
FILE: backend\src\rutas\rutas.controller.spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { RutasController } from './rutas.controller';

describe('RutasController', () => {
  let controller: RutasController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [RutasController],
    }).compile();

    controller = module.get<RutasController>(RutasController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});

────────────────────────────────────────────────────────────
FILE: backend\src\rutas\rutas.controller.ts
────────────────────────────────────────────────────────────

// backend/src/rutas/rutas.controller.ts
import { Controller, Get, Post, Body, UseGuards, Request, Put, Param } from '@nestjs/common';
import { RutasService } from './rutas.service';
import { Ruta } from './ruta.entity';
import { JwtAuthGuard } from '../auth/jwt-auth.guard';

@UseGuards(JwtAuthGuard)
@Controller('rutas')
export class RutasController {
  constructor(private readonly rutasService: RutasService) {}

  @Get()
  async findByEmpresa(@Request() req): Promise<Ruta[]> {
    const empresaId = req.user.empresaId;
    return this.rutasService.findByEmpresaId(empresaId);
  }

  @Post()
  async create(@Request() req, @Body() rutaData: Omit<Ruta, 'id' | 'empresa' | 'empresaId'>): Promise<Ruta> {
    const empresaId = req.user.empresaId;
    return this.rutasService.create({ ...rutaData, empresaId });
  }

  @Put(':id')
  async update(@Request() req, @Param('id') id: string, @Body() data: Partial<Ruta>): Promise<Ruta> {
    // Opcional: validar empresaId del recurso si quieres reforzar multi-tenant
    return this.rutasService.update(id, data);
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\rutas\rutas.module.ts
────────────────────────────────────────────────────────────

// backend/src/rutas/rutas.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { RutasController } from './rutas.controller';
import { RutasService } from './rutas.service';
import { Ruta } from './ruta.entity';
import { Horario } from '../horarios/horario.entity';
import { HorariosService } from '../horarios/horarios.service';
import { HorariosController } from '../horarios/horarios.controller';

@Module({
  imports: [TypeOrmModule.forFeature([Ruta, Horario])],
  controllers: [RutasController, HorariosController],
  providers: [RutasService, HorariosService],
  exports: [TypeOrmModule],
})
export class RutasModule {}

────────────────────────────────────────────────────────────
FILE: backend\src\rutas\rutas.service.spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { RutasService } from './rutas.service';

describe('RutasService', () => {
  let service: RutasService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [RutasService],
    }).compile();

    service = module.get<RutasService>(RutasService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});

────────────────────────────────────────────────────────────
FILE: backend\src\rutas\rutas.service.ts
────────────────────────────────────────────────────────────

// backend/src/rutas/rutas.service.ts
import { Injectable, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Ruta } from './ruta.entity';

@Injectable()
export class RutasService {
  constructor(
    @InjectRepository(Ruta)
    private rutasRepository: Repository<Ruta>,
  ) {}

  findByEmpresaId(empresaId: string): Promise<Ruta[]> {
    return this.rutasRepository.find({ where: { empresaId } });
  }

  create(rutaData: Omit<Ruta, 'id' | 'empresa'>): Promise<Ruta> {
    const nuevaRuta = this.rutasRepository.create(rutaData);
    return this.rutasRepository.save(nuevaRuta);
  }

  async update(id: string, updateData: Partial<Ruta>): Promise<Ruta> {
    await this.rutasRepository.update(id, updateData);
    const ruta = await this.rutasRepository.findOne({ where: { id } });
    if (!ruta) throw new NotFoundException('Ruta no encontrada');
    return ruta;
  }
}


============================================================
DIR: backend\src\search
============================================================


────────────────────────────────────────────────────────────
FILE: backend\src\search\search.controller.ts
────────────────────────────────────────────────────────────

import { Controller, Get, Query } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository, In } from 'typeorm';
import { Ruta } from '../rutas/ruta.entity';
import { Horario } from '../horarios/horario.entity';
import { Empresa } from '../empresa/empresa.entity';
import { Vehiculo } from '../vehiculos/vehiculo.entity';
import { ReservasService } from '../reservas/reservas.service';

const CITY_NAMES: Record<string, string> = {
  LPB: 'La Paz', CBB: 'Cochabamba', SRZ: 'Santa Cruz', SRE: 'Sucre', PSI: 'Potosí', ORU: 'Oruro', TJA: 'Tarija'
};

function dayName(dateStr: string): string {
  const d = new Date(dateStr + 'T00:00:00'); // Force local time parsing
  const names = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
  return names[d.getDay()];
}

@Controller('search')
export class SearchController {
  constructor(
    @InjectRepository(Ruta) private rutasRepo: Repository<Ruta>,
    @InjectRepository(Horario) private horariosRepo: Repository<Horario>,
    @InjectRepository(Empresa) private empresaRepo: Repository<Empresa>,
    @InjectRepository(Vehiculo) private vehiculoRepo: Repository<Vehiculo>,
    private reservasService: ReservasService,
  ) { }

  @Get('trips')
  async searchTrips(
    @Query('origen') origen?: string,
    @Query('destino') destino?: string,
    @Query('fecha') fecha?: string,
  ) {
    // Si no hay fecha, usamos la fecha de hoy por defecto
    const targetDate = fecha || new Date().toISOString().split('T')[0];
    const dia = dayName(targetDate);

    // Construir query dinámica para rutas
    const whereRuta: any = {};
    if (origen) whereRuta.origen = origen;
    if (destino) whereRuta.destino = destino;

    const rutas = await this.rutasRepo.find({ where: whereRuta });
    if (rutas.length === 0) return [];

    // Buscar horarios asociados a esas rutas
    const horarios = await this.horariosRepo.find({
      where: { rutaId: In(rutas.map(r => r.id)) },
      order: { horaSalida: 'ASC' }
    });

    // Filtrar por día de la semana (Lógica recurrente básica)
    // Nota: En un sistema real avanzado, aquí consultarías una tabla de 'Viajes Generados'
    const filtrados = horarios.filter(h => (h.dias || []).includes(dia));

    if (filtrados.length === 0) return [];

    const empresas = await this.empresaRepo.findByIds(filtrados.map(h => h.empresaId));
    const empresaById = new Map(empresas.map(e => [e.id, e]));
    const vehiculos = await this.vehiculoRepo.findByIds(filtrados.map(h => h.vehiculoId));
    const vehiculoById = new Map(vehiculos.map(v => [v.id, v]));

    return Promise.all(filtrados.map(async h => {
      const ruta = rutas.find(r => r.id === h.rutaId)!;
      const emp = empresaById.get(h.empresaId);
      const veh = vehiculoById.get(h.vehiculoId);
      const viajeId = this.reservasService.encodeViajeId(h.id, targetDate);

      // Calcular asientos disponibles reales
      const ocupados = await this.reservasService.asientosOcupados(h.id, targetDate);
      const capacidad = veh ? veh.capacidad : 0;
      const disponibles = Math.max(0, capacidad - ocupados.length);

      return {
        id: viajeId, // Token único para reservar fecha específica
        scheduleId: h.id,
        origen: { id: ruta.origen, nombre: CITY_NAMES[ruta.origen] || ruta.origen },
        destino: { id: ruta.destino, nombre: CITY_NAMES[ruta.destino] || ruta.destino },
        fecha: targetDate,
        horaSalida: h.horaSalida,
        empresa: emp?.nombre || 'Empresa',
        logoEmpresa: emp?.logoUrl || '',
        precio: Number(h.tarifaGeneral),
        tipoBus: veh ? veh.modelo : 'Estándar',
        disponibles: disponibles,
        capacidad: capacidad,
        duracionEstimada: '8h' // Podría venir de la ruta
      };
    }));
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\search\search.module.ts
────────────────────────────────────────────────────────────

// backend/src/search/search.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { SearchController } from './search.controller';
import { Ruta } from '../rutas/ruta.entity';
import { Horario } from '../horarios/horario.entity';
import { Empresa } from '../empresa/empresa.entity';
import { Vehiculo } from '../vehiculos/vehiculo.entity';
import { ReservasModule } from '../reservas/reservas.module';

@Module({
  imports: [TypeOrmModule.forFeature([Ruta, Horario, Empresa, Vehiculo]), ReservasModule],
  controllers: [SearchController],
})
export class SearchModule {}


============================================================
DIR: backend\src\users
============================================================


────────────────────────────────────────────────────────────
FILE: backend\src\users\user.entity.ts
────────────────────────────────────────────────────────────


import { Entity, PrimaryGeneratedColumn, Column } from 'typeorm';

@Entity('users') // Le dice a TypeORM que esta clase define una tabla llamada 'users'
export class User {
  @PrimaryGeneratedColumn('uuid') // Genera un ID único y universal
  id: string;

  @Column()
  nombre: string;

  @Column({ unique: true }) // El email debe ser único
  email: string;

  @Column()
  contrasena: string; // En un proyecto real, esto debería estar encriptado

  @Column()
  role: string; // 'user' o 'operador'

  @Column({ nullable: true }) // Puede ser nulo para los clientes
  empresaId: string;
}

────────────────────────────────────────────────────────────
FILE: backend\src\users\users.controller.spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { UsersController } from './users.controller';

describe('UsersController', () => {
  let controller: UsersController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [UsersController],
    }).compile();

    controller = module.get<UsersController>(UsersController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});

────────────────────────────────────────────────────────────
FILE: backend\src\users\users.controller.ts
────────────────────────────────────────────────────────────

// >>> backend/src/users/users.controller.ts

import { Controller, Post, Body, UseGuards, Request } from '@nestjs/common';
import { UsersService, RegisterOperatorDto, RegisterUserDto } from './users.service'; // Asegúrate que RegisterUserDto esté importado
import { LocalAuthGuard } from '../auth/local-auth.guard';
import { AuthService } from '../auth/auth.service';

@Controller()
export class UsersController {
  constructor(
      private readonly usersService: UsersService,
      private readonly authService: AuthService,
    ) {}

  @Post('auth/register')
  // LA CORRECCIÓN ESTÁ EN ESTA LÍNEA: "RegisterUserDto" en lugar de "RegisterUser-Dto"
  async register(@Body() userData: RegisterOperatorDto | RegisterUserDto) {
    // 1. Creamos el usuario como antes.
    const user = await this.usersService.create(userData);
    
    // 2. Usamos el AuthService para generar un token para este nuevo usuario.
    // Esto es lo que hará el login automático de forma segura en el backend.
    return this.authService.login(user);
  }

  @UseGuards(LocalAuthGuard)
  @Post('auth/login')
  async login(@Request() req: any) {
    // Esta función no cambia, sigue funcionando para el login manual.
    return this.authService.login(req.user);
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\users\users.module.ts
────────────────────────────────────────────────────────────

// backend/src/users/users.module.ts

// 1. Importar forwardRef desde @nestjs/common
import { Module, forwardRef } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { UsersController } from './users.controller';
import { UsersService } from './users.service';
import { User } from './user.entity';
import { EmpresaModule } from '../empresa/empresa.module';
// 2. Importar el módulo que necesitamos
import { AuthModule } from '../auth/auth.module'; 

@Module({
  // 3. Añadir AuthModule envuelto en forwardRef a los imports
  imports: [
    TypeOrmModule.forFeature([User]), 
    EmpresaModule,
    forwardRef(() => AuthModule), // <-- ¡AQUÍ ESTÁ LA SOLUCIÓN!
  ],
  controllers: [UsersController],
  providers: [UsersService],
  exports: [UsersService],
})
export class UsersModule {}

────────────────────────────────────────────────────────────
FILE: backend\src\users\users.service.spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { UsersService } from './users.service';

describe('UsersService', () => {
  let service: UsersService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [UsersService],
    }).compile();

    service = module.get<UsersService>(UsersService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});

────────────────────────────────────────────────────────────
FILE: backend\src\users\users.service.ts
────────────────────────────────────────────────────────────

// >>> backend/src/users/users.service.ts

import { Injectable, ConflictException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { User } from './user.entity';
import { EmpresaService } from '../empresa/empresa.service';
import * as bcrypt from 'bcrypt';

export interface RegisterOperatorDto {
  nombre: string;
  email: string;
  contrasena: string;
  role: 'operador';
  nit: string;
}

export interface RegisterUserDto {
  nombre: string;
  email: string;
  contrasena: string;
  role: 'user';
}

@Injectable()
export class UsersService {
  constructor(
    @InjectRepository(User)
    private usersRepository: Repository<User>,
    private readonly empresaService: EmpresaService,
  ) {}

  async create(userData: RegisterUserDto | RegisterOperatorDto): Promise<User> {
    const email = userData.email.toLowerCase();
    const existingUser = await this.findOneByEmail(email);
    if (existingUser) {
      throw new ConflictException('El correo electrónico ya está registrado.');
    }

    const hashedPassword = await bcrypt.hash(userData.contrasena, 10);

    if (userData.role === 'operador') {
      const newUserEntity = this.usersRepository.create({
        nombre: userData.nombre,
        email,
        contrasena: hashedPassword,
        role: userData.role,
      });
      const savedUser = await this.usersRepository.save(newUserEntity);
      
      const empresa = await this.empresaService.create({
        nombre: userData.nombre,
        nit: userData.nit,
        email,
        userId: savedUser.id,
        telefono: '',
        direccion: '',
        logoUrl: '',
      });

      savedUser.empresaId = empresa.id;
      return this.usersRepository.save(savedUser);

    } else {
      const newUserEntity = this.usersRepository.create({ ...userData, email, contrasena: hashedPassword });
      return this.usersRepository.save(newUserEntity);
    }
  }

  // CORRECCIÓN: Cambiado el tipo de retorno a Promise<User | null>
  async findOneByEmail(email: string): Promise<User | null> {
    return this.usersRepository.findOne({ where: { email: email.toLowerCase() } });
  }
}


============================================================
DIR: backend\src\vehiculos
============================================================


────────────────────────────────────────────────────────────
FILE: backend\src\vehiculos\vehiculo.entity.ts
────────────────────────────────────────────────────────────

// backend/src/vehiculos/vehiculo.entity.ts
import { Entity, PrimaryGeneratedColumn, Column, ManyToOne, JoinColumn, Unique, BeforeInsert, BeforeUpdate } from 'typeorm';
import { Empresa } from '../empresa/empresa.entity';

@Entity('vehiculos')
@Unique(['patente'])
export class Vehiculo {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column({ length: 16, unique: true })
  patente: string;

  @Column()
  modelo: string;

  @Column('int')
  capacidad: number;

  @Column({ default: 'activo' })
  estado: 'activo' | 'inactivo' | 'mantenimiento';

  @Column()
  fechaUltimaRevision: string;

  @Column()
  empresaId: string;

  @ManyToOne(() => Empresa)
  @JoinColumn({ name: 'empresaId' })
  empresa: Empresa;

  @BeforeInsert()
  @BeforeUpdate()
  normalize() {
    if (this.patente) this.patente = this.patente.trim().toUpperCase();
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\vehiculos\vehiculos.controller.spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { VehiculosController } from './vehiculos.controller';

describe('VehiculosController', () => {
  let controller: VehiculosController;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [VehiculosController],
    }).compile();

    controller = module.get<VehiculosController>(VehiculosController);
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });
});

────────────────────────────────────────────────────────────
FILE: backend\src\vehiculos\vehiculos.controller.ts
────────────────────────────────────────────────────────────

// backend/src/vehiculos/vehiculos.controller.ts
import { Body, Controller, Delete, Get, Param, Patch, Post, UseGuards, Req } from '@nestjs/common';
import { VehiculosService } from './vehiculos.service';
import { Vehiculo } from './vehiculo.entity';
import { JwtAuthGuard } from '../auth/jwt-auth.guard';

@Controller('vehiculos')
@UseGuards(JwtAuthGuard)
export class VehiculosController {
  constructor(private readonly service: VehiculosService) {}

  @Get()
  findAll(@Req() req: any) {
    return this.service.findAllByEmpresa(req.user.empresaId);
  }

  @Get(':id')
  findOne(@Param('id') id: string) {
    return this.service.findOne(id);
  }

  @Post()
  create(@Body() body: Partial<Vehiculo>, @Req() req: any) {
    return this.service.create({ ...body, empresaId: req.user.empresaId });
  }

  @Patch(':id')
  update(@Param('id') id: string, @Body() body: Partial<Vehiculo>) {
    return this.service.update(id, body);
  }

  @Delete(':id')
  remove(@Param('id') id: string) {
    return this.service.remove(id);
  }
}

────────────────────────────────────────────────────────────
FILE: backend\src\vehiculos\vehiculos.module.ts
────────────────────────────────────────────────────────────

// backend/src/vehiculos/vehiculos.module.ts
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { VehiculosController } from './vehiculos.controller';
import { VehiculosService } from './vehiculos.service';
import { Vehiculo } from './vehiculo.entity';

@Module({
  imports: [TypeOrmModule.forFeature([Vehiculo])],
  controllers: [VehiculosController],
  providers: [VehiculosService],
})
export class VehiculosModule {}

────────────────────────────────────────────────────────────
FILE: backend\src\vehiculos\vehiculos.service.spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { VehiculosService } from './vehiculos.service';

describe('VehiculosService', () => {
  let service: VehiculosService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [VehiculosService],
    }).compile();

    service = module.get<VehiculosService>(VehiculosService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });
});

────────────────────────────────────────────────────────────
FILE: backend\src\vehiculos\vehiculos.service.ts
────────────────────────────────────────────────────────────

// backend/src/vehiculos/vehiculos.service.ts
import { ConflictException, Injectable, NotFoundException } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Vehiculo } from './vehiculo.entity';

@Injectable()
export class VehiculosService {
  constructor(
    @InjectRepository(Vehiculo)
    private readonly repo: Repository<Vehiculo>,
  ) {}

  findAll() {
    return this.repo.find();
  }
  
  findAllByEmpresa(empresaId: string) {
  return this.repo.find({ where: { empresaId } });
}


  async findOne(id: string) {
    const v = await this.repo.findOne({ where: { id } });
    if (!v) throw new NotFoundException('Vehículo no encontrado');
    return v;
  }

  async create(input: Partial<Vehiculo>) {
    try {
      const v = this.repo.create(input);
      return await this.repo.save(v);
    } catch (e: any) {
      // MySQL/MariaDB ER_DUP_ENTRY, PostgreSQL 23505
      if (e.code === 'ER_DUP_ENTRY' || e.code === '23505') {
        throw new ConflictException('Matrícula ya registrada');
      }
      throw e;
    }
  }

  async update(id: string, input: Partial<Vehiculo>) {
    const v = await this.findOne(id);
    Object.assign(v, input);
    try {
      return await this.repo.save(v);
    } catch (e: any) {
      if (e.code === 'ER_DUP_ENTRY' || e.code === '23505') {
        throw new ConflictException('Matrícula ya registrada');
      }
      throw e;
    }
  }

  async remove(id: string) {
    const v = await this.findOne(id);
    await this.repo.remove(v);
    return { success: true };
  }
}


============================================================
DIR: backend\test
============================================================


────────────────────────────────────────────────────────────
FILE: backend\test\app.e2e-spec.ts
────────────────────────────────────────────────────────────

import { Test, TestingModule } from '@nestjs/testing';
import { INestApplication } from '@nestjs/common';
import * as request from 'supertest';
import { App } from 'supertest/types';
import { AppModule } from './../src/app.module';

describe('AppController (e2e)', () => {
  let app: INestApplication<App>;

  beforeEach(async () => {
    const moduleFixture: TestingModule = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    await app.init();
  });

  it('/ (GET)', () => {
    return request(app.getHttpServer())
      .get('/')
      .expect(200)
      .expect('Hello World!');
  });
});


============================================================
DIR: src
============================================================


────────────────────────────────────────────────────────────
FILE: src\App.tsx
────────────────────────────────────────────────────────────

import React from 'react';
import { HashRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import { AuthProvider, useAuth } from './contexts/AuthContext';
import ProtectedRoute from './components/ProtectedRoute';

// Layouts
import PublicLayout from './layouts/PublicLayout';
import OperatorLayout from './layouts/OperatorLayout';

// Public Pages
import HomePage from './pages/HomePage';
import SearchResultsPage from './pages/SearchResultsPage';
import LoginPage from './pages/LoginPage';
import RegisterPage from './pages/RegisterPage';
import OperadorLoginPage from './pages/operador/LoginPage';
import OperadorRegisterPage from './pages/operador/RegisterPage';

// Client Pages
import SeatSelectionPage from './pages/SeatSelectionPage.tsx';
import ConfirmationPage from './pages/ConfirmationPage.tsx';

// Operator Pages
import DashboardPage from './pages/operator/DashboardPage';
import RoutesPage from './pages/operator/RoutesPage';
import SchedulesPage from './pages/operator/SchedulesPage';
import FleetPage from './pages/operator/FleetPage';
import DriversPage from './pages/operator/DriversPage';
import MaintenancePage from './pages/operator/MaintenancePage';
import CompanyProfilePage from './pages/operator/CompanyProfilePage';

const App: React.FC = () => {
  return (
    <Router>
      <AuthProvider>
        <Routes>
          {/* Public Routes */}
          <Route element={<PublicLayout />}>
            <Route path="/" element={<HomePage />} />
            <Route path="/search" element={<SearchResultsPage />} />
            <Route path="/login" element={<LoginPage />} />
            <Route path="/register" element={<RegisterPage />} />
            <Route path="/operador/login" element={<OperadorLoginPage />} />
            <Route path="/operador/register" element={<OperadorRegisterPage />} />

            {/* Client Booking Flow */}
            <Route path="/seleccionar-asientos" element={<SeatSelectionPage />} />
            <Route path="/confirmacion" element={<ConfirmationPage />} />
          </Route>

          {/* Operator Routes - Protected */}
          <Route
            path="/operador"
            element={
              <ProtectedRoute requiredRole="operador">
                <OperatorLayout />
              </ProtectedRoute>
            }
          >
            <Route index element={<DashboardPage />} />
            <Route path="rutas" element={<RoutesPage />} />
            <Route path="horarios" element={<SchedulesPage />} />
            <Route path="vehiculos" element={<FleetPage />} />
            <Route path="conductores" element={<DriversPage />} />
            <Route path="mantenimiento" element={<MaintenancePage />} />
            <Route path="perfil" element={<CompanyProfilePage />} />
          </Route>

          {/* Fallback */}
          <Route path="*" element={<Navigate to="/" replace />} />
        </Routes>
      </AuthProvider>
    </Router>
  );
};

export default App;

────────────────────────────────────────────────────────────
FILE: src\constants.ts
────────────────────────────────────────────────────────────


import { Ciudad, Viaje, EstadoAsiento, Asiento } from './types';

export const CIUDADES: Ciudad[] = [
  { id: 'LPB', nombre: 'La Paz' },
  { id: 'CBB', nombre: 'Cochabamba' },
  { id: 'SRZ', nombre: 'Santa Cruz' },
  { id: 'SRE', nombre: 'Sucre' },
  { id: 'PSI', nombre: 'Potosí' },
  { id: 'ORU', nombre: 'Oruro' },
  { id: 'TJA', nombre: 'Tarija' },
];

const generarAsientos = (): Asiento[] => {
    const asientos: Asiento[] = [];
    const filas = 12;
    const asientosPorFila = 4;
    for (let i = 1; i <= filas; i++) {
        for (let j = 1; j <= asientosPorFila; j++) {
            const numero = (i - 1) * asientosPorFila + j;
            asientos.push({
                id: `P1-${numero}`,
                numero: numero,
                piso: 1,
                estado: Math.random() > 0.7 ? EstadoAsiento.Ocupado : EstadoAsiento.Disponible,
            });
        }
    }
    return asientos;
};

export const VIAJES_DISPONIBLES: Viaje[] = [
  {
    id: '1',
    origen: CIUDADES[0], // La Paz
    destino: CIUDADES[1], // Cochabamba
    fecha: '2024-08-15',
    horaSalida: '20:00',
    horaLlegada: '04:00',
    empresa: 'Trans Copacabana',
    logoEmpresa: 'https://picsum.photos/seed/copa/40/40',
    precio: 120,
    tipoBus: 'Bus Cama',
    asientos: generarAsientos(),
  },
  {
    id: '2',
    origen: CIUDADES[0], // La Paz
    destino: CIUDADES[1], // Cochabamba
    fecha: '2024-08-15',
    horaSalida: '21:30',
    horaLlegada: '05:30',
    empresa: 'Bolivar',
    logoEmpresa: 'https://picsum.photos/seed/bolivar/40/40',
    precio: 110,
    tipoBus: 'Semicama',
    asientos: generarAsientos(),
  },
  {
    id: '3',
    origen: CIUDADES[1], // Cochabamba
    destino: CIUDADES[2], // Santa Cruz
    fecha: '2024-08-16',
    horaSalida: '19:00',
    horaLlegada: '06:00',
    empresa: 'El Dorado',
    logoEmpresa: 'https://picsum.photos/seed/dorado/40/40',
    precio: 150,
    tipoBus: 'Bus Cama',
    asientos: generarAsientos(),
  },
];
//export const API_BASE = 'http://localhost:3000';
export const API_BASE = '/api'; // Ruta relativa para el proxy

────────────────────────────────────────────────────────────
FILE: src\index.css
────────────────────────────────────────────────────────────

@import "tailwindcss";

@theme {
    /* Paleta Sólida y Profesional */
    --color-primary-50: #f0f9ff;
    --color-primary-100: #e0f2fe;
    --color-primary-500: #0ea5e9;
    --color-primary-600: #0284c7;
    /* Azul corporativo */
    --color-primary-700: #0369a1;

    --color-secondary-500: #f97316;
    /* Naranja acción */
    --color-secondary-600: #ea580c;

    --font-family-sans: 'Inter', system-ui, sans-serif;
}

@layer components {
    .btn-primary {
        @apply bg-primary-600 hover:bg-primary-700 text-white font-semibold py-3 px-6 rounded-lg transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2 cursor-pointer;
    }

    .btn-secondary {
        @apply bg-white border border-gray-300 hover:bg-gray-50 text-gray-800 font-semibold py-3 px-6 rounded-lg transition-all shadow-sm flex items-center justify-center gap-2 cursor-pointer;
    }

    .card {
        @apply bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden;
    }

    /* Corrección de inputs transparentes: Fondo blanco explícito */
    .input-field {
        @apply w-full p-3 bg-white border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all placeholder-gray-400;
    }

    /* Corrección para selects */
    select.input-field {
        @apply bg-white text-gray-900;
    }
}

@layer base {
    body {
        @apply bg-gray-100 text-gray-900 antialiased;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        @apply font-bold text-gray-900 tracking-tight;
    }
}

────────────────────────────────────────────────────────────
FILE: src\index.tsx
────────────────────────────────────────────────────────────


import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './App';

const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("No se pudo encontrar el elemento raíz para montar la aplicación.");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

────────────────────────────────────────────────────────────
FILE: src\types.ts
────────────────────────────────────────────────────────────

// types.ts

export interface Ciudad {
  id: string;
  nombre: string;
}

export interface Viaje {
  id: string; // viajeId (base64url de horarioId|fecha)
  origen: Ciudad;
  destino: Ciudad;
  fecha: string;
  horaSalida: string;
  horaLlegada?: string;
  empresa: string;
  logoEmpresa: string;
  precio: number;
  tipoBus: string;
  asientos?: Asiento[];
}

export enum EstadoAsiento {
  Disponible = 'disponible',
  Ocupado = 'ocupado',
  Seleccionado = 'seleccionado',
}

export interface Asiento {
  id: string;
  numero: number;
  piso: number;
  estado: EstadoAsiento;
}

export interface User {
  id: string;
  nombre: string;
  email: string;
  role: 'user' | 'operador' | 'super-admin';
  empresaId?: string;
}

// Operador

export interface Empresa {
  id: string;
  userId: string;
  nit: string;
  nombre: string;
  logoUrl: string;
  telefono: string;
  email: string;
  direccion: string;
}

export interface Vehiculo {
  id: string;
  empresaId: string;
  patente: string;
  modelo: string;
  capacidad: number;
  estado: 'activo' | 'inactivo' | 'mantenimiento';
  fechaUltimaRevision: string;
}

export interface Conductor {
  id: string;
  empresaId: string;
  nombre: string;
  cedula: string;
  tipoLicencia: 'A' | 'B' | 'C' | 'P';
  vencimientoLicencia: string;
  estado: 'activo' | 'inactivo';
}

export interface Parada {
  id: string;
  nombre: string;
  lat: number;
  lng: number;
}

export interface Ruta {
  id: string;
  empresaId: string;
  nombre: string;
  origen: string;
  destino: string;
  paradas: Parada[];
}

export interface Horario {
  id: string;
  empresaId: string;
  rutaId: string;
  vehiculoId: string;
  dias: ('Lunes' | 'Martes' | 'Miércoles' | 'Jueves' | 'Viernes' | 'Sábado' | 'Domingo')[];
  horaSalida: string;
  tarifaGeneral: number;
}

export interface AlertaMantenimiento {
  id: string;
  vehiculoId: string;
  vehiculoPatente: string;
  mensaje: string;
  fechaVencimiento: string;
}


============================================================
DIR: src\components
============================================================


────────────────────────────────────────────────────────────
FILE: src\components\AIAssistant.tsx
────────────────────────────────────────────────────────────

import React, { useState } from 'react';
import { obtenerSugerenciaDeViaje } from '../services/geminiService';

const apiKey = process.env.API_KEY;

const AIAssistant: React.FC = () => {
  const [pregunta, setPregunta] = useState('');
  const [respuesta, setRespuesta] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');

  if (!apiKey) {
    return null;
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!pregunta.trim()) {
      setError('Por favor, ingresa una pregunta.');
      return;
    }
    setIsLoading(true);
    setError('');
    setRespuesta('');
    try {
      const result = await obtenerSugerenciaDeViaje(pregunta);
      setRespuesta(result);
    } catch (err) {
      setError('Ocurrió un error al obtener la respuesta.');
      console.error(err);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="bg-primary/5 border-l-4 border-primary-light p-6 rounded-lg mt-12">
      <div className="flex items-start gap-4">
        <div className="flex-shrink-0">
         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-8 h-8 text-primary">
            <path fillRule="evenodd" d="M9.315 7.585a.75.75 0 0 1 .369-.632l4.25-2.5a.75.75 0 0 1 .913.632v5.408a.75.75 0 0 1-.22.53l-2.073 2.073a.75.75 0 0 1-1.06 0L9.47 13.28a.75.75 0 0 1-.22-.53V7.585Z" clipRule="evenodd" />
            <path d="M11.963 18.97a.75.75 0 0 1-1.06-1.06l1.06-1.061a.75.75 0 0 1 1.06 1.06l-1.06 1.06Z" />
            <path d="M14.038 18.97a.75.75 0 0 1-1.06-1.06l1.06-1.06a.75.75 0 0 1 1.06 1.06l-1.06 1.06Z" />
            <path d="M12 20.25a.75.75 0 0 1-.75-.75v-2.25a.75.75 0 0 1 1.5 0v2.25a.75.75 0 0 1-.75-.75Z" />
            <path fillRule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM3.75 12a8.25 8.25 0 1 1 16.5 0 8.25 8.25 0 0 1-16.5 0Z" clipRule="evenodd" />
          </svg>
        </div>
        <div>
            <h3 className="text-lg font-bold text-primary">Asistente de Viaje IA</h3>
            <p className="text-sm text-text-muted mb-4">¿No sabes a dónde ir? ¡Pregúntame! Ej: "Actividades para 3 días en Sucre".</p>
            <form onSubmit={handleSubmit} className="flex flex-col sm:flex-row gap-2">
                <input
                type="text"
                value={pregunta}
                onChange={(e) => setPregunta(e.target.value)}
                placeholder="Escribe tu pregunta aquí..."
                className="w-full flex-grow p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
                disabled={isLoading}
                />
                <button type="submit" disabled={isLoading} className="bg-primary hover:bg-primary-dark text-white font-bold py-2 px-4 rounded-lg transition-colors disabled:bg-gray-400">
                {isLoading ? 'Pensando...' : 'Preguntar'}
                </button>
            </form>
            {error && <p className="text-accent mt-2 text-sm">{error}</p>}
        </div>
      </div>

      {isLoading && (
        <div className="mt-4 p-4 text-center">
            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"></div>
            <p className="text-text-muted mt-2">Buscando las mejores ideas para ti...</p>
        </div>
      )}

      {respuesta && (
        <div className="mt-4 p-4 bg-surface rounded-lg">
          <p className="text-text whitespace-pre-wrap font-sans">{respuesta}</p>
        </div>
      )}
    </div>
  );
};

export default AIAssistant;

────────────────────────────────────────────────────────────
FILE: src\components\ErrorBoundary.tsx
────────────────────────────────────────────────────────────

// components/ErrorBoundary.tsx
import React, { ErrorInfo, ReactNode } from 'react';

type ErrorBoundaryProps = {
  children: ReactNode;
};

type ErrorBoundaryState = {
  hasError: boolean;
};

export class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {
  // Definir explícitamente state y props
  state: ErrorBoundaryState;
  props: ErrorBoundaryProps;

  constructor(props: ErrorBoundaryProps) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(_: unknown): ErrorBoundaryState {
    return { hasError: true };
  }

  componentDidCatch(error: unknown, info: ErrorInfo) {
    console.error('ErrorBoundary atrapó un error:', error, info);
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="p-4">
          <h3 className="text-lg font-semibold mb-2">Ocurrió un error al renderizar.</h3>
        </div>
      );
    }

    return this.props.children;
  }
}

────────────────────────────────────────────────────────────
FILE: src\components\Footer.tsx
────────────────────────────────────────────────────────────

import React from 'react';
import { Link } from 'react-router-dom';

const Footer: React.FC = () => {
    return (
        <footer className="bg-gray-900 text-gray-300 mt-auto">
            <div className="container mx-auto px-4 py-12">
                <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <div>
                        <h3 className="text-white font-bold text-lg mb-4">TranspoBolivia</h3>
                        <p className="text-sm">Tu plataforma confiable para viajar por Bolivia.</p>
                    </div>
                    <div>
                        <h4 className="text-white font-semibold mb-4">Enlaces Rápidos</h4>
                        <ul className="space-y-2 text-sm">
                            <li><Link to="/" className="hover:text-white transition-colors">Inicio</Link></li>
                            <li><Link to="/search" className="hover:text-white transition-colors">Buscar Pasajes</Link></li>
                            <li><Link to="/operador/login" className="hover:text-white transition-colors">Portal Empresas</Link></li>
                        </ul>
                    </div>
                    <div>
                        <h4 className="text-white font-semibold mb-4">Información</h4>
                        <ul className="space-y-2 text-sm">
                            <li><a href="#" className="hover:text-white transition-colors">Términos y Condiciones</a></li>
                            <li><a href="#" className="hover:text-white transition-colors">Política de Privacidad</a></li>
                            <li><a href="#" className="hover:text-white transition-colors">Preguntas Frecuentes</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 className="text-white font-semibold mb-4">Contacto</h4>
                        <p className="text-sm">Email: info@transpobolivia.com</p>
                        <p className="text-sm">Teléfono: +591 2 123 4567</p>
                    </div>
                </div>
                <div className="border-t border-gray-800 mt-8 pt-8 text-center text-sm">
                    <p>&copy; 2025 TranspoBolivia. Todos los derechos reservados.</p>
                </div>
            </div>
        </footer>
    );
};

export default Footer;

────────────────────────────────────────────────────────────
FILE: src\components\Header.tsx
────────────────────────────────────────────────────────────

import React from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';

const Header: React.FC = () => {
    const { user, logout } = useAuth();
    const navigate = useNavigate();

    const handleLogout = () => {
        logout();
        navigate('/');
    };

    return (
        <header className="bg-white shadow-sm sticky top-0 z-50 h-20 flex items-center">
            <div className="container mx-auto px-4 flex items-center justify-between">
                {/* Logo y Marca */}
                <Link to="/" className="flex items-center gap-3 group">
                    <div className="bg-primary-600 text-white p-2 rounded-lg shadow-md group-hover:bg-primary-700 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-6 h-6">
                            <path d="M11.25 3.375a.75.75 0 0 0-1.5 0V4.5h1.5V3.375Z" />
                            <path fillRule="evenodd" d="M12.75 3.75a.75.75 0 0 1 .75-.75h2.25a.75.75 0 0 1 0 1.5H14.25v1.5h1.5a.75.75 0 0 1 .75.75v3a.75.75 0 0 1-.75.75h-3a.75.75 0 0 1-.75-.75v-3a.75.75 0 0 1 .75-.75h1.5V4.5h-1.5a.75.75 0 0 1-.75-.75Zm1.5 3h1.5V5.25h-1.5v1.5Z" clipRule="evenodd" />
                            <path d="M1.5 18.75a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H1.5Z" />
                            <path d="M4.5 18.75a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H4.5Z" />
                            <path d="M8.25 18.75a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H8.25Z" />
                            <path fillRule="evenodd" d="M9.444 8.618a.75.75 0 0 1 .37.662v4.845a2.625 2.625 0 0 0 .97 2.037.75.75 0 0 0 1.11-.082c.29-.344.456-.78.456-1.232V9.28a.75.75 0 0 1 1.12.651v4.583c0 .857-.333 1.658-.937 2.247a2.46 2.46 0 0 1-1.583.67h-.01a2.46 2.46 0 0 1-1.583-.67 3.323 3.323 0 0 1-1.12-2.457v-4.583a.75.75 0 0 1 .75-.75c.21 0 .41.084.56.232ZM22.5 12c0-4.073-2.91-7.46-6.825-8.485A.75.75 0 0 0 15 4.14v.36a.75.75 0 0 0 1.5 0V4.5a7.5 7.5 0 0 1 6 7.5c0 .63-.078 1.244-.228 1.834a.75.75 0 0 0 .445.895A9 9 0 0 0 6.6 18.36a.75.75 0 0 0 .898.445A7.5 7.5 0 0 1 12 19.5a.75.75 0 0 0 0-1.5 6 6 0 0 0-5.326-5.952.75.75 0 0 0-.65-1.121A9.001 9.001 0 0 0 22.5 12Z" clipRule="evenodd" />
                        </svg>
                    </div>
                    <span className="text-2xl font-bold text-gray-900 tracking-tight">Transpo<span className="text-primary-600">Bolivia</span></span>
                </Link>

                {/* Navegación Desktop */}
                <nav className="hidden md:flex items-center gap-8">
                    <Link to="/" className="text-sm font-medium text-gray-600 hover:text-primary-600 transition-colors flex items-center gap-1">
                        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                        Inicio
                    </Link>
                    <Link to="/search" className="text-sm font-medium text-gray-600 hover:text-primary-600 transition-colors flex items-center gap-1">
                        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                        Buscar Pasajes
                    </Link>

                    {!user && (
                        <Link to="/operador/login" className="text-sm font-medium text-gray-600 hover:text-primary-600 transition-colors border-l pl-6 border-gray-300">
                            Soy Empresa
                        </Link>
                    )}
                </nav>

                {/* Área de Usuario */}
                <div className="flex items-center gap-4">
                    {user ? (
                        <div className="flex items-center gap-3 pl-4 border-l border-gray-200">
                            {user.role === 'operador' && (
                                <Link to="/operador" className="hidden md:block bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs font-bold py-2 px-4 rounded-full transition-colors">
                                    Ir al Panel
                                </Link>
                            )}

                            <div className="flex flex-col items-end">
                                <span className="text-sm font-bold text-gray-900">{user.nombre.split(' ')[0]}</span>
                                <button onClick={handleLogout} className="text-xs text-red-500 hover:text-red-700 font-medium">Cerrar Sesión</button>
                            </div>

                            <div className="w-10 h-10 bg-primary-600 text-white rounded-full flex items-center justify-center font-bold shadow-sm">
                                {user.nombre.charAt(0).toUpperCase()}
                            </div>
                        </div>
                    ) : (
                        <div className="flex items-center gap-3">
                            <Link to="/login" className="text-sm font-bold text-gray-700 hover:text-primary-600 px-4 py-2">
                                Ingresar
                            </Link>
                            <Link to="/register" className="text-sm font-bold bg-primary-600 hover:bg-primary-700 text-white px-5 py-2.5 rounded-full shadow-sm hover:shadow-md transition-all">
                                Registrarse
                            </Link>
                        </div>
                    )}
                </div>
            </div>
        </header>
    );
};

export default Header;

────────────────────────────────────────────────────────────
FILE: src\components\ProtectedRoute.tsx
────────────────────────────────────────────────────────────


import React, { ReactNode } from 'react';
import { useLocation, Navigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';

interface ProtectedRouteProps {
  children: ReactNode;
  allowedRoles?: string[];
}

const ProtectedRoute: React.FC<ProtectedRouteProps> = ({ children, allowedRoles }) => {
  const { user, isLoading } = useAuth();
  const location = useLocation();

  if (isLoading) {
    return (
        <div className="text-center py-10">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"></div>
            <p className="mt-4 text-text-muted">Verificando sesión...</p>
        </div>
    );
  }
  
  if (!user) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  if (allowedRoles && !allowedRoles.includes(user.role)) {
    // User is logged in but doesn't have the required role
    // Redirect to home or an "unauthorized" page
    return <Navigate to="/" state={{ from: location }} replace />;
  }

  return <>{children}</>;
};

export default ProtectedRoute;

────────────────────────────────────────────────────────────
FILE: src\components\SearchForm.tsx
────────────────────────────────────────────────────────────

import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { CIUDADES } from '../constants';
import { Ciudad } from '../types';

const SearchForm: React.FC = () => {
  const [origen, setOrigen] = useState<string>(CIUDADES[0].id);
  const [destino, setDestino] = useState<string>(CIUDADES[1].id);
  const today = new Date().toISOString().split('T')[0];
  const [fecha, setFecha] = useState<string>(today);
  const [error, setError] = useState<string>('');
  const navigate = useNavigate();

  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault();
    if (origen === destino) {
      setError("El origen y el destino no pueden ser iguales.");
      return;
    }
    setError('');
    navigate('/seleccionar-asientos', { state: { origen, destino, fecha } });
  };

  return (
    <div className="bg-surface p-6 rounded-2xl shadow-lg w-full max-w-4xl mx-auto">
      <form onSubmit={handleSearch} className="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
        <div className="col-span-1 md:col-span-1">
          <label htmlFor="origen" className="block text-sm font-medium text-text-muted mb-1">Origen</label>
          <select
            id="origen"
            value={origen}
            onChange={(e) => setOrigen(e.target.value)}
            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light focus:border-primary-light transition"
          >
            {CIUDADES.map((ciudad: Ciudad) => (
              <option key={ciudad.id} value={ciudad.id}>{ciudad.nombre}</option>
            ))}
          </select>
        </div>
        <div className="col-span-1 md:col-span-1">
          <label htmlFor="destino" className="block text-sm font-medium text-text-muted mb-1">Destino</label>
          <select
            id="destino"
            value={destino}
            onChange={(e) => setDestino(e.target.value)}
            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light focus:border-primary-light transition"
          >
            {CIUDADES.map((ciudad: Ciudad) => (
              <option key={ciudad.id} value={ciudad.id}>{ciudad.nombre}</option>
            ))}
          </select>
        </div>
        <div className="col-span-1 md:col-span-1">
          <label htmlFor="fecha" className="block text-sm font-medium text-text-muted mb-1">Fecha de Viaje</label>
          <input
            type="date"
            id="fecha"
            value={fecha}
            min={today}
            onChange={(e) => setFecha(e.target.value)}
            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light focus:border-primary-light transition"
          />
        </div>
        <div className="col-span-1 md:col-span-1">
          <button
            type="submit"
            className="w-full bg-secondary hover:bg-secondary-dark text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-transform transform hover:scale-105"
          >
             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5">
                <path fillRule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11ZM2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Z" clipRule="evenodd" />
             </svg>
            Buscar Viaje
          </button>
        </div>
      </form>
      {error && <p className="text-accent text-sm text-center mt-3">{error}</p>}
    </div>
  );
};

export default SearchForm;

────────────────────────────────────────────────────────────
FILE: src\components\SeatMap.tsx
────────────────────────────────────────────────────────────


import React from 'react';
import { Asiento, EstadoAsiento } from '../types';

interface SeatMapProps {
  asientos: Asiento[];
  selectedSeats: Asiento[];
  onSeatSelect: (asiento: Asiento) => void;
}

const Seat: React.FC<{ asiento: Asiento; onSelect: () => void; isSelected: boolean }> = ({ asiento, onSelect, isSelected }) => {
  const getSeatColor = () => {
    if (asiento.estado === EstadoAsiento.Ocupado) {
      return 'bg-gray-400 cursor-not-allowed';
    }
    if (isSelected) {
      return 'bg-secondary hover:bg-secondary-dark text-white';
    }
    return 'bg-primary-light hover:bg-primary text-white';
  };

  return (
    <button
      onClick={onSelect}
      disabled={asiento.estado === EstadoAsiento.Ocupado}
      className={`w-10 h-10 rounded-md flex items-center justify-center font-bold text-sm transition-colors ${getSeatColor()}`}
      aria-label={`Asiento ${asiento.numero}, ${asiento.estado}`}
    >
      {asiento.numero}
    </button>
  );
};

const SeatMap: React.FC<SeatMapProps> = ({ asientos, selectedSeats, onSeatSelect }) => {
  const handleSelect = (asiento: Asiento) => {
    if (asiento.estado !== EstadoAsiento.Ocupado) {
      onSeatSelect(asiento);
    }
  };

  const renderSeats = (piso: number) => {
    const seatsInFloor = asientos.filter(a => a.piso === piso);
    return (
      <div className="grid grid-cols-5 gap-2 justify-center">
        {seatsInFloor.map((asiento, index) => (
          <React.Fragment key={asiento.id}>
            {/* Añadir pasillo */}
            {index > 0 && index % 4 === 2 && <div className="col-span-1"></div>}
            <div className="flex justify-center">
              <Seat
                asiento={asiento}
                onSelect={() => handleSelect(asiento)}
                isSelected={selectedSeats.some(s => s.id === asiento.id)}
              />
            </div>
          </React.Fragment>
        ))}
      </div>
    );
  };
  
  const hasTwoFloors = asientos.some(a => a.piso === 2);

  return (
    <div className="bg-surface p-6 rounded-lg shadow-md flex flex-col items-center gap-6">
      <div className="flex justify-center items-center gap-4 text-sm">
          <div className="flex items-center gap-2"><div className="w-4 h-4 rounded bg-primary-light"></div>Disponible</div>
          <div className="flex items-center gap-2"><div className="w-4 h-4 rounded bg-secondary"></div>Seleccionado</div>
          <div className="flex items-center gap-2"><div className="w-4 h-4 rounded bg-gray-400"></div>Ocupado</div>
      </div>
      <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 w-full max-w-sm">
        <h4 className="text-center font-bold mb-4 text-text-muted">Piso 1</h4>
        {renderSeats(1)}
      </div>
      {hasTwoFloors && (
         <div className="border-2 border-dashed border-gray-300 rounded-lg p-4 w-full max-w-sm">
            <h4 className="text-center font-bold mb-4 text-text-muted">Piso 2</h4>
            {renderSeats(2)}
        </div>
      )}
    </div>
  );
};

export default SeatMap;


============================================================
DIR: src\contexts
============================================================


────────────────────────────────────────────────────────────
FILE: src\contexts\AuthContext.tsx
────────────────────────────────────────────────────────────


import React, { createContext, useState, useContext, useEffect, ReactNode } from 'react';
import { User } from '../types';
import { authService } from '../services/authService';

interface AuthContextType {
  user: User | null;
  token: string | null;
  isLoading: boolean;
  login: (email: string, contrasena: string) => Promise<User>;
  register: (nombre: string, email: string, contrasena: string) => Promise<void>;
  registerOperator: (nombreEmpresa: string, nit: string, email: string, contrasena: string) => Promise<void>;
  logout: () => void;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const AuthProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [token, setToken] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState<boolean>(true);

  useEffect(() => {
    // Al cargar el componente, intentar recuperar la sesión del localStorage
    const session = authService.getCurrentSession();
    if (session) {
      setUser(session.user);
      setToken(session.token);
    }
    setIsLoading(false);
  }, []);

  const login = async (email: string, contrasena: string): Promise<User> => {
    const { user, token } = await authService.login(email, contrasena);
    setUser(user);
    setToken(token);
    return user;
  };

  const register = async (nombre: string, email: string, contrasena: string) => {
    const { user, token } = await authService.register(nombre, email, contrasena);
    setUser(user);
    setToken(token);
  };

  const registerOperator = async (nombreEmpresa: string, nit: string, email: string, contrasena: string) => {
    const { user, token } = await authService.registerOperator(nombreEmpresa, nit, email, contrasena);
    setUser(user);
    setToken(token);
  };

  const logout = () => {
    authService.logout();
    setUser(null);
    setToken(null);
  };

  const value = {
    user,
    token,
    isLoading,
    login,
    register,
    registerOperator,
    logout,
  };

  return (
    <AuthContext.Provider value={value}>
      {!isLoading && children}
    </AuthContext.Provider>
  );
};

export const useAuth = (): AuthContextType => {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth debe ser usado dentro de un AuthProvider');
  }
  return context;
};


============================================================
DIR: src\layouts
============================================================


────────────────────────────────────────────────────────────
FILE: src\layouts\OperatorLayout.tsx
────────────────────────────────────────────────────────────

import React, { useState } from 'react';
import { Outlet, Link, useNavigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';

const OperatorLayout: React.FC = () => {
    const { user, logout } = useAuth();
    const navigate = useNavigate();
    const [isSidebarOpen, setIsSidebarOpen] = useState(true);

    const handleLogout = () => {
        logout();
        navigate('/');
    };

    return (
        <div className="flex h-screen bg-gray-50">
            {/* Sidebar */}
            <aside className={`${isSidebarOpen ? 'w-64' : 'w-20'} bg-gray-900 text-white transition-all duration-300 flex flex-col`}>
                {/* Header */}
                <div className="p-4 border-b border-gray-700">
                    <div className="flex items-center justify-between">
                        {isSidebarOpen && <h1 className="text-lg font-bold">Panel Operador</h1>}
                        <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="p-1 hover:bg-gray-700 rounded">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                            </svg>
                        </button>
                    </div>
                    {isSidebarOpen && user && <p className="text-xs text-gray-400 mt-2">{user.nombre}</p>}
                </div>

                {/* Navigation */}
                <nav className="flex-1 p-4 overflow-y-auto">
                    <div className="space-y-1">
                        <Link to="/operador" className="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                            </svg>
                            {isSidebarOpen && <span className="text-sm font-medium">Dashboard</span>}
                        </Link>

                        {/* Operaciones Section */}
                        {isSidebarOpen && <p className="text-xs text-gray-400 uppercase tracking-wider mt-4 mb-2 px-3">Operaciones</p>}

                        <Link to="/operador/rutas" className="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z" />
                            </svg>
                            {isSidebarOpen && <span className="text-sm font-medium">Rutas</span>}
                        </Link>

                        <Link to="/operador/horarios" className="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            {isSidebarOpen && <span className="text-sm font-medium">Horarios</span>}
                        </Link>

                        <Link to="/operador/vehiculos" className="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 00-3.213-9.193 2.056 2.056 0 00-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 00-10.026 0 1.106 1.106 0 00-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12" />
                            </svg>
                            {isSidebarOpen && <span className="text-sm font-medium">Flota</span>}
                        </Link>

                        <Link to="/operador/conductores" className="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                            </svg>
                            {isSidebarOpen && <span className="text-sm font-medium">Conductores</span>}
                        </Link>

                        <Link to="/operador/mantenimiento" className="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-2.25-2.25l3.276-3.276a4.5 4.5 0 00-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437l1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008z" />
                            </svg>
                            {isSidebarOpen && <span className="text-sm font-medium">Mantenimiento</span>}
                        </Link>

                        {/* Administración Section */}
                        {isSidebarOpen && <p className="text-xs text-gray-400 uppercase tracking-wider mt-4 mb-2 px-3">Administración</p>}

                        <Link to="/operador/perfil" className="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" />
                            </svg>
                            {isSidebarOpen && <span className="text-sm font-medium">Perfil Empresa</span>}
                        </Link>
                    </div>
                </nav>

                {/* Footer */}
                <div className="p-4 border-t border-gray-700">
                    <button
                        onClick={handleLogout}
                        className="flex items-center gap-3 px-3 py-2 w-full rounded-lg hover:bg-gray-800 transition-colors text-red-400"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                            <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9" />
                        </svg>
                        {isSidebarOpen && <span className="text-sm font-medium">Cerrar Sesión</span>}
                    </button>
                </div>
            </aside>

            {/* Main Content */}
            <div className="flex-1 flex flex-col overflow-hidden">
                {/* Top Bar */}
                <header className="bg-white shadow-sm h-16 flex items-center justify-between px-6">
                    <h2 className="text-xl font-semibold text-gray-800">Panel de Operador</h2>
                    <div className="flex items-center gap-4">
                        <span className="text-sm text-gray-600">{user?.nombre}</span>
                        <div className="w-10 h-10 rounded-full bg-primary-600 text-white flex items-center justify-center font-bold">
                            {user?.nombre?.charAt(0).toUpperCase()}
                        </div>
                    </div>
                </header>

                {/* Content Area */}
                <main className="flex-1 overflow-y-auto p-6">
                    <Outlet />
                </main>
            </div>
        </div>
    );
};

export default OperatorLayout;

────────────────────────────────────────────────────────────
FILE: src\layouts\PublicLayout.tsx
────────────────────────────────────────────────────────────

import React from 'react';
import { Outlet } from 'react-router-dom';
import Header from '../components/Header';
import Footer from '../components/Footer';

const PublicLayout: React.FC = () => {
    return (
        <div className="flex flex-col min-h-screen">
            <Header />
            <main className="flex-1">
                <Outlet />
            </main>
            <Footer />
        </div>
    );
};

export default PublicLayout;


============================================================
DIR: src\pages
============================================================


────────────────────────────────────────────────────────────
FILE: src\pages\ConfirmationPage.tsx
────────────────────────────────────────────────────────────

import React, { useState } from 'react';
import { useLocation, useNavigate } from 'react-router-dom';
import { TransportService } from '../services/api';

const ConfirmationPage: React.FC = () => {
    const location = useLocation();
    const navigate = useNavigate();
    const { selectedSeats, total, scheduleId } = location.state || { selectedSeats: [], total: 0, scheduleId: null };

    const [passenger, setPassenger] = useState({
        nombre: '',
        apellido: '',
        ci: '',
        email: ''
    });

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();

        if (!scheduleId) {
            alert('Error: No se encontró el horario del viaje.');
            return;
        }

        try {
            // Fetch current schedule to get latest occupied seats
            const schedules = await TransportService.getSchedules() as any[];
            const currentSchedule = schedules.find((s: any) => s.id === scheduleId);

            if (!currentSchedule) {
                alert('Error: El horario ya no está disponible.');
                return;
            }

            // Update schedule with new occupied seats and passenger info
            const newOccupiedSeats = [...currentSchedule.occupiedSeats, ...selectedSeats];

            // Create passenger records for each seat
            const newPassengers = selectedSeats.map((seat: number) => ({
                seat,
                name: `${passenger.nombre} ${passenger.apellido}`,
                ci: passenger.ci
            }));

            const existingPassengers = currentSchedule.passengers || [];

            await TransportService.updateSchedule(scheduleId, {
                occupiedSeats: newOccupiedSeats,
                passengers: [...existingPassengers, ...newPassengers]
            });

            alert('¡Reserva Confirmada! Gracias por viajar con nosotros.');
            navigate('/');
        } catch (error) {
            console.error("Booking error", error);
            alert('Hubo un error al procesar tu reserva. Por favor intenta nuevamente.');
        }
    };

    if (selectedSeats.length === 0) {
        return (
            <div className="text-center py-12">
                <h2 className="text-xl font-bold text-gray-900">No hay asientos seleccionados</h2>
                <button onClick={() => navigate('/')} className="mt-4 btn-primary">Volver al Inicio</button>
            </div>
        );
    }

    return (
        <div className="max-w-2xl mx-auto py-8 px-4">
            <div className="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                <div className="bg-primary-600 p-6 text-white text-center">
                    <h1 className="text-2xl font-bold">Confirmar Reserva</h1>
                    <p className="opacity-90">Completa tus datos para finalizar la compra</p>
                </div>

                <div className="p-8">
                    <div className="mb-8 bg-blue-50 p-4 rounded-xl border border-blue-100">
                        <h3 className="font-bold text-blue-900 mb-2">Detalles del Viaje</h3>
                        <div className="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <span className="block text-blue-600">Asientos:</span>
                                <span className="font-medium text-gray-900">{selectedSeats.join(', ')}</span>
                            </div>
                            <div>
                                <span className="block text-blue-600">Total a Pagar:</span>
                                <span className="font-bold text-gray-900 text-lg">{total} Bs</span>
                            </div>
                        </div>
                    </div>

                    <form onSubmit={handleSubmit} className="space-y-6">
                        <div className="grid grid-cols-2 gap-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Nombre</label>
                                <input
                                    type="text"
                                    required
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                                    value={passenger.nombre}
                                    onChange={e => setPassenger({ ...passenger, nombre: e.target.value })}
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Apellido</label>
                                <input
                                    type="text"
                                    required
                                    className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                                    value={passenger.apellido}
                                    onChange={e => setPassenger({ ...passenger, apellido: e.target.value })}
                                />
                            </div>
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Cédula de Identidad</label>
                            <input
                                type="text"
                                required
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                                value={passenger.ci}
                                onChange={e => setPassenger({ ...passenger, ci: e.target.value })}
                            />
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Correo Electrónico</label>
                            <input
                                type="email"
                                required
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                                value={passenger.email}
                                onChange={e => setPassenger({ ...passenger, email: e.target.value })}
                            />
                        </div>

                        <div className="pt-4">
                            <button
                                type="submit"
                                className="w-full btn-primary py-4 text-lg font-bold shadow-lg hover:shadow-xl transform transition-all hover:-translate-y-0.5"
                            >
                                Confirmar y Pagar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    );
};

export default ConfirmationPage;

────────────────────────────────────────────────────────────
FILE: src\pages\HomePage.tsx
────────────────────────────────────────────────────────────

import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { BOLIVIAN_CITIES } from '../services/api';

const HomePage: React.FC = () => {
    const navigate = useNavigate();
    const today = new Date().toISOString().split('T')[0];

    const [formData, setFormData] = useState({
        origin: '',
        destination: '',
        date: today
    });

    const handleSearch = (e: React.FormEvent) => {
        e.preventDefault();
        navigate('/search', { state: formData });
    };

    const handleBrowseAll = () => {
        // Redirige sin filtros para ver todo
        navigate('/search', { state: { date: today, origin: '', destination: '' } });
    };

    return (
        <div className="flex flex-col min-h-screen bg-gray-50">
            {/* Hero Section */}
            <section className="relative h-[650px] flex items-center justify-center bg-gray-900 overflow-hidden">
                {/* Imagen de fondo con fallback de color */}
                <div className="absolute inset-0 z-0 bg-gray-800">
                    <img
                        src="https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?q=80&w=1920&auto=format&fit=crop"
                        alt="Bus viajando por paisajes de Bolivia"
                        className="w-full h-full object-cover opacity-60"
                    />
                    {/* Gradiente para asegurar legibilidad del texto */}
                    <div className="absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/40 to-transparent"></div>
                </div>

                <div className="container mx-auto px-4 relative z-10 w-full max-w-6xl">
                    <div className="text-center mb-12">
                        <h1 className="text-4xl md:text-6xl font-extrabold text-white mb-6 drop-shadow-xl leading-tight">
                            Viaja por <span className="text-yellow-400">Bolivia</span> con Confianza
                        </h1>
                        <p className="text-xl text-gray-100 font-medium max-w-2xl mx-auto drop-shadow-md">
                            La plataforma oficial para conectar pasajeros con las mejores operadoras de transporte del país.
                        </p>
                    </div>

                    {/* Widget de Búsqueda */}
                    <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8 border border-gray-200 transform hover:scale-[1.01] transition-transform duration-300">
                        <form onSubmit={handleSearch} className="grid grid-cols-1 md:grid-cols-12 gap-6 items-end">

                            {/* Origen */}
                            <div className="md:col-span-3">
                                <label className="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 ml-1">Origen</label>
                                <div className="relative">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <svg className="h-5 w-5 text-primary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                    </div>
                                    <select
                                        className="input-field pl-10 h-14 bg-white"
                                        value={formData.origin}
                                        onChange={e => setFormData({ ...formData, origin: e.target.value })}
                                    >
                                        <option value="">Selecciona Origen</option>
                                        {BOLIVIAN_CITIES.map(city => (
                                            <option key={city.id} value={city.id}>{city.name}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>

                            {/* Destino */}
                            <div className="md:col-span-3">
                                <label className="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 ml-1">Destino</label>
                                <div className="relative">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <svg className="h-5 w-5 text-secondary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                    </div>
                                    <select
                                        className="input-field pl-10 h-14 bg-white"
                                        value={formData.destination}
                                        onChange={e => setFormData({ ...formData, destination: e.target.value })}
                                    >
                                        <option value="">Selecciona Destino</option>
                                        {BOLIVIAN_CITIES.map(city => (
                                            <option key={city.id} value={city.id}>{city.name}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>

                            {/* Fecha */}
                            <div className="md:col-span-3">
                                <label className="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 ml-1">Fecha de Salida</label>
                                <div className="relative">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <svg className="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                                    </div>
                                    <input
                                        type="date"
                                        className="input-field pl-10 h-14 bg-white"
                                        value={formData.date}
                                        onChange={e => setFormData({ ...formData, date: e.target.value })}
                                        min={today}
                                    />
                                </div>
                            </div>

                            {/* Botón Buscar */}
                            <div className="md:col-span-3">
                                <button
                                    type="submit"
                                    className="w-full bg-primary-600 hover:bg-primary-700 text-white font-bold h-14 rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2 text-lg"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2.5} stroke="currentColor" className="w-6 h-6"><path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" /></svg>
                                    BUSCAR PASAJES
                                </button>
                            </div>
                        </form>

                        {/* Botón Ver Todo Mejorado */}
                        <div className="mt-6 flex justify-center">
                            <button
                                onClick={handleBrowseAll}
                                className="group flex items-center gap-2 px-6 py-2 bg-gray-100 hover:bg-gray-200 rounded-full text-gray-700 font-medium transition-all"
                            >
                                <span>Explorar todos los destinos y horarios</span>
                                <svg className="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            {/* Features */}
            <section className="py-16 bg-white">
                <div className="container mx-auto px-4">
                    <h2 className="text-3xl font-bold text-center mb-12">¿Por qué elegirnos?</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div className="text-center p-6 border rounded-xl hover:shadow-lg transition-shadow">
                            <div className="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-blue-600 text-2xl">🛡️</div>
                            <h3 className="font-bold text-lg mb-2">Pagos Seguros</h3>
                            <p className="text-gray-600">Tus transacciones están protegidas y garantizadas.</p>
                        </div>
                        <div className="text-center p-6 border rounded-xl hover:shadow-lg transition-shadow">
                            <div className="bg-orange-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-orange-600 text-2xl">⚡</div>
                            <h3 className="font-bold text-lg mb-2">Sin Filas</h3>
                            <p className="text-gray-600">Reserva desde tu celular y aborda directamente.</p>
                        </div>
                        <div className="text-center p-6 border rounded-xl hover:shadow-lg transition-shadow">
                            <div className="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-green-600 text-2xl">🚌</div>
                            <h3 className="font-bold text-lg mb-2">Las Mejores Flotas</h3>
                            <p className="text-gray-600">Trabajamos solo con empresas de transporte verificadas.</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    );
};

export default HomePage;

────────────────────────────────────────────────────────────
FILE: src\pages\LoginPage.tsx
────────────────────────────────────────────────────────────


import React, { useState } from 'react';
import { Link, useNavigate, useLocation } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';

const LoginPage: React.FC = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const { login, logout } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();

  const from = location.state?.from?.pathname || '/';

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    setIsLoading(true);
    try {
      const loggedInUser = await login(email, password);
      if (loggedInUser.role !== 'user') {
        logout(); // Cierra la sesión inmediatamente
        setError('Acceso denegado. Utiliza el Portal para Empresas para iniciar sesión como operador.');
        setIsLoading(false);
        return;
      }
      navigate(from, { replace: true });
    } catch (err: any) {
      setError(err.message || 'Ocurrió un error al iniciar sesión.');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="flex justify-center items-center py-12">
      <div className="w-full max-w-md bg-surface p-8 rounded-2xl shadow-xl">
        <h1 className="text-3xl font-bold text-primary text-center mb-2">Iniciar Sesión</h1>
        <p className="text-text-muted text-center mb-6">Bienvenido de nuevo a TranspoBolivia.</p>
        <form onSubmit={handleSubmit} className="space-y-6">
          <div>
            <label htmlFor="email" className="block text-sm font-medium text-text-muted mb-1">Correo Electrónico</label>
            <input
              type="email"
              id="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
          <div>
            <label htmlFor="password" className="block text-sm font-medium text-text-muted mb-1">Contraseña</label>
            <input
              type="password"
              id="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
          {error && <p className="text-accent text-sm text-center">{error}</p>}
          <div className="text-right">
             <a href="#" className="text-sm font-medium text-primary hover:underline">¿Olvidaste tu contraseña?</a>
          </div>
          <button
            type="submit"
            disabled={isLoading}
            className="w-full bg-primary hover:bg-primary-dark text-white font-bold py-3 px-4 rounded-lg transition-colors disabled:bg-gray-400"
          >
            {isLoading ? 'Ingresando...' : 'Ingresar'}
          </button>
        </form>
        <p className="text-center text-sm text-text-muted mt-6">
          ¿No tienes una cuenta?{' '}
          <Link to="/register" className="font-medium text-secondary hover:underline">
            Regístrate aquí
          </Link>
        </p>
      </div>
    </div>
  );
};

export default LoginPage;

────────────────────────────────────────────────────────────
FILE: src\pages\RegisterPage.tsx
────────────────────────────────────────────────────────────

import React, { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';

const RegisterPage: React.FC = () => {
  const [nombre, setNombre] = useState('');
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const { register } = useAuth();
  const navigate = useNavigate();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (password !== confirmPassword) {
      setError('Las contraseñas no coinciden.');
      return;
    }
    setError('');
    setIsLoading(true);
    try {
      await register(nombre, email, password);
      navigate('/');
    } catch (err: any) {
      setError(err.message || 'Ocurrió un error durante el registro.');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="flex justify-center items-center py-12">
      <div className="w-full max-w-md bg-surface p-8 rounded-2xl shadow-xl">
        <h1 className="text-3xl font-bold text-primary text-center mb-2">Crea tu Cuenta</h1>
        <p className="text-text-muted text-center mb-6">Únete a la comunidad de viajeros de TranspoBolivia.</p>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label htmlFor="nombre" className="block text-sm font-medium text-text-muted mb-1">Nombre Completo</label>
            <input
              type="text"
              id="nombre"
              value={nombre}
              onChange={(e) => setNombre(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
          <div>
            <label htmlFor="email" className="block text-sm font-medium text-text-muted mb-1">Correo Electrónico</label>
            <input
              type="email"
              id="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
          <div>
            <label htmlFor="password" className="block text-sm font-medium text-text-muted mb-1">Contraseña</label>
            <input
              type="password"
              id="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
           <div>
            <label htmlFor="confirmPassword" className="block text-sm font-medium text-text-muted mb-1">Confirmar Contraseña</label>
            <input
              type="password"
              id="confirmPassword"
              value={confirmPassword}
              onChange={(e) => setConfirmPassword(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
          {error && <p className="text-accent text-sm text-center">{error}</p>}
          <button
            type="submit"
            disabled={isLoading}
            className="w-full bg-secondary hover:bg-secondary-dark text-white font-bold py-3 px-4 rounded-lg transition-colors disabled:bg-gray-400 mt-4"
          >
            {isLoading ? 'Creando cuenta...' : 'Registrarme'}
          </button>
        </form>
        <p className="text-center text-sm text-text-muted mt-6">
          ¿Ya tienes una cuenta?{' '}
          <Link to="/login" className="font-medium text-primary hover:underline">
            Inicia sesión aquí
          </Link>
        </p>
      </div>
    </div>
  );
};

export default RegisterPage;

────────────────────────────────────────────────────────────
FILE: src\pages\SearchResultsPage.tsx
────────────────────────────────────────────────────────────

import React, { useState, useEffect, useMemo } from 'react';
import { useLocation, useNavigate } from 'react-router-dom';
import { TransportService, BOLIVIAN_CITIES } from '../services/api';

const SearchResultsPage: React.FC = () => {
    const location = useLocation();
    const navigate = useNavigate();
    const initialState = location.state || {};

    const [filters, setFilters] = useState({
        origin: initialState.origin || '',
        destination: initialState.destination || '',
        date: initialState.date || new Date().toISOString().split('T')[0],
        minPrice: 0,
        maxPrice: 500,
        company: ''
    });

    const [trips, setTrips] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');

    useEffect(() => {
        const fetchTrips = async () => {
            setLoading(true);
            setError('');
            try {
                const data = await TransportService.searchTrips(filters.origin, filters.destination, filters.date);
                setTrips(Array.isArray(data) ? data : []);
            } catch (err) {
                console.error(err);
                setError('No pudimos cargar los viajes. Intenta nuevamente.');
            } finally {
                setLoading(false);
            }
        };

        fetchTrips();
    }, [filters.origin, filters.destination, filters.date]);

    const filteredTrips = useMemo(() => {
        return trips.filter(trip => {
            const matchesPrice = trip.precio >= filters.minPrice && trip.precio <= filters.maxPrice;
            const matchesCompany = filters.company ? trip.empresa === filters.company : true;
            return matchesPrice && matchesCompany;
        });
    }, [trips, filters.minPrice, filters.maxPrice, filters.company]);

    const uniqueCompanies = useMemo(() => [...new Set(trips.map(t => t.empresa))], [trips]);

    const handleSelect = (viajeId: string) => {
        navigate(`/seleccionar-asientos?scheduleId=${viajeId}&date=${filters.date}`);
    };

    return (
        <div className="container mx-auto px-4 py-8">
            <div className="flex flex-col lg:flex-row gap-8">

                {/* Sidebar Filtros */}
                <aside className="w-full lg:w-1/4 space-y-6">
                    <div className="card p-6">
                        <h2 className="font-bold text-lg mb-4 text-gray-900 border-b pb-2">Filtros</h2>

                        <div className="mb-4">
                            <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Origen</label>
                            <select
                                className="input-field text-sm"
                                value={filters.origin}
                                onChange={e => setFilters({ ...filters, origin: e.target.value })}
                            >
                                <option value="">Cualquier origen</option>
                                {BOLIVIAN_CITIES.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                            </select>
                        </div>

                        <div className="mb-4">
                            <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Destino</label>
                            <select
                                className="input-field text-sm"
                                value={filters.destination}
                                onChange={e => setFilters({ ...filters, destination: e.target.value })}
                            >
                                <option value="">Cualquier destino</option>
                                {BOLIVIAN_CITIES.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                            </select>
                        </div>

                        <div className="mb-6">
                            <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Fecha</label>
                            <input
                                type="date"
                                className="input-field text-sm"
                                value={filters.date}
                                onChange={e => setFilters({ ...filters, date: e.target.value })}
                            />
                        </div>

                        <div className="mb-6 pt-4 border-t border-gray-100">
                            <label className="block text-sm font-medium text-gray-700 mb-2">Precio Máx: {filters.maxPrice} Bs</label>
                            <input
                                type="range"
                                min="0" max="500" step="10"
                                value={filters.maxPrice}
                                onChange={e => setFilters({ ...filters, maxPrice: Number(e.target.value) })}
                                className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary-600"
                            />
                        </div>

                        {uniqueCompanies.length > 0 && (
                            <div className="mb-4 pt-4 border-t border-gray-100">
                                <label className="block text-sm font-medium text-gray-700 mb-2">Empresa</label>
                                <div className="space-y-2">
                                    <label className="flex items-center gap-2 cursor-pointer">
                                        <input
                                            type="radio"
                                            name="company"
                                            checked={filters.company === ''}
                                            onChange={() => setFilters({ ...filters, company: '' })}
                                            className="text-primary-600 focus:ring-primary-500"
                                        />
                                        <span className="text-sm text-gray-600">Todas</span>
                                    </label>
                                    {uniqueCompanies.map(comp => (
                                        <label key={comp} className="flex items-center gap-2 cursor-pointer">
                                            <input
                                                type="radio"
                                                name="company"
                                                value={comp}
                                                checked={filters.company === comp}
                                                onChange={() => setFilters({ ...filters, company: comp })}
                                                className="text-primary-600 focus:ring-primary-500"
                                            />
                                            <span className="text-sm text-gray-600">{comp}</span>
                                        </label>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </aside>

                {/* Resultados */}
                <main className="w-full lg:w-3/4">
                    <div className="mb-6">
                        <h1 className="text-2xl font-bold text-gray-900">Viajes Disponibles</h1>
                        <p className="text-gray-500 text-sm">
                            {filters.origin ? filters.origin : 'Cualquier lugar'} a {filters.destination ? filters.destination : 'cualquier destino'} • {filters.date}
                        </p>
                    </div>

                    {loading ? (
                        <div className="py-20 text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-primary-600 mx-auto mb-4"></div>
                            <p className="text-gray-500 font-medium">Buscando las mejores opciones...</p>
                        </div>
                    ) : error ? (
                        <div className="bg-red-50 p-4 rounded-lg text-red-700 border border-red-100 text-center">{error}</div>
                    ) : filteredTrips.length === 0 ? (
                        <div className="card p-12 text-center">
                            <div className="text-6xl mb-4">🚌</div>
                            <h3 className="text-lg font-bold text-gray-900 mb-2">No encontramos viajes</h3>
                            <p className="text-gray-500">Intenta cambiar la fecha o relajar los filtros de búsqueda.</p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {filteredTrips.map((trip) => (
                                <div key={trip.id} className="card p-5 hover:shadow-lg transition-all flex flex-col md:flex-row gap-6 items-center">
                                    {/* Info Empresa y Hora */}
                                    <div className="flex-1 w-full">
                                        <div className="flex items-center gap-3 mb-4">
                                            <div className="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-xs font-bold text-gray-500 overflow-hidden border border-gray-200">
                                                {trip.logoEmpresa ? <img src={trip.logoEmpresa} alt={trip.empresa} className="w-full h-full object-cover" /> : trip.empresa.substring(0, 2)}
                                            </div>
                                            <div>
                                                <h3 className="font-bold text-gray-900">{trip.empresa}</h3>
                                                <span className="text-xs bg-primary-50 text-primary-700 px-2 py-0.5 rounded-full border border-primary-100">{trip.tipoBus}</span>
                                            </div>
                                        </div>
                                        <div className="flex items-center justify-between text-center md:text-left gap-4">
                                            <div>
                                                <p className="text-2xl font-bold text-gray-900">{trip.horaSalida}</p>
                                                {/* CORRECCIÓN AQUÍ: Renderizar string, no objeto */}
                                                <p className="text-sm text-gray-500 font-medium">{typeof trip.origen === 'object' ? trip.origen.nombre : trip.origen}</p>
                                            </div>
                                            <div className="flex-1 flex flex-col items-center px-4">
                                                <span className="text-xs text-gray-400 mb-1">{trip.duracionEstimada}</span>
                                                <div className="w-full h-px bg-gray-300 relative">
                                                    <div className="absolute left-0 top-1/2 -translate-y-1/2 w-1.5 h-1.5 bg-gray-400 rounded-full"></div>
                                                    <div className="absolute right-0 top-1/2 -translate-y-1/2 w-1.5 h-1.5 bg-gray-400 rounded-full"></div>
                                                </div>
                                            </div>
                                            <div>
                                                <p className="text-2xl font-bold text-gray-400">--:--</p>
                                                {/* CORRECCIÓN AQUÍ: Renderizar string, no objeto */}
                                                <p className="text-sm text-gray-500 font-medium">{typeof trip.destino === 'object' ? trip.destino.nombre : trip.destino}</p>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Precio y Acción */}
                                    <div className="w-full md:w-48 border-t md:border-t-0 md:border-l border-gray-100 pt-4 md:pt-0 md:pl-6 flex flex-row md:flex-col justify-between items-center gap-2 bg-gray-50 md:bg-transparent -mx-5 md:mx-0 p-4 md:p-0 mt-2 md:mt-0 rounded-b-xl md:rounded-none">
                                        <div className="text-left md:text-center">
                                            <p className="text-xs text-gray-500">Precio por persona</p>
                                            <p className="text-3xl font-bold text-secondary-600">{trip.precio} <span className="text-sm font-normal text-gray-600">Bs</span></p>
                                        </div>
                                        <div className="flex flex-col items-end md:items-center w-auto">
                                            <button
                                                onClick={() => handleSelect(trip.id)}
                                                className="btn-primary py-2 px-8 text-sm w-full md:w-auto whitespace-nowrap"
                                            >
                                                Seleccionar
                                            </button>
                                            <p className="text-xs text-gray-500 mt-2 font-medium">{trip.disponibles} asientos libres</p>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </main>
            </div>
        </div>
    );
};

export default SearchResultsPage;

────────────────────────────────────────────────────────────
FILE: src\pages\SeatSelectionPage.tsx
────────────────────────────────────────────────────────────

import React, { useState, useEffect } from 'react';
import { useSearchParams, useNavigate } from 'react-router-dom';
import { TransportService } from '../services/api';

const SeatSelectionPage: React.FC = () => {
    const [searchParams] = useSearchParams();
    const navigate = useNavigate();
    const scheduleId = searchParams.get('scheduleId');

    const [schedule, setSchedule] = useState<any>(null);
    const [selectedSeats, setSelectedSeats] = useState<number[]>([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        const fetchSchedule = async () => {
            if (!scheduleId) return;
            try {
                const schedules = await TransportService.getSchedules() as any[];
                const found = schedules.find((s: any) => s.id === scheduleId);
                if (found) {
                    setSchedule(found);
                }
            } catch (error) {
                console.error('Error fetching schedule:', error);
            } finally {
                setLoading(false);
            }
        };
        fetchSchedule();
    }, [scheduleId]);

    const toggleSeat = (seatNum: number) => {
        if (schedule?.occupiedSeats?.includes(seatNum)) return; // Can't select occupied seats

        if (selectedSeats.includes(seatNum)) {
            setSelectedSeats(selectedSeats.filter(s => s !== seatNum));
        } else {
            setSelectedSeats([...selectedSeats, seatNum]);
        }
    };

    const handleContinue = () => {
        if (selectedSeats.length === 0) {
            alert('Por favor selecciona al menos un asiento');
            return;
        }
        const total = selectedSeats.length * (schedule?.price || 50);
        navigate('/confirmacion', {
            state: { selectedSeats, total, scheduleId }
        });
    };

    if (loading) {
        return <div className="container mx-auto px-4 py-12 text-center">Cargando...</div>;
    }

    if (!schedule) {
        return <div className="container mx-auto px-4 py-12 text-center">No se encontró el horario.</div>;
    }

    return (
        <div className="container mx-auto px-4 py-12">
            <div className="max-w-4xl mx-auto">
                <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
                    <div className="bg-primary-600 p-6 text-white">
                        <h1 className="text-2xl font-bold">Selección de Asientos</h1>
                        <p className="opacity-90">Elige tus asientos preferidos</p>
                    </div>

                    <div className="p-8">
                        {/* Bus Visual */}
                        <div className="mb-8 bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <div className="text-center text-xs font-bold text-gray-400 mb-4 uppercase tracking-wider">Frente del Bus</div>
                            <div className="grid grid-cols-4 gap-3 max-w-md mx-auto">
                                {Array.from({ length: 40 }, (_, i) => i + 1).map((seatNum) => {
                                    const isOccupied = schedule.occupiedSeats?.includes(seatNum);
                                    const isSelected = selectedSeats.includes(seatNum);
                                    const isAisle = seatNum % 4 === 2;

                                    return (
                                        <React.Fragment key={seatNum}>
                                            <button
                                                onClick={() => toggleSeat(seatNum)}
                                                disabled={isOccupied}
                                                className={`
                                                    w-12 h-12 rounded flex items-center justify-center text-sm font-bold transition-all
                                                    ${isOccupied ? 'bg-red-500 text-white cursor-not-allowed' :
                                                        isSelected ? 'bg-green-500 text-white shadow-lg scale-110' :
                                                            'bg-white border-2 border-gray-300 hover:border-primary-500 hover:shadow-md'}
                                                `}
                                            >
                                                {seatNum}
                                            </button>
                                            {isAisle && <div className="w-12"></div>}
                                        </React.Fragment>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Legend */}
                        <div className="flex justify-center gap-6 mb-8">
                            <div className="flex items-center gap-2">
                                <div className="w-6 h-6 bg-white border-2 border-gray-300 rounded"></div>
                                <span className="text-sm text-gray-600">Disponible</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="w-6 h-6 bg-green-500 rounded"></div>
                                <span className="text-sm text-gray-600">Seleccionado</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="w-6 h-6 bg-red-500 rounded"></div>
                                <span className="text-sm text-gray-600">Ocupado</span>
                            </div>
                        </div>

                        {/* Summary */}
                        {selectedSeats.length > 0 && (
                            <div className="bg-blue-50 p-6 rounded-xl border border-blue-100 mb-6">
                                <div className="flex justify-between items-center">
                                    <div>
                                        <p className="text-sm text-blue-600 mb-1">Asientos seleccionados</p>
                                        <p className="text-2xl font-bold text-blue-900">{selectedSeats.join(', ')}</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-sm text-blue-600 mb-1">Total a pagar</p>
                                        <p className="text-3xl font-bold text-blue-900">{selectedSeats.length * schedule.price} Bs</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Actions */}
                        <div className="flex gap-4">
                            <button
                                onClick={() => navigate(-1)}
                                className="flex-1 btn-secondary"
                            >
                                Volver
                            </button>
                            <button
                                onClick={handleContinue}
                                disabled={selectedSeats.length === 0}
                                className="flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                Continuar a Datos Pasajero
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
};

export default SeatSelectionPage;


============================================================
DIR: src\pages\operador
============================================================


────────────────────────────────────────────────────────────
FILE: src\pages\operador\ConductoresPage.tsx
────────────────────────────────────────────────────────────

import React, { useState, useEffect, useCallback } from 'react';
import { useForm } from 'react-hook-form';
import { Conductor } from '../../types';
import { operadorService } from '../../services/operadorService';

type ConductorFormInput = Omit<Conductor, 'id' | 'empresaId'>;

const ConductorForm: React.FC<{
  conductor?: Conductor;
  onSave: () => void;
  onCancel: () => void;
}> = ({ conductor, onSave, onCancel }) => {
  const { register, handleSubmit, formState: { errors, isSubmitting } } = useForm<ConductorFormInput>({
    defaultValues: conductor || {
      nombre: '',
      cedula: '',
      tipoLicencia: 'A',
      vencimientoLicencia: '',
      estado: 'activo',
    },
  });

  const onSubmit = async (data: ConductorFormInput) => {
    if (conductor?.id) {
      await operadorService.updateConductor({ ...data, id: conductor.id });
    } else {
      await operadorService.addConductor(data);
    }
    onSave();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex justify-center items-center z-50 p-4">
      <div className="bg-surface p-6 rounded-lg shadow-xl w-full max-w-lg">
        <h2 className="text-xl font-bold text-primary mb-4">{conductor ? 'Editar' : 'Añadir'} Conductor</h2>
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <div>
            <label htmlFor="nombre" className="block text-sm font-medium text-text-muted">Nombre Completo</label>
            <input id="nombre" {...register('nombre', { required: 'El nombre es requerido' })} className="mt-1 block w-full p-2 border border-gray-300 rounded-md" />
            {errors.nombre && <p className="text-accent text-xs mt-1">{errors.nombre.message}</p>}
          </div>
          <div>
            <label htmlFor="cedula" className="block text-sm font-medium text-text-muted">Cédula de Identidad</label>
            <input id="cedula" {...register('cedula', { required: 'La cédula es requerida' })} className="mt-1 block w-full p-2 border border-gray-300 rounded-md" />
            {errors.cedula && <p className="text-accent text-xs mt-1">{errors.cedula.message}</p>}
          </div>
          <div>
            <label htmlFor="tipoLicencia" className="block text-sm font-medium text-text-muted">Tipo de Licencia</label>
            <select id="tipoLicencia" {...register('tipoLicencia')} className="mt-1 block w-full p-2 border border-gray-300 rounded-md">
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="C">C</option>
              <option value="P">P</option>
            </select>
          </div>
          <div>
            <label htmlFor="vencimientoLicencia" className="block text-sm font-medium text-text-muted">Vencimiento de Licencia</label>
            <input id="vencimientoLicencia" type="date" {...register('vencimientoLicencia', { required: 'La fecha es requerida' })} className="mt-1 block w-full p-2 border border-gray-300 rounded-md" />
            {errors.vencimientoLicencia && <p className="text-accent text-xs mt-1">{errors.vencimientoLicencia.message}</p>}
          </div>
          <div>
            <label htmlFor="estado" className="block text-sm font-medium text-text-muted">Estado</label>
            <select id="estado" {...register('estado')} className="mt-1 block w-full p-2 border border-gray-300 rounded-md">
              <option value="activo">Activo</option>
              <option value="inactivo">Inactivo</option>
            </select>
          </div>

          <div className="flex justify-end gap-3 pt-4">
            <button type="button" onClick={onCancel} className="bg-gray-200 hover:bg-gray-300 text-text font-bold py-2 px-4 rounded-lg">Cancelar</button>
            <button type="submit" disabled={isSubmitting} className="bg-primary hover:bg-primary-dark text-white font-bold py-2 px-4 rounded-lg disabled:bg-gray-400">{isSubmitting ? 'Guardando...' : 'Guardar'}</button>
          </div>
        </form>
      </div>
    </div>
  );
};

const ConductoresPage: React.FC = () => {
  const [conductores, setConductores] = useState<Conductor[]>([]);
  const [isFormOpen, setIsFormOpen] = useState(false);
  const [selectedConductor, setSelectedConductor] = useState<Conductor | undefined>(undefined);

  const loadData = useCallback(async () => {
    try {
      setConductores(await operadorService.getConductores());
    } catch (error) {
      console.error('Error al cargar conductores:', error);
      setConductores([]);
    }
  }, []);

  useEffect(() => {
    loadData();
  }, [loadData]);

  const handleSave = () => {
    setIsFormOpen(false);
    setSelectedConductor(undefined);
    loadData();
  };

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold text-primary">Gestión de Conductores</h1>
        <button onClick={() => { setSelectedConductor(undefined); setIsFormOpen(true); }} className="bg-secondary hover:bg-secondary-dark text-white font-bold py-2 px-4 rounded-lg">
          Añadir Conductor
        </button>
      </div>

      <div className="bg-surface rounded-lg shadow-md overflow-x-auto">
        <table className="w-full text-sm text-left text-text-muted">
          <thead className="text-xs text-text uppercase bg-background">
            <tr>
              <th className="px-6 py-3">Nombre</th>
              <th className="px-6 py-3">Cédula</th>
              <th className="px-6 py-3">Licencia</th>
              <th className="px-6 py-3">Vencimiento</th>
              <th className="px-6 py-3">Estado</th>
              <th className="px-6 py-3">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {conductores.map(c => (
              <tr key={c.id} className="bg-surface border-b hover:bg-background/50">
                <td className="px-6 py-4 font-medium text-text">{c.nombre}</td>
                <td className="px-6 py-4">{c.cedula}</td>
                <td className="px-6 py-4">{c.tipoLicencia}</td>
                <td className="px-6 py-4">{c.vencimientoLicencia}</td>
                <td className="px-6 py-4">
                  <span className={`px-2 py-1 text-xs font-medium rounded-full ${c.estado === 'activo' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}`}>
                    {c.estado}
                  </span>
                </td>
                <td className="px-6 py-4">
                  <button onClick={() => { setSelectedConductor(c); setIsFormOpen(true); }} className="font-medium text-primary hover:underline">Editar</button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
        {conductores.length === 0 && <p className="text-center p-4">No hay conductores registrados.</p>}
      </div>
      {isFormOpen && (
        <ConductorForm
          conductor={selectedConductor}
          onSave={handleSave}
          onCancel={() => setIsFormOpen(false)}
        />
      )}
    </div>
  );
};

export default ConductoresPage;

────────────────────────────────────────────────────────────
FILE: src\pages\operador\EmpresaPage.tsx
────────────────────────────────────────────────────────────

import React, { useEffect, useState } from 'react';
import { useForm } from 'react-hook-form';
import { Empresa } from '../../types';
import { operadorService } from '../../services/operadorService';
import { useAuth } from '../../contexts/AuthContext';

const EmpresaPage: React.FC = () => {
    const { register, handleSubmit, reset, setValue, formState: { errors, isSubmitting } } = useForm<Empresa>();
    const { user } = useAuth();
    const [isLoading, setIsLoading] = useState(true);
    const [message, setMessage] = useState<{ type: 'success' | 'error', text: string } | null>(null);

    // Cargar datos iniciales
    useEffect(() => {
        const loadData = async () => {
            if (!user) return;
            setIsLoading(true);
            try {
                const data = await operadorService.getEmpresa();
                if (data) {
                    // Seteamos los valores del formulario
                    reset({
                        nombre: data.nombre || '',
                        nit: data.nit || '',
                        email: data.email || '',
                        telefono: data.telefono || '',
                        direccion: data.direccion || '',
                        logoUrl: data.logoUrl || ''
                    });
                }
            } catch (error) {
                console.error("Error cargando empresa:", error);
                setMessage({ type: 'error', text: 'No se pudieron cargar los datos de la empresa.' });
            } finally {
                setIsLoading(false);
            }
        };
        loadData();
    }, [user, reset]);

    const onSubmit = async (data: Empresa) => {
        setMessage(null);
        try {
            await operadorService.updateEmpresa(data);
            setMessage({ type: 'success', text: 'Información actualizada correctamente.' });
        } catch (error) {
            console.error(error);
            setMessage({ type: 'error', text: 'Error al guardar los cambios.' });
        }
    };

    if (isLoading) return <div className="p-8 text-center">Cargando perfil...</div>;

    return (
        <div className="max-w-4xl mx-auto">
            <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                <div className="bg-gray-50 px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h2 className="text-lg font-bold text-gray-900">Perfil de la Empresa</h2>
                    <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-semibold">Operador Autorizado</span>
                </div>

                <div className="p-6">
                    {message && (
                        <div className={`mb-6 p-4 rounded-lg text-sm font-medium ${message.type === 'success' ? 'bg-green-50 text-green-700 border border-green-200' : 'bg-red-50 text-red-700 border border-red-200'}`}>
                            {message.text}
                        </div>
                    )}

                    <form onSubmit={handleSubmit(onSubmit)} className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {/* Sección Identidad */}
                        <div className="md:col-span-2">
                            <h3 className="text-sm font-bold text-gray-900 uppercase tracking-wide mb-4 border-b pb-2">Identidad Corporativa</h3>
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Nombre Comercial / Razón Social</label>
                            <input {...register('nombre', { required: 'Requerido' })} className="input-field" />
                            {errors.nombre && <span className="text-red-500 text-xs">{errors.nombre.message}</span>}
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">NIT (Número de Identificación Tributaria)</label>
                            <input {...register('nit', { required: 'Requerido' })} className="input-field" />
                            {errors.nit && <span className="text-red-500 text-xs">{errors.nit.message}</span>}
                        </div>

                        <div className="md:col-span-2">
                            <label className="block text-sm font-medium text-gray-700 mb-1">URL del Logo (Imagen pública)</label>
                            <div className="flex gap-2">
                                <input {...register('logoUrl')} className="input-field flex-1" placeholder="https://ejemplo.com/logo.png" />
                                <div className="w-12 h-12 bg-gray-100 rounded-lg border border-gray-300 flex items-center justify-center overflow-hidden">
                                    {/* Previsualización simple */}
                                    <img
                                        src="https://via.placeholder.com/40?text=Logo"
                                        onError={(e) => e.currentTarget.style.display = 'none'}
                                        className="w-full h-full object-cover"
                                    />
                                </div>
                            </div>
                            <p className="text-xs text-gray-500 mt-1">Recomendado: Imagen cuadrada, fondo transparente (PNG).</p>
                        </div>

                        {/* Sección Contacto */}
                        <div className="md:col-span-2 mt-4">
                            <h3 className="text-sm font-bold text-gray-900 uppercase tracking-wide mb-4 border-b pb-2">Datos de Contacto</h3>
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Correo Electrónico Público</label>
                            <input type="email" {...register('email', { required: 'Requerido' })} className="input-field" />
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Teléfono / Celular</label>
                            <input {...register('telefono', { required: 'Requerido' })} className="input-field" />
                        </div>

                        <div className="md:col-span-2">
                            <label className="block text-sm font-medium text-gray-700 mb-1">Dirección de Oficina Central</label>
                            <input {...register('direccion')} className="input-field" placeholder="Av. Principal #123, Zona..." />
                        </div>

                        <div className="md:col-span-2 pt-4 flex justify-end">
                            <button
                                type="submit"
                                disabled={isSubmitting}
                                className="btn-primary w-full md:w-auto"
                            >
                                {isSubmitting ? 'Guardando...' : 'Guardar Cambios'}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    );
};

export default EmpresaPage;

────────────────────────────────────────────────────────────
FILE: src\pages\operador\HorariosPage.tsx
────────────────────────────────────────────────────────────

import React, { useEffect, useMemo, useState } from 'react';
import { useForm } from 'react-hook-form';
import { Ruta, Vehiculo, Horario } from '../../types';
import { operadorService } from '../../services/operadorService';

// Extendemos el tipo para el formulario localmente
type HorarioForm = {
  vehiculoId: string;
  diasText: string; // input helper "Lunes, Martes"
  horaSalida: string;
  tarifaGeneral: number;
  // Añadimos lógica visual de fechas (aunque el backend por ahora use recurrencia simple)
  fechaInicio?: string;
  fechaFin?: string;
};

const DIAS_OPTIONS = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo"];

const HorariosPage: React.FC = () => {
  // ... (estados iguales a tu código original)
  const [rutas, setRutas] = useState<Ruta[]>([]);
  const [vehiculos, setVehiculos] = useState<Vehiculo[]>([]);
  const [horarios, setHorarios] = useState<Horario[]>([]);
  const [selectedRutaId, setSelectedRutaId] = useState<string>('');
  const [showModal, setShowModal] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Hook Form
  const { register, handleSubmit, reset, setValue, watch, formState: { isSubmitting } } = useForm<HorarioForm>();

  // Helpers de selección de días
  const [selectedDays, setSelectedDays] = useState<string[]>([]);

  const toggleDay = (day: string) => {
    const newDays = selectedDays.includes(day)
      ? selectedDays.filter(d => d !== day)
      : [...selectedDays, day];
    setSelectedDays(newDays);
    setValue('diasText', newDays.join(','));
  };

  // Carga de datos (Igual que antes)
  useEffect(() => {
    const loadInit = async () => {
      const [r, v] = await Promise.all([operadorService.getRutas(), operadorService.getVehiculos()]);
      setRutas(r); setVehiculos(v);
    };
    loadInit();
  }, []);

  useEffect(() => {
    if (selectedRutaId) {
      operadorService.getHorariosByRuta(selectedRutaId).then(setHorarios);
    }
  }, [selectedRutaId]);

  const onSubmit = async (data: HorarioForm) => {
    try {
      if (selectedDays.length === 0) { alert("Selecciona al menos un día"); return; }

      await operadorService.saveHorario({
        rutaId: selectedRutaId,
        vehiculoId: data.vehiculoId,
        dias: selectedDays as any, // Casteo simple
        horaSalida: data.horaSalida,
        tarifaGeneral: data.tarifaGeneral
      });

      setShowModal(false);
      reset();
      setSelectedDays([]);
      // Recargar tabla
      operadorService.getHorariosByRuta(selectedRutaId).then(setHorarios);
    } catch (e) { console.error(e); }
  };

  const handleDelete = async (id: string) => {
    if (confirm("¿Eliminar itinerario?")) {
      await operadorService.deleteHorario(id);
      operadorService.getHorariosByRuta(selectedRutaId).then(setHorarios);
    }
  }

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold text-primary-900">Itinerarios y Tarifas</h1>
      </div>

      {/* Selector de Ruta Principal */}
      <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200 flex flex-col md:flex-row md:items-center gap-4">
        <div className="flex-1">
          <label className="block text-sm font-bold text-gray-700 mb-1">Seleccionar Ruta a Gestionar</label>
          <select
            className="input-field"
            value={selectedRutaId}
            onChange={(e) => setSelectedRutaId(e.target.value)}
          >
            <option value="">-- Selecciona una ruta --</option>
            {rutas.map(r => <option key={r.id} value={r.id}>{r.nombre} ({r.origen} - {r.destino})</option>)}
          </select>
        </div>
        <div className="md:self-end">
          <button
            onClick={() => setShowModal(true)}
            disabled={!selectedRutaId}
            className="btn-primary disabled:opacity-50 disabled:cursor-not-allowed"
          >
            + Nuevo Itinerario
          </button>
        </div>
      </div>

      {/* Tabla de Horarios */}
      {selectedRutaId && (
        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
          <table className="w-full text-left text-sm">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="p-4 font-semibold text-gray-700">Hora Salida</th>
                <th className="p-4 font-semibold text-gray-700">Días de Operación</th>
                <th className="p-4 font-semibold text-gray-700">Vehículo Asignado</th>
                <th className="p-4 font-semibold text-gray-700">Tarifa Base</th>
                <th className="p-4 font-semibold text-gray-700 text-right">Acciones</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-100">
              {horarios.map(h => {
                const veh = vehiculos.find(v => v.id === h.vehiculoId);
                return (
                  <tr key={h.id} className="hover:bg-gray-50">
                    <td className="p-4 font-bold text-gray-900 text-lg">{h.horaSalida}</td>
                    <td className="p-4">
                      <div className="flex flex-wrap gap-1">
                        {h.dias.map(d => (
                          <span key={d} className="px-2 py-0.5 bg-primary-50 text-primary-700 rounded text-xs border border-primary-100">
                            {d.substring(0, 3)}
                          </span>
                        ))}
                      </div>
                    </td>
                    <td className="p-4 text-gray-600">
                      {veh ? `${veh.modelo} (${veh.capacidad} pax)` : 'No asignado'}
                    </td>
                    <td className="p-4 font-medium text-secondary-600">
                      {h.tarifaGeneral} Bs
                    </td>
                    <td className="p-4 text-right">
                      <button onClick={() => handleDelete(h.id)} className="text-red-600 hover:text-red-800 font-medium">Eliminar</button>
                    </td>
                  </tr>
                )
              })}
              {horarios.length === 0 && (
                <tr><td colSpan={5} className="p-8 text-center text-gray-500">No hay itinerarios programados para esta ruta.</td></tr>
              )}
            </tbody>
          </table>
        </div>
      )}

      {/* Modal Nuevo Horario */}
      {showModal && (
        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6">
            <h2 className="text-xl font-bold text-gray-900 mb-4">Programar Salida Recurrente</h2>
            <p className="text-sm text-gray-500 mb-4">Define los días y horas en que los buses saldrán automáticamente para que los clientes puedan comprar en cualquier fecha futura.</p>

            <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Días de la semana</label>
                <div className="flex flex-wrap gap-2">
                  {DIAS_OPTIONS.map(day => (
                    <button
                      type="button"
                      key={day}
                      onClick={() => toggleDay(day)}
                      className={`px-3 py-1.5 rounded-full text-sm border transition-colors ${selectedDays.includes(day) ? 'bg-primary-600 text-white border-primary-600' : 'bg-white text-gray-600 border-gray-300 hover:border-primary-400'}`}
                    >
                      {day.substring(0, 3)}
                    </button>
                  ))}
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Hora Salida</label>
                  <input type="time" {...register('horaSalida', { required: true })} className="input-field" />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Tarifa (Bs)</label>
                  <input type="number" step="1" {...register('tarifaGeneral', { required: true })} className="input-field" />
                </div>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Vehículo Asignado</label>
                <select {...register('vehiculoId', { required: true })} className="input-field">
                  <option value="">Seleccionar bus...</option>
                  {vehiculos.map(v => <option key={v.id} value={v.id}>{v.patente} - {v.modelo} ({v.tipo || 'Estándar'})</option>)}
                </select>
              </div>

              {/* Simulación de Vigencia para UX */}
              <div className="grid grid-cols-2 gap-4 border-t pt-4 mt-2">
                <div>
                  <label className="block text-xs text-gray-500 mb-1">Válido Desde (Opcional)</label>
                  <input type="date" className="input-field text-xs" />
                </div>
                <div>
                  <label className="block text-xs text-gray-500 mb-1">Hasta (Opcional)</label>
                  <input type="date" className="input-field text-xs" />
                </div>
              </div>

              <div className="flex justify-end gap-3 pt-4">
                <button type="button" onClick={() => setShowModal(false)} className="btn-secondary">Cancelar</button>
                <button type="submit" className="btn-primary">Guardar Programación</button>
              </div>
            </form>
          </div>
        </div>
      )}
    </div>
  );
};

export default HorariosPage;

────────────────────────────────────────────────────────────
FILE: src\pages\operador\LoginPage.tsx
────────────────────────────────────────────────────────────


import React, { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useAuth } from '../../contexts/AuthContext';

const OperadorLoginPage: React.FC = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const { login, logout } = useAuth();
  const navigate = useNavigate();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    setIsLoading(true);
    try {
      const loggedInUser = await login(email, password);
      if (loggedInUser.role !== 'operador' && loggedInUser.role !== 'super-admin') {
          logout();
          setError('Acceso denegado. Esta área es solo para personal autorizado.');
          setIsLoading(false);
          return;
      }
      navigate('/operador');
    } catch (err: any) {
      setError(err.message || 'Ocurrió un error al iniciar sesión.');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="flex justify-center items-center py-12">
      <div className="w-full max-w-md bg-surface p-8 rounded-2xl shadow-xl">
        <h1 className="text-3xl font-bold text-primary text-center mb-2">Portal para Empresas</h1>
        <p className="text-text-muted text-center mb-6">Accede para gestionar tu flota, rutas y ventas.</p>
        
        {/* Example Credentials */}
        <div className="bg-primary/10 text-primary-dark text-sm p-3 rounded-lg mb-4 text-center">
            <p><strong>Demo:</strong> operador@transpo.bo / password</p>
        </div>

        <form onSubmit={handleSubmit} className="space-y-6">
          <div>
            <label htmlFor="email" className="block text-sm font-medium text-text-muted mb-1">Correo Electrónico</label>
            <input
              type="email"
              id="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
          <div>
            <label htmlFor="password" className="block text-sm font-medium text-text-muted mb-1">Contraseña</label>
            <input
              type="password"
              id="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
          {error && <p className="text-accent text-sm text-center">{error}</p>}
          <button
            type="submit"
            disabled={isLoading}
            className="w-full bg-primary hover:bg-primary-dark text-white font-bold py-3 px-4 rounded-lg transition-colors disabled:bg-gray-400"
          >
            {isLoading ? 'Ingresando...' : 'Ingresar al Panel'}
          </button>
        </form>
        <p className="text-center text-sm text-text-muted mt-6">
          ¿Aún no tienes una cuenta para tu empresa?{' '}
          <Link to="/operador/register" className="font-medium text-secondary hover:underline">
            Regístrala aquí
          </Link>
        </p>
      </div>
    </div>
  );
};

export default OperadorLoginPage;

────────────────────────────────────────────────────────────
FILE: src\pages\operador\MantenimientoPage.tsx
────────────────────────────────────────────────────────────

import React, { useState, useEffect, useCallback } from 'react';
import { AlertaMantenimiento } from '../../types';
import { operadorService } from '../../services/operadorService';
import { useAuth } from '../../contexts/AuthContext';

const MantenimientoPage: React.FC = () => {
  const [alertas, setAlertas] = useState<AlertaMantenimiento[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const { user } = useAuth();

  const loadAlertas = useCallback(async () => {
    setIsLoading(true);
    setAlertas(await operadorService.getAlertasMantenimiento());
    setIsLoading(false);
  }, []);

  useEffect(() => {
    if (user) loadAlertas();
  }, [user, loadAlertas]);

  const handleMarcarRevisado = async (vehiculoId: string) => {
    alert(`Vehículo con ID ${vehiculoId} marcado para revisión. (Demo)`);
    const vehiculos = await operadorService.getVehiculos();
    const vehiculo = vehiculos.find(v => v.id === vehiculoId);
    if (vehiculo) {
      vehiculo.fechaUltimaRevision = new Date().toISOString().split('T')[0];
      await operadorService.updateVehiculo(vehiculo);
      loadAlertas();
    }
  };

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold text-primary">Alertas de Mantenimiento</h1>
      {isLoading ? (
        <p>Cargando alertas...</p>
      ) : (
        <div className="bg-surface rounded-lg shadow-md">
          <ul className="divide-y divide-gray-200">
            {alertas.length > 0 ? alertas.map(alerta => (
              <li key={alerta.id} className="p-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div className="flex items-center gap-4">
                  <div className="flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                         strokeWidth={1.5} stroke="currentColor" className="w-8 h-8 text-accent">
                      <path strokeLinecap="round" strokeLinejoin="round"
                            d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                    </svg>
                  </div>
                  <div>
                    <p className="font-bold text-text">Vehículo: {alerta.vehiculoPatente}</p>
                    <p className="text-sm text-text-muted">{alerta.mensaje}</p>
                    <p className="text-xs text-accent">Vencimiento: {alerta.fechaVencimiento}</p>
                  </div>
                </div>
                <button
                  onClick={() => handleMarcarRevisado(alerta.vehiculoId)}
                  className="bg-secondary/20 hover:bg-secondary/40 text-secondary-dark font-bold py-2 px-4 rounded-lg text-sm whitespace-nowrap">
                  Marcar como Revisado
                </button>
              </li>
            )) : (
              <li className="p-6 text-center text-text-muted">
                ¡Excelente! No hay alertas de mantenimiento pendientes.
              </li>
            )}
          </ul>
        </div>
      )}
    </div>
  );
};

export default MantenimientoPage;

────────────────────────────────────────────────────────────
FILE: src\pages\operador\OperadorDashboard.tsx
────────────────────────────────────────────────────────────

// pages/operador/OperadorDashboard.tsx
import React, { useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import { operadorService } from '../../services/operadorService';

const quickLinks = [
  {
    to: '/operador/vehiculos',
    title: 'Gestionar Vehículos',
    description: 'Añade, edita y revisa tu flota.',
    icon: (p: any) => (
      <svg {...p} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
           strokeWidth={1.5} stroke="currentColor">
        <path d="M11.25 3.375a.75.75 0 0 0-1.5 0V4.5h1.5V3.375Z" />
        <path fillRule="evenodd" d="M12.75 3.75a.75.75 0 0 1 .75-.75h2.25a.75.75 0 0 1 0 1.5H14.25v1.5h1.5a.75.75 0 0 1 .75.75v3a.75.75 0 0 1-.75.75h-3a.75.75 0 0 1-.75-.75v-3a.75.75 0 0 1 .75-.75h1.5V4.5h-1.5a.75.75 0 0 1-.75-.75Zm1.5 3h1.5V5.25h-1.5v1.5Z" clipRule="evenodd" />
        <path d="M1.5 18.75a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H1.5Z" />
        <path d="M4.5 18.75a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H4.5Z" />
        <path fillRule="evenodd" d="M22.5 12c0-4.073-2.91-7.46-6.825-8.485A.75.75 0 0 0 15 4.14v.36a.75.75 0 0 0 1.5 0V4.5a7.5 7.5 0 0 1 6 7.5c0 .63-.078 1.244-.228 1.834a.75.75 0 0 0 .445.895A9 9 0 0 0 6.6 18.36a.75.75 0 0 0 .898.445A7.5 7.5 0 0 1 12 19.5a.75.75 0 0 0 0-1.5 6 6 0 0 0-5.326-5.952.75.75 0 0 0-.65-1.121A9.001 9.001 0 0 0 22.5 12Z" clipRule="evenodd" />
      </svg>
    ),
  },
  {
    to: '/operador/rutas',
    title: 'Definir Rutas',
    description: 'Crea nuevas rutas y gestiona paradas.',
    icon: (p: any) => (
      <svg {...p} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
           strokeWidth={1.5} stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" d="M9 6.75V15m6-6v8.25m.5-11.25-1.518 1.518A2.25 2.25 0 0 1 13.5 6.75V15a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 15V6.75A2.25 2.25 0 0 1 6.75 4.5h4.218a2.25 2.25 0 0 1 1.518.632Z" />
      </svg>
    ),
  },
  {
    to: '/operador/mantenimiento',
    title: 'Ver Alertas',
    description: 'Revisa mantenimientos pendientes.',
    icon: (p: any) => (
      <svg {...p} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
           strokeWidth={1.5} stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round"
              d="M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.471-2.471a1.125 1.125 0 0 1 1.591 0L16.5 13.75m-5.08-3.582L6 16.5m5.08-3.582-2.471 2.471a1.125 1.125 0 0 0 0 1.591l.524.524a1.125 1.125 0 0 0 1.59 0l2.472-2.471m-5.08-3.582L3.75 9.172a2.652 2.652 0 0 0-2.652 2.652L3.75 15.5m-1.5-1.5 5.877 5.877" />
      </svg>
    ),
  },
];

const OperadorDashboard: React.FC = () => {
  const [isLoading, setIsLoading] = useState<boolean>(true);
  const [resumen, setResumen] = useState<{
    vehiculosActivos: number;
    conductores: number;
    rutas: number;
    alertas: number;
  }>({
    vehiculosActivos: 0,
    conductores: 0,
    rutas: 0,
    alertas: 0,
  });

  useEffect(() => {
    const load = async () => {
      try {
        const data = await operadorService.getResumen();
        setResumen({
          vehiculosActivos: data.vehiculosActivos || 0,
          conductores: data.conductores || 0,
          rutas: data.rutas || 0,
          alertas: data.alertas || 0,
        });
      } catch (e) {
        console.error('Error cargando resumen', e);
      } finally {
        setIsLoading(false);
      }
    };
    load();
  }, []);

  return (
    <div className="space-y-6">
      <div className="bg-surface p-6 rounded-lg shadow-md">
        <h1 className="text-3xl font-bold text-primary">Bienvenido al Panel de Operador</h1>
        <p className="text-text-muted mt-1">
          Administra tu empresa, flota, rutas y horarios desde un solo lugar.
        </p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {quickLinks.map(link => (
          <Link
            to={link.to}
            key={link.to}
            className="bg-surface p-6 rounded-lg shadow-md hover:shadow-xl hover:border-primary border-2 border-transparent transition-all group"
          >
            <div className="flex items-center gap-4">
              <div className="bg-primary/10 p-3 rounded-full">
                {link.icon({
                  className: 'w-8 h-8 text-primary',
                })}
              </div>
              <div>
                <h3 className="text-lg font-bold text-primary group-hover:text-secondary">{link.title}</h3>
                <p className="text-sm text-text-muted">{link.description}</p>
              </div>
            </div>
          </Link>
        ))}
      </div>

      <div className="bg-surface p-6 rounded-lg shadow-md">
        <h2 className="text-2xl font-bold text-primary mb-4">Resumen Rápido</h2>

        {isLoading ? (
          <div className="text-center py-6">
            <div className="animate-spin rounded-full h-10 w-10 border-b-2 border-primary mx-auto"></div>
            <p className="mt-3 text-text-muted">Cargando datos...</p>
          </div>
        ) : (
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
            <div className="bg-background p-4 rounded-lg">
              <p className="text-3xl font-bold text-secondary">{resumen.vehiculosActivos}</p>
              <p className="text-sm text-text-muted">Vehículos Activos</p>
            </div>
            <div className="bg-background p-4 rounded-lg">
              <p className="text-3xl font-bold text-primary">{resumen.conductores}</p>
              <p className="text-sm text-text-muted">Conductores</p>
            </div>
            <div className="bg-background p-4 rounded-lg">
              <p className="text-3xl font-bold text-primary">{resumen.rutas}</p>
              <p className="text-sm text-text-muted">Rutas Definidas</p>
            </div>
            <div className="bg-background p-4 rounded-lg">
              <p className="text-3xl font-bold text-accent">{resumen.alertas}</p>
              <p className="text-sm text-text-muted">Alertas de Mantenimiento</p>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default OperadorDashboard;

────────────────────────────────────────────────────────────
FILE: src\pages\operador\OperadorLayout.tsx
────────────────────────────────────────────────────────────


import React, { Fragment } from 'react';
import { Routes, Route, Link, NavLink, useLocation } from 'react-router-dom';

// Import pages for the operator module
import OperadorDashboard from './OperadorDashboard';
import EmpresaPage from './EmpresaPage';
import VehiculosPage from './VehiculosPage';
import ConductoresPage from './ConductoresPage';
import RutasPage from './RutasPage';
import HorariosPage from './HorariosPage';
import MantenimientoPage from './MantenimientoPage';

const sidebarNavItems = [
  { href: '', text: 'Dashboard', icon: (p: any) => <svg {...p} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" /></svg> },
  { href: 'empresa', text: 'Mi Empresa', icon: (p: any) => <svg {...p} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M3.75 21h16.5M4.5 3h15M5.25 3v18M18.75 3v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6h1.5m-1.5 3h1.5m-1.5 3h1.5M6.75 21v-5.25a2.25 2.25 0 0 1 2.25-2.25h3a2.25 2.25 0 0 1 2.25 2.25V21M6.75 3v2.25" /></svg> },
  { href: 'vehiculos', text: 'Vehículos', icon: (p: any) => <svg {...p} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path d="M11.25 3.375a.75.75 0 0 0-1.5 0V4.5h1.5V3.375Z" /><path fillRule="evenodd" d="M12.75 3.75a.75.75 0 0 1 .75-.75h2.25a.75.75 0 0 1 0 1.5H14.25v1.5h1.5a.75.75 0 0 1 .75.75v3a.75.75 0 0 1-.75.75h-3a.75.75 0 0 1-.75-.75v-3a.75.75 0 0 1 .75-.75h1.5V4.5h-1.5a.75.75 0 0 1-.75-.75Zm1.5 3h1.5V5.25h-1.5v1.5Z" clipRule="evenodd" /><path d="M1.5 18.75a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H1.5Z" /><path d="M4.5 18.75a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H4.5Z" /><path fillRule="evenodd" d="M22.5 12c0-4.073-2.91-7.46-6.825-8.485A.75.75 0 0 0 15 4.14v.36a.75.75 0 0 0 1.5 0V4.5a7.5 7.5 0 0 1 6 7.5c0 .63-.078 1.244-.228 1.834a.75.75 0 0 0 .445.895A9 9 0 0 0 6.6 18.36a.75.75 0 0 0 .898.445A7.5 7.5 0 0 1 12 19.5a.75.75 0 0 0 0-1.5 6 6 0 0 0-5.326-5.952.75.75 0 0 0-.65-1.121A9.001 9.001 0 0 0 22.5 12Z" clipRule="evenodd" /></svg> },
  { href: 'conductores', text: 'Conductores', icon: (p: any) => <svg {...p} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm1.294 6.336a6.721 6.721 0 0 1-3.17.025A6.721 6.721 0 0 1 9.5 19.5h.008c.008.026.017.052.026.078Z" /></svg> },
  { href: 'rutas', text: 'Rutas', icon: (p: any) => <svg {...p} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M9 6.75V15m6-6v8.25m.5-11.25-1.518 1.518A2.25 2.25 0 0 1 13.5 6.75V15a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 15V6.75A2.25 2.25 0 0 1 6.75 4.5h4.218a2.25 2.25 0 0 1 1.518.632Z" /></svg> },
  { href: 'horarios', text: 'Horarios y Tarifas', icon: (p: any) => <svg {...p} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg> },
  { href: 'mantenimiento', text: 'Mantenimiento', icon: (p: any) => <svg {...p} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.471-2.471a1.125 1.125 0 0 1 1.591 0L16.5 13.75m-5.08-3.582L6 16.5m5.08-3.582-2.471 2.471a1.125 1.125 0 0 0 0 1.591l.524.524a1.125 1.125 0 0 0 1.59 0l2.472-2.471m-5.08-3.582L3.75 9.172a2.652 2.652 0 0 0-2.652 2.652L3.75 15.5m-1.5-1.5 5.877 5.877m0 0L15.5 3.75m-3.75 3.75L3.75 15.5m0 0h11.25" /></svg> },
];

const Breadcrumbs = () => {
    const location = useLocation();
    const pathnames = location.pathname.split('/').filter(x => x);
    const currentSection = sidebarNavItems.find(item => item.href === pathnames[1])?.text || 'Operador';
    
    return (
        <nav className="mb-6 text-sm" aria-label="Breadcrumb">
            <ol className="list-none p-0 inline-flex">
                <li className="flex items-center">
                    <Link to="/operador" className="text-text-muted hover:text-primary">Panel Operador</Link>
                </li>
                {pathnames.length > 1 && (
                    <li className="flex items-center">
                        <span className="mx-2">/</span>
                        <span className="text-text font-medium">{currentSection}</span>
                    </li>
                )}
            </ol>
        </nav>
    );
};

const OperadorLayout: React.FC = () => {
  const base = "/operador/";
  
  return (
    <div className="flex flex-col md:flex-row gap-8">
      <aside className="md:w-64 flex-shrink-0">
        <div className="bg-surface rounded-lg shadow-md p-4 sticky top-24">
          <nav className="flex flex-col gap-2">
            {sidebarNavItems.map(item => (
                <NavLink
                  key={item.href}
                  to={base + item.href}
                  end={item.href === ''}
                  className={({ isActive }) => 
                    `flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium transition-colors ${
                      isActive 
                      ? 'bg-primary-light text-white' 
                      : 'text-text-muted hover:bg-background hover:text-primary'
                    }`
                  }
                >
                    {item.icon({className: "w-5 h-5"})}
                    <span>{item.text}</span>
                </NavLink>
            ))}
          </nav>
        </div>
      </aside>
      <main className="flex-1">
        <Breadcrumbs />
        <Routes>
          <Route path="/" element={<OperadorDashboard />} />
          <Route path="empresa" element={<EmpresaPage />} />
          <Route path="vehiculos" element={<VehiculosPage />} />
          <Route path="conductores" element={<ConductoresPage />} />
          <Route path="rutas" element={<RutasPage />} />
          <Route path="horarios" element={<HorariosPage />} />
          <Route path="mantenimiento" element={<MantenimientoPage />} />
        </Routes>
      </main>
    </div>
  );
};

export default OperadorLayout;

────────────────────────────────────────────────────────────
FILE: src\pages\operador\RegisterPage.tsx
────────────────────────────────────────────────────────────


import React, { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useAuth } from '../../contexts/AuthContext';

const OperadorRegisterPage: React.FC = () => {
  const [nombreEmpresa, setNombreEmpresa] = useState('');
  const [nit, setNit] = useState('');
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const { registerOperator } = useAuth();
  const navigate = useNavigate();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (password !== confirmPassword) {
      setError('Las contraseñas no coinciden.');
      return;
    }
    setError('');
    setIsLoading(true);
    try {
      await registerOperator(nombreEmpresa, nit, email, password);
      navigate('/operador'); // Redirect to operator panel after registration
    } catch (err: any) {
      setError(err.message || 'Ocurrió un error durante el registro.');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="flex justify-center items-center py-12">
      <div className="w-full max-w-md bg-surface p-8 rounded-2xl shadow-xl">
        <h1 className="text-3xl font-bold text-primary text-center mb-2">Registra tu Empresa</h1>
        <p className="text-text-muted text-center mb-6">Únete a nuestra red de operadores y digitaliza tus ventas.</p>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label htmlFor="nombreEmpresa" className="block text-sm font-medium text-text-muted mb-1">Nombre de la Empresa</label>
            <input
              type="text"
              id="nombreEmpresa"
              value={nombreEmpresa}
              onChange={(e) => setNombreEmpresa(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
           <div>
            <label htmlFor="nit" className="block text-sm font-medium text-text-muted mb-1">NIT (Número de Identificación Tributaria)</label>
            <input
              type="text"
              id="nit"
              value={nit}
              onChange={(e) => setNit(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
          <div>
            <label htmlFor="email" className="block text-sm font-medium text-text-muted mb-1">Correo Electrónico de Contacto</label>
            <input
              type="email"
              id="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
          <div>
            <label htmlFor="password" className="block text-sm font-medium text-text-muted mb-1">Contraseña</label>
            <input
              type="password"
              id="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
           <div>
            <label htmlFor="confirmPassword" className="block text-sm font-medium text-text-muted mb-1">Confirmar Contraseña</label>
            <input
              type="password"
              id="confirmPassword"
              value={confirmPassword}
              onChange={(e) => setConfirmPassword(e.target.value)}
              required
              className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-light"
            />
          </div>
          {error && <p className="text-accent text-sm text-center">{error}</p>}
          <button
            type="submit"
            disabled={isLoading}
            className="w-full bg-secondary hover:bg-secondary-dark text-white font-bold py-3 px-4 rounded-lg transition-colors disabled:bg-gray-400 mt-4"
          >
            {isLoading ? 'Creando cuenta...' : 'Crear Cuenta de Empresa'}
          </button>
        </form>
        <p className="text-center text-sm text-text-muted mt-6">
          ¿Ya tienes una cuenta de empresa?{' '}
          <Link to="/operador/login" className="font-medium text-primary hover:underline">
            Inicia sesión aquí
          </Link>
        </p>
      </div>
    </div>
  );
};

export default OperadorRegisterPage;

────────────────────────────────────────────────────────────
FILE: src\pages\operador\RutasPage.tsx
────────────────────────────────────────────────────────────

import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useForm } from 'react-hook-form';
import { Ruta, Parada } from '../../types';
import { operadorService } from '../../services/operadorService';
import { MapContainer, TileLayer, Marker, useMapEvents, Popup } from 'react-leaflet';
import { CIUDADES } from '../../constants';

const MapPicker: React.FC<{ onLocationSelect: (lat: number, lng: number) => void }> = ({ onLocationSelect }) => {
  const [position, setPosition] = useState<[number, number] | null>(null);
  const map = useMapEvents({
    click(e) {
      const { lat, lng } = e.latlng;
      setPosition([lat, lng]);
      onLocationSelect(lat, lng);
      map.flyTo(e.latlng, map.getZoom());
    },
  });
  return position === null ? null : (
    <Marker position={position}>
      <Popup>Ubicación seleccionada</Popup>
    </Marker>
  );
};

const RutasPage: React.FC = () => {
  const [rutas, setRutas] = useState<Ruta[]>([]);
  const [selectedRuta, setSelectedRuta] = useState<Ruta | null>(null);

  const { register, handleSubmit, setValue, reset, watch, formState: { errors } } = useForm<Parada>();
  const paradaFormValues = watch();

  const loadRutas = useCallback(async () => {
    try {
      setRutas(await operadorService.getRutas());
    } catch (error) {
      console.error('Error al cargar rutas:', error);
      setRutas([]);
    }
  }, []);

  useEffect(() => { loadRutas(); }, [loadRutas]);

  const handleSelectRuta = (ruta: Ruta) => setSelectedRuta(ruta);

  const onAddOrUpdateParada = async (data: Parada) => {
    if (!selectedRuta) return;
    let updatedParadas: Parada[];
    if (data.id) {
      updatedParadas = selectedRuta.paradas.map(p => p.id === data.id ? data : p);
    } else {
      updatedParadas = [...selectedRuta.paradas, { ...data, id: `p-${Date.now()}` }];
    }
    const updatedRuta = await operadorService.updateRuta({ ...selectedRuta, paradas: updatedParadas });
    setSelectedRuta(updatedRuta);
    setRutas(rutas.map(r => r.id === updatedRuta.id ? updatedRuta : r));
    reset({ id: '', nombre: '', lat: 0, lng: 0 });
  };

  const handleLocationSelect = (lat: number, lng: number) => {
    setValue('lat', parseFloat(lat.toFixed(6)));
    setValue('lng', parseFloat(lng.toFixed(6)));
  };

  const initialPosition: [number, number] = useMemo(() => [-16.5, -68.15], []);

  // Form para crear nueva ruta
  const { register: regRuta, handleSubmit: submitRuta, reset: resetRuta, formState: { isSubmitting: creatingRuta } } = useForm<{
    nombre: string; origen: string; destino: string;
  }>({
    defaultValues: { nombre: '', origen: CIUDADES[0].id, destino: CIUDADES[1].id },
  });

  const onCreateRuta = async (data: { nombre: string; origen: string; destino: string }) => {
    const nueva = await operadorService.createRuta({ ...data, paradas: [] });
    setRutas(prev => [nueva, ...prev]);
    resetRuta({ nombre: '', origen: CIUDADES[0].id, destino: CIUDADES[1].id });
  };

  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div className="md:col-span-1 space-y-4">
        <h1 className="text-2xl font-bold text-primary">Rutas</h1>

        <div className="bg-surface rounded-lg shadow-md p-4 space-y-3">
          <h3 className="font-bold text-secondary">Crear nueva ruta</h3>
          <form onSubmit={submitRuta(onCreateRuta)} className="space-y-2">
            <div>
              <label className="text-sm text-text-muted">Nombre</label>
              <input {...regRuta('nombre', { required: true })} className="w-full p-2 border rounded" placeholder="Ej: La Paz - Cochabamba" />
            </div>
            <div className="grid grid-cols-2 gap-2">
              <div>
                <label className="text-sm text-text-muted">Origen</label>
                <select {...regRuta('origen')} className="w-full p-2 border rounded">
                  {CIUDADES.map(c => <option key={c.id} value={c.id}>{c.nombre}</option>)}
                </select>
              </div>
              <div>
                <label className="text-sm text-text-muted">Destino</label>
                <select {...regRuta('destino')} className="w-full p-2 border rounded">
                  {CIUDADES.map(c => <option key={c.id} value={c.id}>{c.nombre}</option>)}
                </select>
              </div>
            </div>
            <button type="submit" disabled={creatingRuta} className="w-full bg-primary text-white font-bold py-2 rounded">
              {creatingRuta ? 'Creando...' : 'Crear Ruta'}
            </button>
          </form>
        </div>

        <div className="bg-surface rounded-lg shadow-md p-4 space-y-2">
          {rutas.map(ruta => (
            <button
              key={ruta.id}
              onClick={() => handleSelectRuta(ruta)}
              className={`w-full text-left p-3 rounded-md transition-colors ${selectedRuta?.id === ruta.id ? 'bg-primary text-white' : 'hover:bg-background'}`}
            >
              <p className="font-bold">{ruta.nombre}</p>
              <p className="text-xs">{ruta.paradas.length} paradas</p>
            </button>
          ))}
          {rutas.length === 0 && <p className="text-center p-4 text-sm text-text-muted">No hay rutas registradas.</p>}
        </div>
      </div>

      <div className="md:col-span-2 bg-surface rounded-lg shadow-md p-6">
        {selectedRuta ? (
          <div>
            <h2 className="text-xl font-bold text-secondary mb-4">Gestionar Paradas para: {selectedRuta.nombre}</h2>
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div>
                <h3 className="font-bold mb-2">Paradas Actuales</h3>
                <ul className="space-y-2 max-h-60 overflow-y-auto pr-2">
                  {selectedRuta.paradas.map(parada => (
                    <li key={parada.id} className="flex justify-between items-center bg-background p-2 rounded-md">
                      <span>{parada.nombre}</span>
                      <button onClick={() => reset(parada)} className="text-xs text-primary hover:underline">Editar</button>
                    </li>
                  ))}
                </ul>
                {selectedRuta.paradas.length === 0 && <p className="text-sm text-text-muted">No hay paradas definidas.</p>}
              </div>

              <form onSubmit={handleSubmit(onAddOrUpdateParada)} className="space-y-3">
                <h3 className="font-bold">{paradaFormValues.id ? 'Editando Parada' : 'Añadir Nueva Parada'}</h3>
                <input type="hidden" {...register('id')} />
                <div>
                  <label className="text-sm font-medium text-text-muted">Nombre Parada</label>
                  <input {...register('nombre', { required: true })} className="w-full p-2 border border-gray-300 rounded-md mt-1" />
                </div>
                <div className="grid grid-cols-2 gap-2">
                  <div>
                    <label className="text-sm font-medium text-text-muted">Latitud</label>
                    <input type="number" step="any" {...register('lat', { required: true, valueAsNumber: true })} className="w-full p-2 border border-gray-300 rounded-md mt-1" />
                  </div>
                  <div>
                    <label className="text-sm font-medium text-text-muted">Longitud</label>
                    <input type="number" step="any" {...register('lng', { required: true, valueAsNumber: true })} className="w-full p-2 border border-gray-300 rounded-md mt-1" />
                  </div>
                </div>
                <p className="text-xs text-text-muted">Haz clic en el mapa para seleccionar la ubicación.</p>
                <div className="h-48 w-full rounded-lg overflow-hidden z-0">
                  <MapContainer center={initialPosition} zoom={7} style={{ height: '100%', width: '100%' }}>
                    <TileLayer url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png" attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors' />
                    <MapPicker onLocationSelect={handleLocationSelect} />
                    {paradaFormValues.lat && paradaFormValues.lng && <Marker position={[paradaFormValues.lat, paradaFormValues.lng]} />}
                  </MapContainer>
                </div>
                <div className="flex justify-end gap-2">
                  {paradaFormValues.id && <button type="button" onClick={() => reset({ id: '', nombre: '', lat: 0, lng: 0 })} className="bg-gray-200 text-text px-3 py-2 rounded-md text-sm">Cancelar Edición</button>}
                  <button type="submit" className="bg-primary hover:bg-primary-dark text-white font-bold py-2 px-4 rounded-lg">{paradaFormValues.id ? 'Actualizar' : 'Añadir'}</button>
                </div>
              </form>
            </div>
          </div>
        ) : (
          <div className="text-center py-20">
            <p className="text-text-muted">Selecciona una ruta para ver y gestionar sus paradas.</p>
          </div>
        )}
      </div>
    </div>
  );
};

export default RutasPage;

────────────────────────────────────────────────────────────
FILE: src\pages\operador\VehiculosPage.tsx
────────────────────────────────────────────────────────────

// pages/operador/VehiculosPage.tsx
import React, { useState, useEffect, useCallback } from 'react';
import { useForm } from 'react-hook-form';
import { Vehiculo } from '../../types';
import { operadorService } from '../../services/operadorService';

const estadosVehiculo: Vehiculo['estado'][] = ['activo', 'inactivo', 'mantenimiento'];

const VehiculoForm: React.FC<{
  vehiculo?: Vehiculo;
  onSave: () => void;
  onCancel: () => void;
}> = ({ vehiculo, onSave, onCancel }) => {
  const { register, handleSubmit, formState: { errors, isSubmitting } } = useForm<Omit<Vehiculo, 'id' | 'empresaId' | 'empresa'>>({
    defaultValues: vehiculo || {
      patente: '',
      modelo: '',
      capacidad: 40,
      estado: 'activo',
      fechaUltimaRevision: new Date().toISOString().split('T')[0],
    }
  });

  const onSubmit = async (data: Omit<Vehiculo, 'id' | 'empresaId' | 'empresa'>) => {
    try {
      if (vehiculo?.id) {
        await operadorService.updateVehiculo(vehiculo.id, data);
      } else {
        await operadorService.addVehiculo(data);
      }
      onSave();
    } catch (error: any) {
      console.error('Error al guardar vehículo:', error);
      alert(error.message || 'Error al guardar vehículo');
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex justify-center items-center z-50 p-4">
      <div className="bg-surface p-6 rounded-lg shadow-xl w-full max-w-lg">
        <h2 className="text-xl font-bold text-primary mb-4">{vehiculo ? 'Editar' : 'Añadir'} Vehículo</h2>
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <div>
            <label htmlFor="patente" className="block text-sm font-medium text-text-muted">Patente</label>
            <input id="patente" {...register('patente', { required: 'La patente es obligatoria' })} className="mt-1 block w-full p-2 border border-gray-300 rounded-md" />
            {errors.patente && <p className="text-accent text-xs mt-1">{errors.patente.message}</p>}
          </div>
          <div>
            <label htmlFor="modelo" className="block text-sm font-medium text-text-muted">Modelo</label>
            <input id="modelo" {...register('modelo', { required: 'El modelo es obligatorio' })} className="mt-1 block w-full p-2 border border-gray-300 rounded-md" />
            {errors.modelo && <p className="text-accent text-xs mt-1">{errors.modelo.message}</p>}
          </div>
          <div>
            <label htmlFor="capacidad" className="block text-sm font-medium text-text-muted">Capacidad</label>
            <input id="capacidad" type="number" {...register('capacidad', { required: 'La capacidad es obligatoria', valueAsNumber: true })} className="mt-1 block w-full p-2 border border-gray-300 rounded-md" />
            {errors.capacidad && <p className="text-accent text-xs mt-1">{errors.capacidad.message}</p>}
          </div>
          <div>
            <label htmlFor="fechaUltimaRevision" className="block text-sm font-medium text-text-muted">Última Revisión</label>
            <input id="fechaUltimaRevision" type="date" {...register('fechaUltimaRevision', { required: 'La fecha es obligatoria' })} className="mt-1 block w-full p-2 border border-gray-300 rounded-md" />
            {errors.fechaUltimaRevision && <p className="text-accent text-xs mt-1">{errors.fechaUltimaRevision.message}</p>}
          </div>
          <div>
            <label htmlFor="estado" className="block text-sm font-medium text-text-muted">Estado</label>
            <select id="estado" {...register('estado')} className="mt-1 block w-full p-2 border border-gray-300 rounded-md">
              {estadosVehiculo.map(estado => (
                <option key={estado} value={estado}>{estado.charAt(0).toUpperCase() + estado.slice(1)}</option>
              ))}
            </select>
          </div>
          <div className="flex justify-end gap-3 pt-4">
            <button type="button" onClick={onCancel} className="bg-gray-200 hover:bg-gray-300 text-text font-bold py-2 px-4 rounded-lg">Cancelar</button>
            <button type="submit" disabled={isSubmitting} className="bg-primary hover:bg-primary-dark text-white font-bold py-2 px-4 rounded-lg disabled:bg-gray-400">
              {isSubmitting ? 'Guardando...' : 'Guardar'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

const VehiculosPage: React.FC = () => {
  const [vehiculos, setVehiculos] = useState<Vehiculo[]>([]);
  const [isFormOpen, setIsFormOpen] = useState(false);
  const [selectedVehiculo, setSelectedVehiculo] = useState<Vehiculo | undefined>(undefined);

  const loadVehiculos = useCallback(async () => {
    try {
      const data = await operadorService.getVehiculos();
      setVehiculos(data);
    } catch (error) {
      console.error('Error al cargar vehículos:', error);
      setVehiculos([]);
    }
  }, []);

  useEffect(() => {
    loadVehiculos();
  }, [loadVehiculos]);

  const handleSave = () => {
    setIsFormOpen(false);
    setSelectedVehiculo(undefined);
    loadVehiculos();
  };

  const handleDelete = async (id: string) => {
    if (confirm('¿Estás seguro de que quieres eliminar este vehículo?')) {
      try {
        await operadorService.deleteVehiculo(id);
        loadVehiculos();
      } catch (e: any) {
        alert(e.message || 'Error al eliminar vehículo');
      }
    }
  };

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold text-primary">Gestión de Vehículos</h1>
        <button onClick={() => { setSelectedVehiculo(undefined); setIsFormOpen(true); }} className="bg-secondary hover:bg-secondary-dark text-white font-bold py-2 px-4 rounded-lg">
          Añadir Vehículo
        </button>
      </div>

      <div className="bg-surface rounded-lg shadow-md overflow-x-auto">
        <table className="w-full text-sm text-left text-text-muted">
          <thead className="text-xs text-text uppercase bg-background">
            <tr>
              <th scope="col" className="px-6 py-3">Patente</th>
              <th scope="col" className="px-6 py-3">Modelo</th>
              <th scope="col" className="px-6 py-3">Capacidad</th>
              <th scope="col" className="px-6 py-3">Estado</th>
              <th scope="col" className="px-6 py-3">Última Revisión</th>
              <th scope="col" className="px-6 py-3"><span className="sr-only">Acciones</span></th>
            </tr>
          </thead>
          <tbody>
            {vehiculos.map(v => (
              <tr key={v.id} className="bg-surface border-b hover:bg-background/50">
                <th scope="row" className="px-6 py-4 font-medium text-text whitespace-nowrap">{v.patente}</th>
                <td className="px-6 py-4">{v.modelo}</td>
                <td className="px-6 py-4">{v.capacidad}</td>
                <td className="px-6 py-4">
                  <span className={`px-2 py-1 text-xs font-medium rounded-full ${v.estado === 'activo' ? 'bg-green-100 text-green-800' : v.estado === 'inactivo' ? 'bg-gray-100 text-gray-800' : 'bg-yellow-100 text-yellow-800'}`}>
                    {v.estado}
                  </span>
                </td>
                <td className="px-6 py-4">{v.fechaUltimaRevision}</td>
                <td className="px-6 py-4 text-right space-x-2">
                  <button onClick={() => { setSelectedVehiculo(v); setIsFormOpen(true); }} className="font-medium text-primary hover:underline">Editar</button>
                  <button onClick={() => handleDelete(v.id)} className="font-medium text-accent hover:underline">Eliminar</button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
        {vehiculos.length === 0 && <p className="text-center p-4 text-text-muted">No hay vehículos registrados.</p>}
      </div>

      {isFormOpen && (
        <VehiculoForm
          vehiculo={selectedVehiculo}
          onSave={handleSave}
          onCancel={() => setIsFormOpen(false)}
        />
      )}
    </div>
  );
};

export default VehiculosPage;


============================================================
DIR: src\pages\operator
============================================================


────────────────────────────────────────────────────────────
FILE: src\pages\operator\CompanyProfilePage.tsx
────────────────────────────────────────────────────────────

import React, { useState, useEffect } from 'react';
import { TransportService } from '../../services/api';

const CompanyProfilePage: React.FC = () => {
    const [profile, setProfile] = useState({
        razonSocial: '',
        nit: '',
        direccion: '',
        telefono: '',
        email: '',
        sitioWeb: ''
    });

    const [isEditing, setIsEditing] = useState(false);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        const loadProfile = async () => {
            try {
                const data = await TransportService.getCompanyProfile();
                setProfile(data);
            } catch (error) {
                console.error('Error loading profile:', error);
            } finally {
                setLoading(false);
            }
        };
        loadProfile();
    }, []);

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        try {
            await TransportService.updateCompanyProfile(profile);
            setIsEditing(false);
            alert('Perfil de empresa actualizado correctamente');
        } catch (error) {
            console.error('Error updating profile:', error);
            alert('Error al actualizar el perfil');
        }
    };

    if (loading) {
        return <div className="container mx-auto px-4 py-12">Cargando...</div>;
    }

    return (
        <div>
            <div className="mb-8">
                <h1 className="text-2xl font-bold text-gray-900">Perfil de Empresa</h1>
                <p className="text-gray-500">Administra la información de tu empresa.</p>
            </div>

            <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-8">
                <form onSubmit={handleSubmit} className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Razón Social</label>
                            <input
                                type="text"
                                disabled={!isEditing}
                                className="w-full p-3 border border-gray-300 rounded-lg disabled:bg-gray-50 disabled:text-gray-600"
                                value={profile.razonSocial}
                                onChange={e => setProfile({ ...profile, razonSocial: e.target.value })}
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">NIT</label>
                            <input
                                type="text"
                                disabled={!isEditing}
                                className="w-full p-3 border border-gray-300 rounded-lg disabled:bg-gray-50 disabled:text-gray-600"
                                value={profile.nit}
                                onChange={e => setProfile({ ...profile, nit: e.target.value })}
                            />
                        </div>
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Dirección</label>
                        <input
                            type="text"
                            disabled={!isEditing}
                            className="w-full p-3 border border-gray-300 rounded-lg disabled:bg-gray-50 disabled:text-gray-600"
                            value={profile.direccion}
                            onChange={e => setProfile({ ...profile, direccion: e.target.value })}
                        />
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
                            <input
                                type="tel"
                                disabled={!isEditing}
                                className="w-full p-3 border border-gray-300 rounded-lg disabled:bg-gray-50 disabled:text-gray-600"
                                value={profile.telefono}
                                onChange={e => setProfile({ ...profile, telefono: e.target.value })}
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input
                                type="email"
                                disabled={!isEditing}
                                className="w-full p-3 border border-gray-300 rounded-lg disabled:bg-gray-50 disabled:text-gray-600"
                                value={profile.email}
                                onChange={e => setProfile({ ...profile, email: e.target.value })}
                            />
                        </div>
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Sitio Web</label>
                        <input
                            type="text"
                            disabled={!isEditing}
                            className="w-full p-3 border border-gray-300 rounded-lg disabled:bg-gray-50 disabled:text-gray-600"
                            value={profile.sitioWeb}
                            onChange={e => setProfile({ ...profile, sitioWeb: e.target.value })}
                        />
                    </div>

                    <div className="flex justify-end gap-3 pt-4">
                        {!isEditing ? (
                            <button
                                type="button"
                                onClick={() => setIsEditing(true)}
                                className="btn-primary"
                            >
                                Editar Perfil
                            </button>
                        ) : (
                            <>
                                <button
                                    type="button"
                                    onClick={() => setIsEditing(false)}
                                    className="btn-secondary"
                                >
                                    Cancelar
                                </button>
                                <button
                                    type="submit"
                                    className="btn-primary"
                                >
                                    Guardar Cambios
                                </button>
                            </>
                        )}
                    </div>
                </form>
            </div>
        </div>
    );
};

export default CompanyProfilePage;

────────────────────────────────────────────────────────────
FILE: src\pages\operator\DashboardPage.tsx
────────────────────────────────────────────────────────────

import React from 'react';

const DashboardPage: React.FC = () => {
    return (
        <div>
            <h2 className="text-2xl font-bold text-gray-900 mb-6">Dashboard del Operador</h2>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-sm text-gray-500 mb-1">Viajes Hoy</p>
                            <p className="text-3xl font-bold text-gray-900">8</p>
                        </div>
                        <div className="bg-primary-100 p-3 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-8 h-8 text-primary-600">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 00-3.213-9.193 2.056 2.056 0 00-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 00-10.026 0 1.106 1.106 0 00-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12" />
                            </svg>
                        </div>
                    </div>
                </div>

                <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-sm text-gray-500 mb-1">Pasajeros</p>
                            <p className="text-3xl font-bold text-gray-900">124</p>
                        </div>
                        <div className="bg-green-100 p-3 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-8 h-8 text-green-600">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-sm text-gray-500 mb-1">Ingresos Hoy</p>
                            <p className="text-3xl font-bold text-gray-900">8,450 Bs</p>
                        </div>
                        <div className="bg-accent-100 p-3 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-8 h-8 text-accent-600">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <div className="bg-white rounded-xl shadow-sm p-6 mb-6">
                <h3 className="text-lg font-bold text-gray-900 mb-4">Próximos Viajes</h3>
                <div className="overflow-x-auto">
                    <table className="w-full text-left">
                        <thead className="bg-gray-50 border-b">
                            <tr>
                                <th className="p-3 text-xs font-medium text-gray-500 uppercase">Ruta</th>
                                <th className="p-3 text-xs font-medium text-gray-500 uppercase">Hora</th>
                                <th className="p-3 text-xs font-medium text-gray-500 uppercase">Vehículo</th>
                                <th className="p-3 text-xs font-medium text-gray-500 uppercase">Ocupación</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-100">
                            <tr className="hover:bg-gray-50">
                                <td className="p-3 font-medium text-gray-900">La Paz - Cochabamba</td>
                                <td className="p-3 text-gray-600">08:00</td>
                                <td className="p-3 text-gray-600">Volvo 9700</td>
                                <td className="p-3"><span className="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium">28/40</span></td>
                            </tr>
                            <tr className="hover:bg-gray-50">
                                <td className="p-3 font-medium text-gray-900">Cochabamba - Santa Cruz</td>
                                <td className="p-3 text-gray-600">20:00</td>
                                <td className="p-3 text-gray-600">Scania Touring</td>
                                <td className="p-3"><span className="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs font-medium">18/30</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    );
};

export default DashboardPage;

────────────────────────────────────────────────────────────
FILE: src\pages\operator\DriversPage.tsx
────────────────────────────────────────────────────────────

import React, { useState, useEffect } from 'react';
import { TransportService } from '../../services/api';

const DriversPage: React.FC = () => {
    const [drivers, setDrivers] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);
    const [showModal, setShowModal] = useState(false);
    const [newDriver, setNewDriver] = useState({
        nombre: '',
        ci: '',
        licencia: '',
        telefono: ''
    });

    useEffect(() => {
        loadDrivers();
    }, []);

    const loadDrivers = async () => {
        setLoading(true);
        try {
            const data = await TransportService.getDrivers();
            setDrivers(data);
        } catch (error) {
            console.error('Error loading drivers:', error);
        } finally {
            setLoading(false);
        }
    };

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        try {
            await TransportService.createDriver(newDriver);
            setShowModal(false);
            setNewDriver({ nombre: '', ci: '', licencia: '', telefono: '' });
            loadDrivers();
        } catch (error) {
            console.error('Error creating driver:', error);
        }
    };

    const handleDelete = async (id: string) => {
        if (window.confirm('¿Estás seguro de eliminar este conductor?')) {
            try {
                await TransportService.deleteDriver(id);
                loadDrivers();
            } catch (error) {
                console.error('Error deleting driver:', error);
            }
        }
    };

    if (loading) {
        return <div className="container mx-auto px-4 py-12">Cargando...</div>;
    }

    return (
        <div>
            <div className="flex justify-between items-center mb-8">
                <div>
                    <h1 className="text-2xl font-bold text-gray-900">Gestión de Conductores</h1>
                    <p className="text-gray-500">Administra los conductores de tu empresa.</p>
                </div>
                <button onClick={() => setShowModal(true)} className="btn-primary flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    Nuevo Conductor
                </button>
            </div>

            <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <table className="w-full text-left">
                    <thead className="bg-gray-50 border-b border-gray-100">
                        <tr>
                            <th className="p-4 text-xs font-medium text-gray-500 uppercase">Nombre Completo</th>
                            <th className="p-4 text-xs font-medium text-gray-500 uppercase">CI</th>
                            <th className="p-4 text-xs font-medium text-gray-500 uppercase">Licencia</th>
                            <th className="p-4 text-xs font-medium text-gray-500 uppercase">Teléfono</th>
                            <th className="p-4 text-xs font-medium text-gray-500 uppercase">Acciones</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {drivers.map((driver) => (
                            <tr key={driver.id} className="hover:bg-gray-50 transition-colors">
                                <td className="p-4 font-medium text-gray-900">{driver.nombre}</td>
                                <td className="p-4 text-gray-600">{driver.ci}</td>
                                <td className="p-4 text-gray-600">{driver.licencia}</td>
                                <td className="p-4 text-gray-600">{driver.telefono}</td>
                                <td className="p-4">
                                    <button onClick={() => handleDelete(driver.id)} className="text-red-600 hover:text-red-700 font-medium text-sm">Eliminar</button>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
                {drivers.length === 0 && (
                    <div className="p-8 text-center text-gray-500">No hay conductores registrados.</div>
                )}
            </div>

            {showModal && (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
                        <h2 className="text-xl font-bold mb-4">Nuevo Conductor</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Nombre Completo</label>
                                <input type="text" className="w-full p-2 border border-gray-300 rounded-lg" value={newDriver.nombre} onChange={e => setNewDriver({ ...newDriver, nombre: e.target.value })} required />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">CI</label>
                                    <input type="text" className="w-full p-2 border border-gray-300 rounded-lg" value={newDriver.ci} onChange={e => setNewDriver({ ...newDriver, ci: e.target.value })} required />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Licencia</label>
                                    <input type="text" className="w-full p-2 border border-gray-300 rounded-lg" value={newDriver.licencia} onChange={e => setNewDriver({ ...newDriver, licencia: e.target.value })} required />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
                                <input type="tel" className="w-full p-2 border border-gray-300 rounded-lg" value={newDriver.telefono} onChange={e => setNewDriver({ ...newDriver, telefono: e.target.value })} required />
                            </div>
                            <div className="flex justify-end gap-3 mt-6">
                                <button type="button" onClick={() => setShowModal(false)} className="btn-secondary">Cancelar</button>
                                <button type="submit" className="btn-primary">Guardar Conductor</button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </div>
    );
};

export default DriversPage;

────────────────────────────────────────────────────────────
FILE: src\pages\operator\FleetPage.tsx
────────────────────────────────────────────────────────────

import React, { useState, useEffect } from 'react';
import { TransportService } from '../../services/api';

const FleetPage: React.FC = () => {
    const [vehicles, setVehicles] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);
    const [showModal, setShowModal] = useState(false);
    const [newVehicle, setNewVehicle] = useState({
        placa: '',
        modelo: '',
        tipo: '',
        capacidad: ''
    });

    useEffect(() => {
        loadVehicles();
    }, []);

    const loadVehicles = async () => {
        setLoading(true);
        try {
            const data = await TransportService.getVehicles();
            setVehicles(data as any[]);
        } catch (error) {
            console.error("Error loading vehicles", error);
        } finally {
            setLoading(false);
        }
    };

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        try {
            await TransportService.createVehicle({ ...newVehicle, capacidad: Number(newVehicle.capacidad) });
            setShowModal(false);
            setNewVehicle({ placa: '', modelo: '', tipo: '', capacidad: '' });
            loadVehicles();
        } catch (error) {
            console.error("Error creating vehicle", error);
        }
    };

    const handleDelete = async (id: string) => {
        if (window.confirm('¿Estás seguro de eliminar este vehículo?')) {
            try {
                await TransportService.deleteVehicle(id);
                loadVehicles();
            } catch (error) {
                console.error("Error deleting vehicle", error);
            }
        }
    };

    return (
        <div>
            <div className="flex justify-between items-center mb-8">
                <div>
                    <h1 className="text-2xl font-bold text-gray-900">Gestión de Flota</h1>
                    <p className="text-gray-500">Administra los vehículos de tu empresa.</p>
                </div>
                <button onClick={() => setShowModal(true)} className="btn-primary flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    Nuevo Vehículo
                </button>
            </div>

            {loading ? (
                <div className="text-center py-12">Cargando...</div>
            ) : (
                <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <table className="w-full text-left">
                        <thead className="bg-gray-50 border-b border-gray-100">
                            <tr>
                                <th className="p-4 text-xs font-medium text-gray-500 uppercase">Placa</th>
                                <th className="p-4 text-xs font-medium text-gray-500 uppercase">Modelo</th>
                                <th className="p-4 text-xs font-medium text-gray-500 uppercase">Tipo</th>
                                <th className="p-4 text-xs font-medium text-gray-500 uppercase">Capacidad</th>
                                <th className="p-4 text-xs font-medium text-gray-500 uppercase">Acciones</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-100">
                            {vehicles.map((vehicle) => (
                                <tr key={vehicle.id} className="hover:bg-gray-50 transition-colors">
                                    <td className="p-4 font-bold text-gray-900">{vehicle.placa}</td>
                                    <td className="p-4 text-gray-600">{vehicle.modelo}</td>
                                    <td className="p-4"><span className="px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs font-medium">{vehicle.tipo}</span></td>
                                    <td className="p-4 text-gray-600">{vehicle.capacidad} asientos</td>
                                    <td className="p-4">
                                        <button onClick={() => handleDelete(vehicle.id)} className="text-red-600 hover:text-red-700 font-medium text-sm">Eliminar</button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                    {vehicles.length === 0 && (
                        <div className="p-8 text-center text-gray-500">No hay vehículos registrados.</div>
                    )}
                </div>
            )}

            {showModal && (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
                        <h2 className="text-xl font-bold mb-4">Nuevo Vehículo</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Placa</label>
                                <input type="text" className="w-full p-2 border border-gray-300 rounded-lg" value={newVehicle.placa} onChange={e => setNewVehicle({ ...newVehicle, placa: e.target.value })} required />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Modelo</label>
                                <input type="text" className="w-full p-2 border border-gray-300 rounded-lg" value={newVehicle.modelo} onChange={e => setNewVehicle({ ...newVehicle, modelo: e.target.value })} required />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Tipo</label>
                                <select className="w-full p-2 border border-gray-300 rounded-lg" value={newVehicle.tipo} onChange={e => setNewVehicle({ ...newVehicle, tipo: e.target.value })} required>
                                    <option value="">Seleccionar</option>
                                    <option value="Bus Cama">Bus Cama</option>
                                    <option value="Bus Leito">Bus Leito</option>
                                    <option value="Bus Semi-Cama">Bus Semi-Cama</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Capacidad (asientos)</label>
                                <input type="number" className="w-full p-2 border border-gray-300 rounded-lg" value={newVehicle.capacidad} onChange={e => setNewVehicle({ ...newVehicle, capacidad: e.target.value })} required />
                            </div>
                            <div className="flex justify-end gap-3 mt-6">
                                <button type="button" onClick={() => setShowModal(false)} className="btn-secondary">Cancelar</button>
                                <button type="submit" className="btn-primary">Guardar Vehículo</button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </div>
    );
};

export default FleetPage;

────────────────────────────────────────────────────────────
FILE: src\pages\operator\MaintenancePage.tsx
────────────────────────────────────────────────────────────

import React, { useState } from 'react';

const MaintenancePage: React.FC = () => {
    const [logs, setLogs] = useState<any[]>([]);
    const [showModal, setShowModal] = useState(false);
    const [newLog, setNewLog] = useState({
        vehiculoId: '',
        tipo: '',
        descripcion: '',
        costo: '',
        fecha: ''
    });

    const handleSubmit = (e: React.FormEvent) => {
        e.preventDefault();
        const log = { ...newLog, id: Math.random().toString(36).substr(2, 9), costo: Number(newLog.costo) };
        setLogs([...logs, log]);
        setShowModal(false);
        setNewLog({ vehiculoId: '', tipo: '', descripcion: '', costo: '', fecha: '' });
    };

    const handleDelete = (id: string) => {
        if (window.confirm('¿Estás seguro de eliminar este registro?')) {
            setLogs(logs.filter(l => l.id !== id));
        }
    };

    return (
        <div>
            <div className="flex justify-between items-center mb-8">
                <div>
                    <h1 className="text-2xl font-bold text-gray-900">Registro de Mantenimiento</h1>
                    <p className="text-gray-500">Lleva un registro del mantenimiento de tu flota.</p>
                </div>
                <button onClick={() => setShowModal(true)} className="btn-primary flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    Nuevo Registro
                </button>
            </div>

            <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <table className="w-full text-left">
                    <thead className="bg-gray-50 border-b border-gray-100">
                        <tr>
                            <th className="p-4 text-xs font-medium text-gray-500 uppercase">Fecha</th>
                            <th className="p-4 text-xs font-medium text-gray-500 uppercase">Vehículo</th>
                            <th className="p-4 text-xs font-medium text-gray-500 uppercase">Tipo</th>
                            <th className="p-4 text-xs font-medium text-gray-500 uppercase">Descripción</th>
                            <th className="p-4 text-xs font-medium text-gray-500 uppercase">Costo</th>
                            <th className="p-4 text-xs font-medium text-gray-500 uppercase">Acciones</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-100">
                        {logs.map((log) => (
                            <tr key={log.id} className="hover:bg-gray-50 transition-colors">
                                <td className="p-4 text-gray-600">{log.fecha}</td>
                                <td className="p-4 font-medium text-gray-900">{log.vehiculoId}</td>
                                <td className="p-4"><span className="px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs font-medium">{log.tipo}</span></td>
                                <td className="p-4 text-gray-600">{log.descripcion}</td>
                                <td className="p-4 font-bold text-accent-600">{log.costo} Bs</td>
                                <td className="p-4">
                                    <button onClick={() => handleDelete(log.id)} className="text-red-600 hover:text-red-700 font-medium text-sm">Eliminar</button>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
                {logs.length === 0 && (
                    <div className="p-8 text-center text-gray-500">No hay registros de mantenimiento.</div>
                )}
            </div>

            {showModal && (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
                        <h2 className="text-xl font-bold mb-4">Nuevo Registro de Mantenimiento</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Vehículo (Placa)</label>
                                <input type="text" className="w-full p-2 border border-gray-300 rounded-lg" value={newLog.vehiculoId} onChange={e => setNewLog({ ...newLog, vehiculoId: e.target.value })} required />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Tipo de Mantenimiento</label>
                                <select className="w-full p-2 border border-gray-300 rounded-lg" value={newLog.tipo} onChange={e => setNewLog({ ...newLog, tipo: e.target.value })} required>
                                    <option value="">Seleccionar</option>
                                    <option value="Preventivo">Preventivo</option>
                                    <option value="Correctivo">Correctivo</option>
                                    <option value="Neumáticos">Neumáticos</option>
                                    <option value="Revisión Técnica">Revisión Técnica</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Descripción</label>
                                <textarea className="w-full p-2 border border-gray-300 rounded-lg" rows={3} value={newLog.descripcion} onChange={e => setNewLog({ ...newLog, descripcion: e.target.value })} required />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Fecha</label>
                                    <input type="date" className="w-full p-2 border border-gray-300 rounded-lg" value={newLog.fecha} onChange={e => setNewLog({ ...newLog, fecha: e.target.value })} required />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Costo (Bs)</label>
                                    <input type="number" className="w-full p-2 border border-gray-300 rounded-lg" value={newLog.costo} onChange={e => setNewLog({ ...newLog, costo: e.target.value })} required />
                                </div>
                            </div>
                            <div className="flex justify-end gap-3 mt-6">
                                <button type="button" onClick={() => setShowModal(false)} className="btn-secondary">Cancelar</button>
                                <button type="submit" className="btn-primary">Guardar Registro</button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </div>
    );
};

export default MaintenancePage;

────────────────────────────────────────────────────────────
FILE: src\pages\operator\RoutesPage.tsx
────────────────────────────────────────────────────────────

import React, { useState, useEffect } from 'react';
import { TransportService, BOLIVIAN_CITIES } from '../../services/api';

const RoutesPage: React.FC = () => {
    const [routes, setRoutes] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);
    const [showModal, setShowModal] = useState(false);
    const [newRoute, setNewRoute] = useState({
        nombre: '',
        origen: '',
        destino: '',
        precio: '',
        duracion: ''
    });

    useEffect(() => {
        loadRoutes();
    }, []);

    const loadRoutes = async () => {
        setLoading(true);
        try {
            const data = await TransportService.getRoutes();
            setRoutes(data as any[]);
        } catch (error) {
            console.error("Error loading routes", error);
        } finally {
            setLoading(false);
        }
    };

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        try {
            await TransportService.createRoute({ ...newRoute, precio: Number(newRoute.precio) });
            setShowModal(false);
            setNewRoute({ nombre: '', origen: '', destino: '', precio: '', duracion: '' });
            loadRoutes();
        } catch (error) {
            console.error("Error creating route", error);
        }
    };

    const handleDelete = async (id: string) => {
        if (window.confirm('¿Estás seguro de eliminar esta ruta?')) {
            try {
                await TransportService.deleteRoute(id);
                loadRoutes();
            } catch (error) {
                console.error("Error deleting route", error);
            }
        }
    };

    return (
        <div>
            <div className="flex justify-between items-center mb-8">
                <div>
                    <h1 className="text-2xl font-bold text-gray-900">Gestión de Rutas</h1>
                    <p className="text-gray-500">Administra las rutas de transporte de tu empresa.</p>
                </div>
                <button
                    onClick={() => setShowModal(true)}
                    className="btn-primary flex items-center gap-2"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    Nueva Ruta
                </button>
            </div>

            {loading ? (
                <div className="text-center py-12">Cargando...</div>
            ) : (
                <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <table className="w-full text-left">
                        <thead className="bg-gray-50 border-b border-gray-100">
                            <tr>
                                <th className="p-4 text-xs font-medium text-gray-500 uppercase">Nombre</th>
                                <th className="p-4 text-xs font-medium text-gray-500 uppercase">Origen</th>
                                <th className="p-4 text-xs font-medium text-gray-500 uppercase">Destino</th>
                                <th className="p-4 text-xs font-medium text-gray-500 uppercase">Duración</th>
                                <th className="p-4 text-xs font-medium text-gray-500 uppercase">Precio</th>
                                <th className="p-4 text-xs font-medium text-gray-500 uppercase">Acciones</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-100">
                            {routes.map((route) => (
                                <tr key={route.id} className="hover:bg-gray-50 transition-colors">
                                    <td className="p-4 font-medium text-gray-900">{route.nombre}</td>
                                    <td className="p-4 text-gray-600">{route.origen}</td>
                                    <td className="p-4 text-gray-600">{route.destino}</td>
                                    <td className="p-4 text-gray-600">{route.duracion}</td>
                                    <td className="p-4 font-bold text-accent-600">{route.precio} Bs</td>
                                    <td className="p-4">
                                        <button
                                            onClick={() => handleDelete(route.id)}
                                            className="text-red-600 hover:text-red-700 font-medium text-sm"
                                        >
                                            Eliminar
                                        </button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                    {routes.length === 0 && (
                        <div className="p-8 text-center text-gray-500">No hay rutas registradas.</div>
                    )}
                </div>
            )}

            {showModal && (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
                        <h2 className="text-xl font-bold mb-4">Nueva Ruta</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Nombre de Ruta</label>
                                <input type="text" className="w-full p-2 border border-gray-300 rounded-lg" value={newRoute.nombre} onChange={e => setNewRoute({ ...newRoute, nombre: e.target.value })} placeholder="La Paz - Santa Cruz" required />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Origen</label>
                                    <select className="w-full p-2 border border-gray-300 rounded-lg" value={newRoute.origen} onChange={e => setNewRoute({ ...newRoute, origen: e.target.value })} required>
                                        <option value="">Seleccionar</option>
                                        {BOLIVIAN_CITIES.map(city => (
                                            <option key={city} value={city}>{city}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Destino</label>
                                    <select className="w-full p-2 border border-gray-300 rounded-lg" value={newRoute.destino} onChange={e => setNewRoute({ ...newRoute, destino: e.target.value })} required>
                                        <option value="">Seleccionar</option>
                                        {BOLIVIAN_CITIES.map(city => (
                                            <option key={city} value={city}>{city}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Duración</label>
                                    <input type="text" placeholder="ej. 8h" className="w-full p-2 border border-gray-300 rounded-lg" value={newRoute.duracion} onChange={e => setNewRoute({ ...newRoute, duracion: e.target.value })} required />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Precio (Bs)</label>
                                    <input type="number" className="w-full p-2 border border-gray-300 rounded-lg" value={newRoute.precio} onChange={e => setNewRoute({ ...newRoute, precio: e.target.value })} required />
                                </div>
                            </div>
                            <div className="flex justify-end gap-3 mt-6">
                                <button type="button" onClick={() => setShowModal(false)} className="btn-secondary">Cancelar</button>
                                <button type="submit" className="btn-primary">Guardar Ruta</button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </div>
    );
};

export default RoutesPage;

────────────────────────────────────────────────────────────
FILE: src\pages\operator\SchedulesPage.tsx
────────────────────────────────────────────────────────────

import React, { useState, useEffect } from 'react';
import { TransportService } from '../../services/api';

const SchedulesPage: React.FC = () => {
    const [schedules, setSchedules] = useState<any[]>([]);
    const [routes, setRoutes] = useState<any[]>([]);
    const [vehicles, setVehicles] = useState<any[]>([]);
    const [loading, setLoading] = useState(true);
    const [showModal, setShowModal] = useState(false);
    const [newSchedule, setNewSchedule] = useState({
        routeId: '',
        vehiculoId: '',
        salida: '',
        llegada: '',
        precio: ''
    });

    useEffect(() => {
        loadData();
    }, []);

    const loadData = async () => {
        setLoading(true);
        try {
            // AHORA SI EXISTE getSchedules en api.ts
            const [schedulesData, routesData, vehiclesData] = await Promise.all([
                TransportService.getSchedules(),
                TransportService.getRoutes(),
                TransportService.getVehicles()
            ]);
            setSchedules(Array.isArray(schedulesData) ? schedulesData : []);
            setRoutes(Array.isArray(routesData) ? routesData : []);
            setVehicles(Array.isArray(vehiclesData) ? vehiclesData : []);
        } catch (error) {
            console.error("Error loading data", error);
            setSchedules([]); // Fallback vacío para evitar crashes
        } finally {
            setLoading(false);
        }
    };

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        try {
            const selectedVehicle = vehicles.find(v => v.id === newSchedule.vehiculoId);
            const scheduleToSave = {
                routeId: newSchedule.routeId,
                vehiculoId: newSchedule.vehiculoId,
                horaSalida: newSchedule.salida,
                // El backend espera tarifaGeneral, mapeamos precio a eso
                tarifaGeneral: Number(newSchedule.precio),
                dias: ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'] // Default por ahora
            };

            await TransportService.createSchedule(scheduleToSave);
            setShowModal(false);
            setNewSchedule({ routeId: '', vehiculoId: '', salida: '', llegada: '', precio: '' });
            loadData();
        } catch (error) {
            console.error("Error creating schedule", error);
            alert("Error al crear horario. Revisa los datos.");
        }
    };

    const handleDelete = async (id: string) => {
        if (window.confirm('¿Estás seguro de eliminar este horario?')) {
            try {
                await TransportService.deleteSchedule(id);
                loadData();
            } catch (error) {
                console.error("Error deleting schedule", error);
            }
        }
    };

    // Helper seguro para obtener nombre
    const getRouteName = (id: string) => {
        const route = routes.find(r => r.id === id);
        return route ? route.nombre : 'Ruta Desconocida';
    };

    return (
        <div>
            <div className="flex justify-between items-center mb-8">
                <div>
                    <h1 className="text-2xl font-bold text-gray-900">Gestión de Horarios</h1>
                    <p className="text-gray-500">Programación de salidas y asignación de vehículos.</p>
                </div>
                <button
                    onClick={() => setShowModal(true)}
                    className="btn-primary flex items-center gap-2"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    Nuevo Horario
                </button>
            </div>

            {loading ? (
                <div className="text-center py-12">Cargando...</div>
            ) : (
                <div className="card">
                    <table className="w-full text-left">
                        <thead className="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th className="p-4 text-xs font-bold text-gray-500 uppercase">Ruta</th>
                                <th className="p-4 text-xs font-bold text-gray-500 uppercase">Salida</th>
                                <th className="p-4 text-xs font-bold text-gray-500 uppercase">Tarifa</th>
                                <th className="p-4 text-xs font-bold text-gray-500 uppercase">Acciones</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-100">
                            {schedules.map((schedule) => (
                                <tr key={schedule.id} className="hover:bg-gray-50 transition-colors">
                                    <td className="p-4 font-medium text-gray-900">{getRouteName(schedule.routeId)}</td>
                                    <td className="p-4 text-gray-900 font-bold">{schedule.horaSalida}</td>
                                    <td className="p-4 text-gray-600">{schedule.tarifaGeneral} Bs</td>
                                    <td className="p-4">
                                        <button
                                            onClick={() => handleDelete(schedule.id)}
                                            className="text-red-600 hover:text-red-700 font-medium text-sm bg-red-50 px-3 py-1 rounded hover:bg-red-100"
                                        >
                                            Eliminar
                                        </button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                    {schedules.length === 0 && (
                        <div className="p-8 text-center text-gray-500">No hay horarios registrados.</div>
                    )}
                </div>
            )}

            {showModal && (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
                        <h2 className="text-xl font-bold mb-4 text-gray-900">Nuevo Horario</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">Ruta</label>
                                <select
                                    className="input-field"
                                    value={newSchedule.routeId}
                                    onChange={e => setNewSchedule({ ...newSchedule, routeId: e.target.value })}
                                    required
                                >
                                    <option value="">Seleccionar Ruta</option>
                                    {routes.map(r => (
                                        <option key={r.id} value={r.id}>{r.nombre}</option>
                                    ))}
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">Vehículo</label>
                                <select
                                    className="input-field"
                                    value={newSchedule.vehiculoId}
                                    onChange={e => setNewSchedule({ ...newSchedule, vehiculoId: e.target.value })}
                                    required
                                >
                                    <option value="">Seleccionar Vehículo</option>
                                    {vehicles.map(v => (
                                        <option key={v.id} value={v.id}>{v.modelo} ({v.patente})</option>
                                    ))}
                                </select>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-1">Hora Salida</label>
                                    <input
                                        type="time"
                                        className="input-field"
                                        value={newSchedule.salida}
                                        onChange={e => setNewSchedule({ ...newSchedule, salida: e.target.value })}
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-1">Precio (Bs)</label>
                                    <input
                                        type="number"
                                        className="input-field"
                                        value={newSchedule.precio}
                                        onChange={e => setNewSchedule({ ...newSchedule, precio: e.target.value })}
                                        required
                                    />
                                </div>
                            </div>
                            <div className="flex justify-end gap-3 mt-6">
                                <button
                                    type="button"
                                    onClick={() => setShowModal(false)}
                                    className="btn-secondary"
                                >
                                    Cancelar
                                </button>
                                <button
                                    type="submit"
                                    className="btn-primary"
                                >
                                    Guardar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            )}
        </div>
    );
};

export default SchedulesPage;


============================================================
DIR: src\services
============================================================


────────────────────────────────────────────────────────────
FILE: src\services\api.ts
────────────────────────────────────────────────────────────

import axios from 'axios';

// Cambia a false para conectar con tu backend NestJS real
const USE_MOCK = false;
const API_URL = '/api'; // Proxy configurado en Nginx

export const api = axios.create({
    baseURL: API_URL,
});

// Añadimos token automáticamente si existe
api.interceptors.request.use((config) => {
    const token = localStorage.getItem('transpobolivia_token');
    if (token) {
        config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
});

export const BOLIVIAN_CITIES = [
    { id: 'LPB', name: 'La Paz' },
    { id: 'CBB', name: 'Cochabamba' },
    { id: 'SRZ', name: 'Santa Cruz' },
    { id: 'ORU', name: 'Oruro' },
    { id: 'PSI', name: 'Potosí' },
    { id: 'SRE', name: 'Sucre' },
    { id: 'TJA', name: 'Tarija' },
    { id: 'BEN', name: 'Trinidad' },
    { id: 'PAN', name: 'Cobija' }
];

export const TransportService = {
    // --- CLIENTE: BÚSQUEDA ---

    // Buscar viajes (permite parámetros vacíos)
    searchTrips: async (origen?: string, destino?: string, fecha?: string) => {
        let url = '/search/trips?';
        if (origen) url += `origen=${origen}&`;
        if (destino) url += `destino=${destino}&`;
        if (fecha) url += `fecha=${fecha}&`;

        const response = await api.get(url);
        return response.data;
    },

    // --- OPERADOR ---

    // Perfil de empresa
    getCompanyProfile: async () => {
        const response = await api.get('/empresa/me');
        return response.data;
    },
    updateCompanyProfile: async (data: any) => {
        const response = await api.put('/empresa', data);
        return response.data;
    },

    // Rutas
    getRoutes: async () => {
        const response = await api.get('/rutas');
        return response.data;
    },
    createRoute: async (data: any) => {
        const response = await api.post('/rutas', data);
        return response.data;
    },
    deleteRoute: async (id: string) => {
        await api.delete(`/rutas/${id}`);
    },

    // Vehículos
    getVehicles: async () => {
        const response = await api.get('/vehiculos');
        return response.data;
    },
    createVehicle: async (data: any) => {
        const response = await api.post('/vehiculos', data);
        return response.data;
    },
    deleteVehicle: async (id: string) => {
        await api.delete(`/vehiculos/${id}`);
    },

    // Horarios (AQUÍ ESTABA EL ERROR, FALTABAN MÉTODOS)
    getSchedules: async () => {
        const response = await api.get('/horarios');
        return response.data;
    },
    getSchedulesByRoute: async (rutaId: string) => {
        const response = await api.get(`/horarios?rutaId=${rutaId}`);
        return response.data;
    },
    createSchedule: async (data: any) => {
        const response = await api.post('/horarios', data);
        return response.data;
    },
    updateSchedule: async (id: string, data: any) => {
        const response = await api.patch(`/horarios/${id}`, data);
        return response.data;
    },
    deleteSchedule: async (id: string) => {
        await api.delete(`/horarios/${id}`);
    },

    // Conductores
    getDrivers: async () => {
        const response = await api.get('/conductores');
        return response.data;
    },
    createDriver: async (data: any) => {
        const response = await api.post('/conductores', data);
        return response.data;
    },
    deleteDriver: async (id: string) => {
        await api.delete(`/conductores/${id}`);
    },

    // Mantenimiento
    getAlertas: async () => {
        const response = await api.get('/mantenimiento/alertas');
        return response.data;
    }
};

────────────────────────────────────────────────────────────
FILE: src\services\authService.ts
────────────────────────────────────────────────────────────

import axios from 'axios';
import { User } from '../types';
import { API_BASE } from '../constants'

const API_URL = API_BASE;
const TOKEN_KEY = 'transpobolivia_token';
const USER_KEY = 'transpobolivia_user';

// Función auxiliar para manejar la sesión
const manageSession = (accessToken: string): { user: User; token: string } => {
  const payload = JSON.parse(atob(accessToken.split('.')[1]));
  const user: User = {
    id: payload.sub,
    email: payload.email,
    empresaId: payload.empresaId,
    nombre: payload.nombre || '',
    role: payload.empresaId ? 'operador' : 'user',
  };

  localStorage.setItem(TOKEN_KEY, accessToken);
  localStorage.setItem(USER_KEY, JSON.stringify(user));

  return { user, token: accessToken };
};

export const authService = {
  register: async (nombre: string, email: string, contrasena: string): Promise<{ user: User; token: string }> => {
    const userData = {
      nombre,
      email: email.toLowerCase(),
      contrasena,
      role: 'user',
    };

    try {
      const response = await axios.post(`${API_URL}/auth/register`, userData);
      const { access_token } = response.data;
      return manageSession(access_token);
    } catch (error) {
      if (axios.isAxiosError(error) && error.response) {
        throw new Error(error.response.data.message || 'Error en el registro de cliente.');
      }
      throw new Error('No se pudo conectar con el servidor.');
    }
  },

  registerOperator: async (nombreEmpresa: string, nit: string, email: string, contrasena: string): Promise<{ user: User; token: string }> => {
    const operatorData = {
      nombre: nombreEmpresa,
      nit,
      email: email.toLowerCase(),
      contrasena,
      role: 'operador',
    };

    try {
      const response = await axios.post(`${API_URL}/auth/register`, operatorData);
      const { access_token } = response.data;
      return manageSession(access_token);
    } catch (error) {
      if (axios.isAxiosError(error) && error.response) {
        throw new Error(error.response.data.message || 'Error en el registro de operador.');
      }
      throw new Error('No se pudo conectar con el servidor.');
    }
  },

  login: async (email: string, contrasena: string): Promise<{ user: User; token: string }> => {
    // MOCK LOGIN FOR DEMO
    if (email === 'demo@transporte.bo' && contrasena === '123456') {
      const mockUser: User = {
        id: 'mock-operator-id',
        email: 'demo@transporte.bo',
        nombre: 'Operador Demo',
        role: 'operador',
        empresaId: 'empresa-1'
      };
      // Mock JWT structure: header.payload.signature
      const mockToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJtb2NrLW9wZXJhdG9yLWlkIiwiZW1haWwiOiJkZW1vQHRyYW5zcG9ydGUuYm8iLCJlbXByZXNhSWQiOiJlbXByZXNhLTEiLCJub21icmUiOiJPcGVyYWRvciBEZW1vIn0.signature';

      localStorage.setItem(TOKEN_KEY, mockToken);
      localStorage.setItem(USER_KEY, JSON.stringify(mockUser));
      return { user: mockUser, token: mockToken };
    }

    try {
      const response = await axios.post(`${API_URL}/auth/login`, {
        email: email.toLowerCase(),
        contrasena,
      });
      const { access_token } = response.data;
      return manageSession(access_token);
    } catch (error) {
      if (axios.isAxiosError(error) && error.response) {
        throw new Error(error.response.data.message || 'Credenciales inválidas.');
      }
      throw new Error('No se pudo conectar con el servidor.');
    }
  },

  logout: () => {
    localStorage.removeItem(TOKEN_KEY);
    localStorage.removeItem(USER_KEY);
  },

  getCurrentSession: (): { user: User; token: string } | null => {
    const token = localStorage.getItem(TOKEN_KEY);
    const userStr = localStorage.getItem(USER_KEY);
    if (token && userStr) {
      try {
        const user = JSON.parse(userStr);
        return { user, token };
      } catch (e) { return null; }
    }
    return null;
  },
};

────────────────────────────────────────────────────────────
FILE: src\services\geminiService.ts
────────────────────────────────────────────────────────────


import { GoogleGenAI } from "@google/genai";

// Asumimos que la API Key está configurada en las variables de entorno del entorno de ejecución.
// ¡No la codifiques directamente en el código!
const apiKey = process.env.API_KEY;
if (!apiKey) {
  console.warn("API Key de Google GenAI no encontrada. Las funciones de IA estarán deshabilitadas.");
}

const ai = new GoogleGenAI({ apiKey: apiKey || "" });

/**
 * Obtiene una sugerencia de viaje o responde una pregunta usando Gemini.
 * @param pregunta La pregunta o solicitud del usuario.
 * @returns Una cadena con la respuesta generada por el modelo.
 */
export const obtenerSugerenciaDeViaje = async (pregunta: string): Promise<string> => {
  if (!apiKey) {
    return "La función de asistente de IA no está disponible. Falta la clave de API.";
  }
  
  try {
    const response = await ai.models.generateContent({
      model: 'gemini-2.5-flash',
      contents: `Eres un asistente de viajes experto en Bolivia. Responde de forma amigable y útil. El usuario pregunta: "${pregunta}"`,
      config: {
        temperature: 0.7,
        topP: 1,
        topK: 32,
        thinkingConfig: { thinkingBudget: 0 } // Deshabilitar para baja latencia
      },
    });

    return response.text;
  } catch (error) {
    console.error("Error al llamar a la API de Gemini:", error);
    return "Lo siento, no pude procesar tu solicitud en este momento. Por favor, inténtalo de nuevo más tarde.";
  }
};

────────────────────────────────────────────────────────────
FILE: src\services\operadorService.ts
────────────────────────────────────────────────────────────

// services/operadorService.ts
import { Empresa, Vehiculo, Conductor, Ruta, Horario } from '../types';
import { API_BASE } from '../constants';

const base = API_BASE;

const authHeaders = () => {
  const token = localStorage.getItem('transpobolivia_token');
  return token ? { Authorization: `Bearer ${token}` } : {};
};

const json = async (r: Response) => {
  const text = await r.text();
  if (!r.ok) {
    try {
      const obj = text ? JSON.parse(text) : {};
      throw new Error(typeof obj === 'string' ? obj : JSON.stringify(obj));
    } catch {
      throw new Error(text || 'Error en la solicitud');
    }
  }
  return text ? JSON.parse(text) : null;
};

// Ayudante para firmas con objeto que incluye id
const isObjectWithId = (arg: any): arg is { id: string } =>
  typeof arg === 'object' && arg !== null && typeof arg.id === 'string';

// Tipos auxiliares para Horarios
type DiaSemana = Horario['dias'][number];
const DIAS_VALIDOS: readonly DiaSemana[] = [
  'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo',
] as const;

type SaveHorarioDTO = Omit<Horario, 'id' | 'empresaId'>;
type UpdateHorarioDTO = Partial<Omit<Horario, 'empresaId'>>;

const normalizeDias = (dias: string[] | SaveHorarioDTO['dias']): SaveHorarioDTO['dias'] => {
  // Filtra/normaliza por si llega string[]
  return (dias as string[])
    .map(d => (typeof d === 'string' ? d.trim() : d))
    .filter((d): d is DiaSemana => DIAS_VALIDOS.includes(d as DiaSemana));
};

export const operadorService = {
  // Empresa
  async getEmpresa(): Promise<Empresa> {
    return json(
      await fetch(`${base}/empresa/me`, {
        headers: { 'Content-Type': 'application/json', ...authHeaders() },
      }),
    );
  },

  async updateEmpresa(data: Partial<Empresa>): Promise<Empresa> {
    return json(
      await fetch(`${base}/empresa`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', ...authHeaders() },
        body: JSON.stringify(data),
      }),
    );
  },

  async getResumen(): Promise<{ vehiculosActivos: number; conductores: number; rutas: number; alertas: number }> {
    const [summaryRes, alertasRes] = await Promise.all([
      fetch(`${base}/empresa/summary`, { headers: { ...authHeaders() } }),
      fetch(`${base}/mantenimiento/alertas`, { headers: { ...authHeaders() } }),
    ]);
    const summary = await json(summaryRes);
    const alertas = await json(alertasRes);
    return { ...summary, alertas: Array.isArray(alertas) ? alertas.length : 0 };
  },

  // Vehículos
  async getVehiculos(): Promise<Vehiculo[]> {
    return json(await fetch(`${base}/vehiculos`, { headers: { ...authHeaders() } }));
  },

  async addVehiculo(data: Omit<Vehiculo, 'id' | 'empresaId' | 'empresa'>): Promise<Vehiculo> {
    return json(
      await fetch(`${base}/vehiculos`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', ...authHeaders() },
        body: JSON.stringify(data),
      }),
    );
  },

  async updateVehiculo(arg1: any, arg2?: any): Promise<Vehiculo> {
    const id = isObjectWithId(arg1) ? arg1.id : arg1;
    const data = isObjectWithId(arg1) ? { ...arg1 } : arg2 || {};
    delete (data as any).id;
    return json(
      await fetch(`${base}/vehiculos/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', ...authHeaders() },
        body: JSON.stringify(data),
      }),
    );
  },

  async deleteVehiculo(id: string): Promise<void> {
    await json(
      await fetch(`${base}/vehiculos/${id}`, { method: 'DELETE', headers: { ...authHeaders() } }),
    );
  },

  // Conductores
  async getConductores(): Promise<Conductor[]> {
    return json(await fetch(`${base}/conductores`, { headers: { ...authHeaders() } }));
  },

  async addConductor(data: Omit<Conductor, 'id' | 'empresaId' | 'empresa'>): Promise<Conductor> {
    return json(
      await fetch(`${base}/conductores`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', ...authHeaders() },
        body: JSON.stringify(data),
      }),
    );
  },

  async updateConductor(data: Partial<Conductor> & { id: string }): Promise<Conductor> {
    const { id, ...updateData } = data;
    return json(
      await fetch(`${base}/conductores/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', ...authHeaders() },
        body: JSON.stringify(updateData),
      }),
    );
  },

  // Rutas
  async getRutas(): Promise<Ruta[]> {
    return json(await fetch(`${base}/rutas`, { headers: { ...authHeaders() } }));
  },

  async createRuta(data: Omit<Ruta, 'id' | 'empresaId'> & { paradas?: Ruta['paradas'] }): Promise<Ruta> {
    const payload = { ...data, paradas: data.paradas || [] };
    return json(
      await fetch(`${base}/rutas`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', ...authHeaders() },
        body: JSON.stringify(payload),
      }),
    );
  },

  async updateRuta(ruta: Ruta): Promise<Ruta> {
    return json(
      await fetch(`${base}/rutas/${ruta.id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', ...authHeaders() },
        body: JSON.stringify(ruta),
      }),
    );
  },

  async deleteRuta(id: string): Promise<void> {
    await json(await fetch(`${base}/rutas/${id}`, { method: 'DELETE', headers: { ...authHeaders() } }));
  },

  // Horarios
  async getHorariosByRuta(rutaId: string): Promise<Horario[]> {
    return json(
      await fetch(`${base}/horarios?rutaId=${encodeURIComponent(rutaId)}`, {
        headers: { ...authHeaders() },
      }),
    );
  },

  async saveHorario(data: SaveHorarioDTO): Promise<Horario> {
    const payload: SaveHorarioDTO = {
      ...data,
      dias: normalizeDias(data.dias),
      tarifaGeneral: Number((data as any).tarifaGeneral ?? 0),
    };
    return json(
      await fetch(`${base}/horarios`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', ...authHeaders() },
        body: JSON.stringify(payload),
      }),
    );
  },

  async updateHorario(id: string, data: UpdateHorarioDTO): Promise<Horario> {
    const payload: UpdateHorarioDTO = {
      ...data,
      dias: data.dias ? normalizeDias(data.dias as any) : undefined,
      tarifaGeneral: data.tarifaGeneral != null ? Number(data.tarifaGeneral) : undefined,
    };
    return json(
      await fetch(`${base}/horarios/${id}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json', ...authHeaders() },
        body: JSON.stringify(payload),
      }),
    );
  },

  async deleteHorario(id: string): Promise<void> {
    await json(
      await fetch(`${base}/horarios/${id}`, {
        method: 'DELETE',
        headers: { ...authHeaders() },
      }),
    );
  },

  // Mantenimiento
  async getAlertasMantenimiento(): Promise<any[]> {
    return json(await fetch(`${base}/mantenimiento/alertas`, { headers: { ...authHeaders() } }));
  },
};

────────────────────────────────────────────────────────────
FILE: src\services\tripsService.ts
────────────────────────────────────────────────────────────

// services/tripsService.ts
import { API_BASE } from '../constants';

const base = API_BASE;

export const tripsService = {
  // Compatibilidad con el front actual
  async search(origen: string, destino: string, fecha: string) {
    const r = await fetch(`${base}/search/trips?origen=${encodeURIComponent(origen)}&destino=${encodeURIComponent(destino)}&fecha=${encodeURIComponent(fecha)}`);
    if (!r.ok) throw new Error(await r.text());
    return r.json();
  },

  async getSeats(viajeId: string): Promise<{ capacidad: number; seats: { numero: number; estado: 'disponible' | 'ocupado' }[] }> {
    const r = await fetch(`${base}/trips/${encodeURIComponent(viajeId)}/seats`);
    if (!r.ok) throw new Error(await r.text());
    return r.json();
  },

  async reserveSeats(viajeId: string, _count: number, seatNumbers: number[], token: string) {
    const r = await fetch(`${base}/trips/${encodeURIComponent(viajeId)}/reservations`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
      body: JSON.stringify({ seats: seatNumbers }),
    });
    if (r.status === 409) {
      throw new Error('Uno o más asientos ya fueron reservados. Actualiza el mapa e intenta con otros.');
    }
    if (!r.ok) throw new Error(await r.text());
    return r.json();
  },

  // Métodos nuevos (por si los quieres usar luego)
  async buscarViajes(params: { origen: string; destino: string; fecha: string }) {
    return this.search(params.origen, params.destino, params.fecha);
  },
};


============================================================
DIR: transpobolivia
============================================================


────────────────────────────────────────────────────────────
FILE: Dockerfile
────────────────────────────────────────────────────────────

# === ETAPA 1: BUILDER ===
# Usamos Node 24 para construir el frontend.
FROM node:24-alpine AS builder

WORKDIR /app

COPY package*.json ./
RUN npm install
COPY . .

# Compila la aplicación Vite/React, generando archivos estáticos en /dist.
RUN npm run build

# === ETAPA 2: SERVER ===
# Usamos la imagen oficial de Nginx, que es extremadamente pequeña y rápida.
FROM nginx:stable-alpine

# Copia los archivos estáticos compilados desde la etapa de builder
# a la carpeta desde donde Nginx sirve el contenido web.
COPY --from=builder /app/dist /usr/share/nginx/html

# Reemplaza la configuración por defecto de Nginx con la nuestra.
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Expone el puerto 80, el estándar para tráfico web HTTP.
EXPOSE 80

# Comando para iniciar Nginx en primer plano, como Docker recomienda.
CMD ["nginx", "-g", "daemon off;"]

────────────────────────────────────────────────────────────
FILE: README.md
────────────────────────────────────────────────────────────

# TranspoBolivia - Sistema de Gestión de Transporte

## Descripción del Proyecto

TranspoBolivia es un sistema integral de gestión de transporte diseñado para optimizar la administración de rutas, vehículos, conductores, horarios y reservas. La aplicación consta de un frontend interactivo desarrollado con React y un robusto backend construido con NestJS, utilizando PostgreSQL como base de datos.

## Características Principales

*   **Gestión de Usuarios:** Registro y autenticación de usuarios, incluyendo roles de operador y cliente.
*   **Gestión de Rutas:** Creación, edición y eliminación de rutas de transporte.
*   **Gestión de Vehículos:** Administración de la flota de vehículos, incluyendo detalles y estado.
*   **Gestión de Conductores:** Registro y seguimiento de la información de los conductores.
*   **Gestión de Horarios:** Definición y asignación de horarios para las rutas y vehículos.
*   **Gestión de Reservas:** Sistema de reservas de pasajes para los clientes.
*   **Asistente de IA:** Integración con Gemini para asistencia inteligente (frontend).

## Tecnologías Utilizadas

*   **Frontend:**
    *   React (con Vite)
    *   TypeScript
    *   Axios
    *   React Router DOM
    *   Leaflet (para mapas)
    *   @google/genai (para integración con Gemini)
    *   Nginx (servidor web)
*   **Backend:**
    *   NestJS
    *   TypeScript
    *   TypeORM (con PostgreSQL)
    *   Passport (autenticación JWT y Local)
    *   Bcrypt (para hashing de contraseñas)
*   **Base de Datos:**
    *   PostgreSQL
*   **Orquestación:**
    *   Docker
    *   Docker Compose

## Requisitos Previos

Para ejecutar este proyecto, necesitarás tener instalado lo siguiente en tu sistema:

*   **Docker:** [Instalar Docker](https://docs.docker.com/get-docker/)
*   **Docker Compose:** (Generalmente viene incluido con la instalación de Docker Desktop)

## Despliegue y Ejecución Local

Sigue estos pasos para levantar la aplicación completa en tu entorno local usando Docker Compose:

### 1. Clonar el Repositorio

Primero, clona el repositorio de GitHub a tu máquina local:

```bash
git clone https://github.tu-usuario/transpobolivia.git # Reemplaza con la URL real del repositorio
cd transpobolivia
```

### 2. Configuración de Variables de Entorno

El proyecto utiliza variables de entorno para la configuración de la base de datos y los puertos de los servicios.

Copia el archivo `.env.example` (en la raíz del proyecto) a `.env` y ajusta los valores según tus preferencias:

```bash
cp .env.example .env
```

Contenido de `.env.example`:

```
# --- Configuración General del Entorno ---

# Puertos expuestos en tu máquina (HOST). Cámbialos si están ocupados.
FRONTEND_PORT=5173
BACKEND_PORT=3000
DB_PORT=5433

# Credenciales para la base de datos PostgreSQL
POSTGRES_DB=transpobolivia_db
POSTGRES_USER=user
POSTGRES_PASSWORD=password
```

**Nota:** Si tu proyecto utiliza variables de entorno adicionales (como claves API o secretos JWT) que no están en este ejemplo, asegúrate de añadirlas a tu archivo `.env` y de que estén configuradas correctamente en tu aplicación.

### 3. Levantar la Aplicación con Docker Compose

Una vez configurados los archivos `.env`, puedes construir y levantar todos los servicios (base de datos, backend y frontend) con un solo comando:

```bash
docker-compose up --build -d
```

*   `--build`: Reconstruye las imágenes de Docker (útil la primera vez o después de cambios en el código o Dockerfiles).
*   `-d`: Ejecuta los contenedores en modo "detached" (en segundo plano).

### 4. Acceder a la Aplicación

Una vez que los contenedores estén en funcionamiento:

*   **Frontend:** Abre tu navegador web y navega a `http://localhost:80` (o el puerto que hayas configurado para el frontend en `docker-compose.yml` si lo modificaste).
*   **Backend API:** La API del backend estará disponible en `http://localhost:3000/api` (o el puerto configurado).

### 5. Detener la Aplicación

Para detener y eliminar los contenedores, redes y volúmenes creados por Docker Compose, ejecuta:

```bash
docker-compose down -v
```

*   `-v`: También elimina los volúmenes de datos, lo que significa que perderás los datos de la base de datos. Si quieres conservar los datos, omite `-v`.

## Estructura del Proyecto

*   `./`: Contiene el código fuente del frontend (React/Vite), `Dockerfile` para el frontend, `nginx.conf` y `docker-compose.yml`.
*   `./backend/`: Contiene el código fuente de la aplicación backend (NestJS), su `Dockerfile` y archivos de configuración.
*   `./postgres-data/`: Volumen persistente para los datos de PostgreSQL.

---

¡Disfruta usando TranspoBolivia!

────────────────────────────────────────────────────────────
FILE: concat_and_list.py
────────────────────────────────────────────────────────────

#!/usr/bin/env python3
import os
import csv
import fnmatch
from collections import defaultdict

# ==================================================================
# 1) CONFIGURACIÓN MEJORADA DE EXCLUSIONES
# ==================================================================

# Extensiones relevantes (código fuente y configuraciones esenciales)
INCLUDE_EXT = {
    ".java", ".py", ".js", ".ts", ".jsx", ".tsx", ".html", ".css", 
    ".scss", ".sass", ".less", ".vue", ".svelte",
    ".c", ".cpp", ".h", ".hpp", ".cs", ".go", ".rs", ".rb", ".php",
    ".yaml", ".yml", ".md", ".txt", ".sh", ".bat", ".ps1",
    ".sql", ".graphql", ".proto",
    ".gitignore", ".dockerignore", ".env.example"
}

# Archivos de configuración importantes (incluir SOLO estos JSON/XML específicos)
IMPORTANT_CONFIG_FILES = {
    # JavaScript/TypeScript
    "package.json", "tsconfig.json", "vite.config.js", "vite.config.ts",
    "webpack.config.js", "rollup.config.js", "jest.config.js",
    "tailwind.config.js", "postcss.config.js", ".eslintrc.json",
    
    # Java
    "pom.xml", "build.gradle", "settings.gradle", "application.properties",
    "application.yml", "application.yaml",
    
    # Python
    "requirements.txt", "Pipfile", "pyproject.toml", "setup.py", "poetry.lock",
    
    # Docker & Infrastructure
    "Dockerfile", "docker-compose.yml", "docker-compose.yaml",
    ".dockerignore", "nginx.conf", "Makefile",
    
    # Otros
    "README.md", "README.txt", "LICENSE", "Cargo.toml", "go.mod",
    "composer.json", "Gemfile", "pubspec.yaml", "CMakeLists.txt"
}

# Directorios a EXCLUIR completamente
EXCLUDE_DIRS = {
    ".git", ".vscode", ".idea", "node_modules", "dist", "build",
    "__pycache__", "venv", ".venv", "bin", "obj", "target",
    "postgres-data", "coverage", "logs", "tmp", "temp", "cache",
    ".next", ".nuxt", "out", "public", "static", "assets",
    "vendor", "bower_components", "jspm_packages"
}

# Patrones de archivos a EXCLUIR (incluso si tienen extensión válida)
EXCLUDE_FILE_PATTERNS = {
    # Archivos de traducción/localización (i18n)
    "**/locales/**/*.json",
    "**/lang/**/*.json",
    "**/i18n/**/*.json",
    "**/translations/**/*.json",
    "**/*-i18n.json",
    "**/*.i18n.json",
    # Patrones de idiomas comunes
    "**/en.json", "**/es.json", "**/fr.json", "**/de.json", "**/it.json",
    "**/pt.json", "**/ja.json", "**/zh.json", "**/ko.json", "**/ru.json",
    "**/en-US.json", "**/es-ES.json", "**/fr-FR.json",
    
    # Archivos de lock y generados
    "package-lock.json", "yarn.lock", "pnpm-lock.yaml",
    "composer.lock", "Gemfile.lock", "poetry.lock",
    
    # Mapas y archivos minificados
    "*.min.js", "*.min.css", "*.map", "*.bundle.js",
    
    # Archivos de test/mock data grandes
    "**/test-data/**", "**/mock-data/**", "**/fixtures/**/*.json",
    
    # Otros archivos comunes no esenciales
    ".DS_Store", "Thumbs.db", "*.log", "*.pid", "*.seed",
    "*.swp", "*.swo", "*~"
}

# Nombres de archivos JSON específicos a EXCLUIR
EXCLUDE_JSON_FILES = {
    # Traducciones
    "en.json", "es.json", "fr.json", "de.json", "it.json", "pt.json",
    "ja.json", "zh.json", "ko.json", "ru.json", "ar.json", "hi.json",
    "en-US.json", "en-GB.json", "es-ES.json", "es-MX.json", "fr-FR.json",
    "pt-BR.json", "zh-CN.json", "zh-TW.json",
    
    # Archivos de lock
    "package-lock.json", "yarn.lock", "composer.lock",
    
    # Otros archivos grandes/generados comunes
    "tsconfig.tsbuildinfo", ".eslintcache"
}

# ==================================================================
# 2) FUNCIÓN PARA VERIFICAR EXCLUSIONES MEJORADA
# ==================================================================
def should_exclude(filepath: str) -> bool:
    """Determina si un archivo debe excluirse del TXT"""
    filename = os.path.basename(filepath)
    
    # Excluir por directorio
    path_parts = filepath.split(os.sep)
    if any(ex_dir in path_parts for ex_dir in EXCLUDE_DIRS):
        return True
    
    # Verificar patrones de exclusión
    for pattern in EXCLUDE_FILE_PATTERNS:
        if fnmatch.fnmatch(filepath, pattern):
            return True
    
    # Excluir archivos JSON específicos (traducciones, locks, etc.)
    if filename in EXCLUDE_JSON_FILES:
        return True
    
    # Excluir archivos de más de 200KB (excepto SQL)
    try:
        if os.path.getsize(filepath) > 200 * 1024:  # 200KB
            _, ext = os.path.splitext(filename)
            if ext.lower() not in {".sql", ".md"}:
                return True
    except OSError:
        pass
    
    # Excluir archivos que parecen ser de traducción por su ubicación
    lower_path = filepath.lower()
    if any(indicator in lower_path for indicator in ['/locales/', '/lang/', '/i18n/', '/translations/']):
        if filename.endswith('.json') and filename not in IMPORTANT_CONFIG_FILES:
            return True
    
    return False

def is_important_file(filename: str, filepath: str) -> bool:
    """Determina si un archivo es importante para incluir en el TXT"""
    # Archivos de configuración importantes
    if filename in IMPORTANT_CONFIG_FILES:
        return True
    
    # Archivos con extensiones de código fuente
    _, ext = os.path.splitext(filename)
    if ext.lower() in INCLUDE_EXT:
        return True
    
    # Archivos sin extensión pero importantes
    if not ext and filename in {"Dockerfile", "Makefile", "Procfile"}:
        return True
    
    return False

# ==================================================================
# 3) LÓGICA PRINCIPAL MEJORADA
# ==================================================================
ROOT = os.getcwd()
PROJECT_NAME = os.path.basename(ROOT)
OUT_TXT = f"{PROJECT_NAME}.txt"
OUT_CSV = f"{PROJECT_NAME}_estructura.csv"

groups = defaultdict(list)
all_entries = []
excluded_count = 0
included_count = 0

print("🔍 Iniciando procesamiento del proyecto...")
print(f"📁 Proyecto: {PROJECT_NAME}\n")

for dirpath, dirnames, filenames in os.walk(ROOT, topdown=True):
    # Excluir directorios no deseados
    dirnames[:] = [d for d in dirnames if d not in EXCLUDE_DIRS]
    
    rel_path = os.path.relpath(dirpath, ROOT)
    if rel_path == ".":
        rel_path = PROJECT_NAME
    
    all_entries.append((rel_path, "Directory"))

    for filename in filenames:
        filepath = os.path.join(dirpath, filename)
        rel_file = os.path.relpath(filepath, ROOT)
        
        # Siempre incluir en el CSV para tener la estructura completa
        all_entries.append((rel_file, "File"))
        
        # Para el TXT, aplicar filtros estrictos
        if should_exclude(filepath):
            excluded_count += 1
            continue
        
        if is_important_file(filename, filepath):
            groups[rel_path].append(filepath)
            included_count += 1
        else:
            excluded_count += 1

# ==================================================================
# 4) GENERAR ARCHIVO TXT OPTIMIZADO
# ==================================================================
print("📝 Generando archivo TXT con código relevante...")

with open(OUT_TXT, "w", encoding="utf-8") as out:
    out.write(f"// PROJECT: {PROJECT_NAME}\n")
    out.write("// ================================================\n")
    out.write(f"// Archivos incluidos: {included_count}\n")
    out.write(f"// Archivos excluidos: {excluded_count}\n")
    out.write("// ================================================\n\n")
    
    for folder, files in sorted(groups.items()):
        if not files: 
            continue
        
        out.write(f"\n\n{'='*60}\n")
        out.write(f"DIR: {folder}\n")
        out.write(f"{'='*60}\n\n")
        
        for filepath in sorted(files):
            filename = os.path.basename(filepath)
            rel_path = os.path.relpath(filepath, ROOT)
            
            out.write(f"\n{'─'*60}\n")
            out.write(f"FILE: {rel_path}\n")
            out.write(f"{'─'*60}\n\n")
            
            try:
                with open(filepath, "r", encoding="utf-8") as f:
                    content = f.read()
                    # Limitar líneas extremadamente largas (evitar archivos minificados que pasaron el filtro)
                    lines = content.split('\n')
                    if any(len(line) > 500 for line in lines[:10]):  # Revisar primeras 10 líneas
                        out.write(f"/* ARCHIVO OMITIDO: Parece ser código minificado o generado */\n")
                        continue
                    out.write(content)
                    if not content.endswith('\n'):
                        out.write('\n')
            except UnicodeDecodeError:
                try:
                    with open(filepath, "r", encoding="latin-1") as f:
                        content = f.read()
                        out.write(content)
                        if not content.endswith('\n'):
                            out.write('\n')
                except Exception as e:
                    out.write(f"/* ERROR AL LEER ARCHIVO: {str(e)} */\n")
            except Exception as e:
                out.write(f"/* ERROR AL LEER ARCHIVO: {str(e)} */\n")
    
    out.write(f"\n\n{'='*60}\n")
    out.write("END OF PROJECT\n")
    out.write(f"{'='*60}\n")

# Calcular tamaño del archivo generado
txt_size = os.path.getsize(OUT_TXT) / 1024  # KB

print(f"\n✅ Archivo TXT optimizado creado: {OUT_TXT}")
print(f"   📊 Tamaño: {txt_size:.2f} KB")
print(f"   📄 Archivos incluidos: {included_count}")
print(f"   🚫 Archivos excluidos: {excluded_count}")

# ==================================================================
# 5) GENERAR CSV DE ESTRUCTURA (SIN CAMBIOS)
# ==================================================================
print("\n📋 Generando CSV con estructura completa...")

with open(OUT_CSV, "w", newline="", encoding="utf-8") as csvfile:
    writer = csv.writer(csvfile)
    writer.writerow(["Path", "Type"])
    writer.writerow([PROJECT_NAME, "Directory"])
    
    for path, type_ in sorted(all_entries):
        if path == PROJECT_NAME: 
            continue
        writer.writerow([path, type_])

csv_size = os.path.getsize(OUT_CSV) / 1024  # KB

print(f"\n✅ Estructura CSV creada: {OUT_CSV}")
print(f"   📊 Tamaño: {csv_size:.2f} KB")
print(f"   📁 Entradas totales: {len(all_entries)}")

print(f"\n🎉 Procesamiento completado para el proyecto: {PROJECT_NAME}")
print("\n" + "="*60)

────────────────────────────────────────────────────────────
FILE: docker-compose.yml
────────────────────────────────────────────────────────────


services:
  db:
    image: postgres:18
    container_name: transpobolivia-db
    restart: always
    environment:
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    ports:
      - "${DB_PORT}:5432"
    volumes:
      - postgres_data:/var/lib/postgresql

  backend:
    container_name: transpobolivia-backend
    build:
      context: ./backend
    restart: always
    ports:
      - "${BACKEND_PORT}:3000"
    environment:
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      DATABASE_HOST: db
    depends_on:
      - db

  frontend:
    container_name: transpobolivia-frontend
    build:
      context: .
    restart: always
    ports:
      - "${FRONTEND_PORT}:80"
    depends_on:
      - backend

volumes:
  postgres_data:

────────────────────────────────────────────────────────────
FILE: index.html
────────────────────────────────────────────────────────────

<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TranspoBolivia - Tu Viaje, a un Clic</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/heroicons/2.1.1/24/outline/heroicons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              DEFAULT: '#00529B',
              light: '#0066C0',
              dark: '#003D73',
            },
            secondary: {
              DEFAULT: '#FF6F00',
              light: '#FF8F00',
              dark: '#D86000'
            },
            accent: '#D32F2F',
            background: '#F0F4F8',
            surface: '#FFFFFF',
            text: '#1E293B',
            'text-muted': '#64748B',
          }
        }
      }
    }
  </script>
  <script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.1.1/",
    "react": "https://esm.sh/react@^19.1.1",
    "@google/genai": "https://esm.sh/@google/genai@^1.12.0",
    "react-dom/": "https://esm.sh/react-dom@^19.1.1/",
    "react-router-dom": "https://esm.sh/react-router-dom@^7.7.1",
    "react-hook-form": "https://esm.sh/react-hook-form@^7.52.1",
    "leaflet": "https://esm.sh/leaflet@1.9.4",
    "react-leaflet": "https://esm.sh/react-leaflet@^4.2.1"
  }
}
</script>
</head>

<body class="bg-background text-text">
  <div id="root"></div>
  <script type="module" src="/src/index.tsx"></script>
</body>

</html>

────────────────────────────────────────────────────────────
FILE: nginx.conf
────────────────────────────────────────────────────────────

server {
    # Nginx escuchará en el puerto 80 dentro del contenedor.
    listen 80;

    # Para cualquier petición a la raíz (ej: www.tusitio.com/)
    location / {
        root   /usr/share/nginx/html;
        index  index.html;
        # Clave para React Router: si no encuentra una ruta, devuelve el index.html
        # para que el enrutamiento del lado del cliente se haga cargo.
        try_files $uri $uri/ /index.html;
    }

    # Para cualquier petición que comience con /api (ej: www.tusitio.com/api/auth/login)
    location /api {
        # Reescribe la URL quitando /api antes de enviarla al backend.
        rewrite /api/(.*) /$1 break;
        
        # Redirige la petición al servicio 'backend' en el puerto 3000.
        # Docker Compose se encarga de que 'backend' se resuelva a la IP correcta.
        proxy_pass http://backend:3000;
        
        # Cabeceras importantes para que el backend sepa de dónde viene la petición original.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

────────────────────────────────────────────────────────────
FILE: package.json
────────────────────────────────────────────────────────────

{
  "name": "transpobolivia",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "@google/genai": "^1.12.0",
    "axios": "^1.11.0",
    "leaflet": "1.9.4",
    "react": "^19.1.1",
    "react-dom": "^19.1.1",
    "react-hook-form": "^7.52.1",
    "react-leaflet": "^5.0.0",
    "react-router-dom": "^6.30.2"
  },
  "devDependencies": {
    "@tailwindcss/vite": "^4.1.17",
    "@types/node": "^22.14.0",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.22",
    "postcss": "^8.5.6",
    "tailwindcss": "^4.1.17",
    "typescript": "~5.8.2",
    "vite": "^6.2.0"
  }
}

────────────────────────────────────────────────────────────
FILE: tsconfig.json
────────────────────────────────────────────────────────────

{
  "compilerOptions": {
    "target": "ES2022",
    "experimentalDecorators": true,
    "useDefineForClassFields": false,
    "module": "ESNext",
    "lib": [
      "ES2022",
      "DOM",
      "DOM.Iterable"
    ],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "isolatedModules": true,
    "moduleDetection": "force",
    "allowJs": true,
    "jsx": "react-jsx",
    "paths": {
      "@/*": [
        "./*"
      ]
    },
    "allowImportingTsExtensions": true,
    "noEmit": true
  }
}

────────────────────────────────────────────────────────────
FILE: vite.config.ts
────────────────────────────────────────────────────────────

import path from 'path';
import { defineConfig, loadEnv } from 'vite';
import tailwindcss from '@tailwindcss/vite';
import react from '@vitejs/plugin-react';

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, '.', '');
  return {
    plugins: [
      react(),
      tailwindcss(),
    ],
    build: {
      rollupOptions: {
        onwarn(warning, warn) {
          if (warning.code === 'MODULE_LEVEL_DIRECTIVE') {
            return;
          }
          warn(warning);
        },
      },
    },
    define: {
      'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY),
      'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY)
    },
  };
});


============================================================
END OF PROJECT
============================================================
